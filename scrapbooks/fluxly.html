<div class="featured-image-wrapper">
	<img class="featured-image" src="images/fluxly/screenshot-1-3-4.png"/>
</div>
<div class="date-header">2018</div>

<h1>Fluxly: Physics-based Looper</h1>

<!--FIXME:
<p><a target="new" href="https://itunes.apple.com/us/app/fluxly/id1376844813?ls=1&mt=8"><img src="images/fluxly/availableNow.png"/></a></p>
-->
<div style="width: 70%;background-color:#333333;display:flex;justify-content:center;border-radius: 12px;">
	<iframe src="https://player.vimeo.com/video/267117994" width="250" height="445" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</div>
	
<p>Fluxly is a musical physics looper game where you create new instruments by moving and spinning colorful Fluxum sound sample players. Fluxly brings a whole new approach to knob twiddling and sound making. </p>

<p>You can choose from a bank of built-in sound samples, or record your own samples and play them back in either direction at any speed. By touching two Fluxum and pushing them together you can link them into looping gear train machines. You can also enable movement and let the built-in physics engine take over as the Fluxum bounce around the instrument for random sonic fun.</p>

	<img class="featured-image"   src="images/fluxly/screenshot-5-6.png"/>

<p>Recording can be done right in the app, and loops can be up to about 10 seconds long. You can also customize all of the sounds in Bank 1 by using iTunes and the filesharing features of your iPhone or iPad to upload any sound samples from your computer.</p>

<p>Fluxly was built using openFrameworks, Box2d, libPd and Pure Data.</p>

	<img class="featured-image" src="images/fluxly/screenshot-2-7-8.png"/>	

<img class="featured-image medium-img space-before" src="images/fluxly/bb-friendly.png"/>

<!--
	<h1>Making Fluxly</h1>


<p>
Fluxly began in 2008 as a wizard duel game where you had to make your own game controller in hardware in order to play it. The first demo controllers were cigar boxes with pennies, an Arduino and a USB connection. It was originally written in Flash using the Box2d physics engine (the same one used by the original Angry Birds) and ran on a desktop computer. There were about 20 different aspects of the game that you could control: gravity, wind, lightning, etc. The idea was that participants would use Arduino to make a controller (there was a Fluxly Arduino library), and whoever could make the best controller would have an edge in the game. It was pretty fun; we launched it at the first RI Maker Faire, Foo Fest, and a bunch of other events. It even got <a target="new" href="https://boingboing.net/2009/09/04/san-francisco-arttec.html">a mention in Boing Boing</a>. 
</p>

<div class="featured-image-wrapper featured-image">
	<img style="margin:-5px 0px;width:350px;" src="images/fluxly/fluxlyscreen1.jpg"/>
	<img style="margin:-5px 0px;width:350px;" src="images/fluxly/fluxlyscreen2.jpg"/>
</div>

<p>
The original Fluxly character was based on a whiteboard drawing by my daughter Louise that I turned into a sketch. For the game <a target="new" href="ladyfingersletterpress.com">Arley Rose Torsone</a> turned it into lovely pixel art.
</p>

<div class="featured-image-wrapper featured-image">
	<img style="margin:-5px 0px;height:200px;" src="images/fluxly/louise.jpg"/>
	<img style="margin:-5px 0px;height:200px;" src="images/fluxly/fluxlyorig.png"/>
	<img style="margin:-5px 0px;height:200px;" src="images/fluxly/fluxum1.png"/>
</div>

<p>
Arley and I and Brandon Edens began meeting on Tuesday afternoons to teach ourselves how to make apps. The first project we worked on was another Louise-inspired game called Space Wozzle, an episodic sci-fi collection of mini games riffing on classic arcade games. We made a few iterations but we realized the truth about making video games is that they have to be fun and they have to jell, and I'm afraid Space Wozzle ended up having too any moving parts.
</p>

<img width="750px" src="images/fluxly/wozzle.png"/>

<p>
Later, we used the same "meet every Tuesday for a year and see what happens" business model with Elliot Clapp and Shawn Greenlee to work on some musical apps. Elliot and I had just finished the first year of <a target="new" href="https://makezine.com/2010/01/14/letters-from-the-fab-academy-part-1/">Fab Academy</a> and had made a few hardware musical projects at that time, like the Fluxamasynth and the Fluxalodian. Meanwhile Shawn had taught a great three week workshop on Pure Data called the Pure Data Club, which was how I started learning the tool. Another happenstace was the release of Peter Brinkmann's <a target="new" href="https://github.com/libpd">libPd</a>, which allows you to enbed Pure Data as a sound engine in embedded or mobile devices. Shawn, Elliot and I made about 6 libPd apps in a year, two of which we thought were interesting enough to launch in the app store: <a target="new" href="fluxama.com">Noisemusick and DR-OM</a>.
</p>

<img height="156px" src="images/fluxly/pdclub.jpg"/>
<img height="156px" src="images/fluxly/drom.png"/>

<p>
The Noisemusick app was based on a hardware kit I had made at AS220 that we used in Learn To Solder workshops.  
</p>

<img height="200px" src="images/fluxly/nm1.png"/>
<img height="200px" src="images/fluxly/nm2.jpg"/>

<p>
After that I was at O'Reilly Media and Maker Media for a few years, during which I had the pleasure of working with Peter Brinkmann on a book about libPd called Making Musical Apps. I also worked with Ray Wilson on his book Make: Analog Synthesizers, which is when I spent more and more time exploring electronic musical instruments. 
</p>

<img height="300px" src="images/fluxly/mma.jpg"/>
<img height="300px" src="images/fluxly/mas.jpg"/>

<p>
I made a bunch of little instruments and sonic appliances at this time, one of which was the Yak Shaver. The Yak Shaver was a resitive touch interface to a Pure Data patch that was inspired by the Rhythmicon. The <a target ="new" href="https://en.wikipedia.org/wiki/Rhythmicon">Rhythmicon</a> (below right) was essentially the world's first electronic drum machine, which Henry Cowell commissioned from Leon Theremin. It was optical and operated on spinning tone wheels; each key on the 12 note keyboard would play a pulsing tone at a multiple of the previous key. My Pure Data patch emulated this, but let you read in a WAV sound sample file and play it back at different multiples of tempo.
</p>

<img height="200px" src="images/fluxly/yak.jpg"/>
<img height="200px" src="images/fluxly/rhythmicon.jpg"/>

<p>
Since 2014 I've been at AS220 Industries, which is a Fab Lab, Printshop and Media Lab in Providence RI. It's a great place to make friends and meet interesting people. Fluxly is directly influenced by many members and coworkers at the Industries: Jacque Bidon's moire pattern books, <a target="new" href="http://www.towardsanidealplace.com/">Aisha Jandosova</a> and <a target="new" href="http://www.melitamorales.com/">Melita Morales'</a> Maker Camp activities (mutant instruments, gear trains, and more moire!), <a target="new" href="http://tychohoran.com/">Tycho Horan's</a> risograph color experiments hanging next to my worktable, Chris Anderson's experiments with the <a target="new" href="https://github.com/kweiwen/benjolin">Benjolin</a> synthesizer we made in a workshop, and more. Singer <a target="new" href="https://soundcloud.com/amatworks">Laurie Amat</a> (and coordinator of the <a target="new" href="http://pvdfest.com/essential_grid/pvdloop/">PVD Loop</a> festival) is a frequent Industries visitor and offered testing, vocal recordings, and moral support.
</p>

<img height="200px" src="images/fluxly/moire.jpg"/>
<img height="200px" src="images/fluxly/makercamp-6.jpg"/>
<img height="200px" src="images/fluxly/tycho2.JPG"/>

<p>
All this background may seem tangential to Making Fluxly but it isn't. Looking back at the various projects on my hard drive I think I tried 3 different times over the years to turn the original Fluxly "make your own controller" wizard duel game into a mobile app. Each time I hit a couple of road blocks; the major one was how to make it fun as a one player game. There was also a technical limitation of the physics engine running on a mobile device; I found it could only handle a hundred or so objects (with my primitive coding) where I was imagining a larger play area with hundreds of objects. 
</p>

<img height="200px" src="images/fluxly/proto0a.png"/>
<img height="200px" src="images/fluxly/proto1.png"/>
<img height="200px" src="images/fluxly/proto1a.png"/>
<img height="200px" src="images/fluxly/proto2.png"/>
<img height="200px" src="images/fluxly/proto3.png"/>
<img height="200px" src="images/fluxly/proto4.png"/>
<img height="200px" src="images/fluxly/proto5.png"/>
<img height="200px" src="images/fluxly/proto6.png"/>

<p>
The latest version of Fluxly finally started coming together when I thought about making the game more about the objects than about the characters. At first I was thinking it would be a physics puzzler with a soundtrack, but after hooking up the Yak Shaver Engine everything finally jelled and it became obvious that it should be a musical looper. Adding the physics interface to the Yak Shaver freed the instrument from its integer intervals and opened up room to explore randomness. Everything else seemed to fall into place because of the years of incremental influences and projects that had come before.
</p>
<p>
The 15 built-in samples may seem a little random, but each also has some background:
</p>
<ol>
<li>A sample from Aisha's <a target="new" href="https://vimeo.com/162139030">Banu Musa Music Box</a>, a programmable cardboard xylophone with chimes made from the scrap of Larry Zargosky's geodesic domes.</li>
<li>One of Laurie Amat's vocal snippets contributed for promotion of <a target="new" href="https://moderndevice.com">Modern Device</a>'s Reverbalizer.</li>
<li>A bytebeat sample from the Modern Device Shempscape Bytebeat Shufflebox.</li>
<li>A snippet from Chris Anderson's Benjolin playing.</li>
<li>A recording of the Shopbot spindle as Hannah Liongoren works on a project n the fab lab.</li>
<li>Another Laurie Amat sample.</li>
<li>Geoff Griffin on bass in the intro to "Ask Me About Being a Bog Person".</li>
<li>A classic public domain thunder sample.</li>
<li>The introduction to "The Best Sauce is a Good Applesauce".</li>
<li>A sample of the DROM app.</li>
<li>A recording of the RISD Jacquard loom from a project with Jungil Hong.</li>
<li>A bit of generative marimba music from the <a target="new" href="https://moderndevice.com/product/fluxamasynth-shield/">Fluxamasynth</a>.</li>
<li>A sample of the Noisemusick app.</li>
<li>A recording from a Maker camp participant's mutant instrument.</li>
<li>The background music from original Fluxly game.</li>
</OL>

-->

<h1>How It Works</h1>
<p>
Fluxly is written in C++ and uses the <a  target="new" href="http://openframeworks.cc/">openFrameworks</a> toolkit for creative coding. openFrameworks is aimed at making coding easier for artists and designers and provides convenient libraries or addons that provide an embarassment of riches for someone willing to take it on. Fluxly uses the built-in OpenGL capabilities of openFrameworks, and the <a href="https://github.com/vanderlin/ofxBox2d">OfxBox2d</a> port of Box2D and danomatika's <a href="https://github.com/danomatika/ofxPd">libPd</a> addon.
</p>
<p>
All of the sound synthesis is done in the embedded Yak Shaver Engine Pure Data patch. There are a few parts to the patch: an input stage, the Yak Shaver engine, and an output stage, which handles panning and reverb. There are also the "scopes" that are arrays that hold the data of the sample so they can be rendered in the app. A block diagram looks like this ("Ofx" below refers to the openFrameworks app that the patch is talking to):
</p>

	<img class="full-width space-before" src="images/fluxly/figure1.png"/>

<p>
	The main interface to the app has the four "subunits" at the top, an interface for testing the on/off and tempo controls, and a section at the bottom for loading the default values. Clicking on the messages to the right will load different samples into the 8 yak shaver channels:

	<img class="full-width space-before" src="images/fluxly/figure2.png"/>


<p>The Yak Shaver engine makes extensive use of send and receive blocks (the "s" an "r" blocks) as well as throw~ and catch~ blocks, which are the audio signal equivalent. The "r" or receive blocks here will catch messages sent from within the patch or from the openFrameworks app.</p>


	<img class="full-width space-before" src="images/fluxly/figure3.png"/>

<p>
	Each of the Yak Channels (there's 8 of them) loads a WAV file into a buffer and plays it back as long as the on/off toggle is on. The tempo (marked "multiple" here) controls how fast the file is played back. The openFrameworks app sends a message to this inlet every time the angular velocity of one of the Fluxum circles changes. If the app sends a message to the "filename" inlet a new file is read into the buffer.
</P>

	<img class="full-width space-before" src="images/fluxly/figure4.png"/>

<p>
	Each of the voices is panned in the final output depending on the X coordinate of the Fluxum looper. This subunit of the output stage handles the panning of each channel:

	<img class="full-width space-before" src="images/fluxly/figure5.png"/>

<p>
	Each of the panned outputs of the 8 channels are added together and run through the Pure Data "Freeverb" processor. The inputs are sent as a message from the app depending on the rotation of the white Fluxum in each scene. The output is toggled on or off when the sample selector is chosen.
</p>

	<img class="full-width space-before" src="images/fluxly/figure8.png"/>

<p>
	Recording is handled by the input stage, which uses Pure Data's analog to digital converter to read in microphone audio and save it to a buffer. When the stop button is pushed a message is sent and the buffer is trimmed to size and saved to the app's documents directory. Right now the limit is about 10 seconds (400000 samples at 44.1kHz, as seen in the "resize" command upper right), but that could easily be changed if there's interest in longer samples.
</p>

	<img class="full-width space-before" src="images/fluxly/figure6.png"/>

<p>
	The audio output is also sent to the "scopes" subunit, a group of arrays that are sent back periodically to the main app and used to draw the waveform on the screen.
</p>

	<img width="800" src="images/fluxly/figure7.png"/>

<p>
One of the benefits of using openFrameworks is that it provides a simplified framework for writing your app. Anyone familiar with the "sketching" approach of Processing or Arduino wil recognize an openFrameworks app: it consists of a <i>setup()</i> function called once, an <i>update()</i> function called repeatedly, and a <i>draw()</i> function called at a certain framerate. The draw() function should be as lean as possible, focused just on things that need to be done to draw a frame of the screen play. The update() function is where any number crunching should be done. There are also convenient callbacks for handling user interface events like touches.
</p>
<p> 
	Fluxly uses two openFrameworks addons: ofxPd as a wrapper around Pure Data and the Yak Shaver patch, and ofxBox2d which provides the physics model. Here's an illustration of how they interact:
</p>


	<img class="full-width space-before" src="images/fluxly/figure9.png"/>


<div class="footer"></div>