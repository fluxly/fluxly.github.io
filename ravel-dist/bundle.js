/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "../../core/modules/RavelEmoji.js"
/*!****************************************!*\
  !*** ../../core/modules/RavelEmoji.js ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelEmoji: () => (/* binding */ RavelEmoji)
/* harmony export */ });
const RavelEmoji = {
    "red-circle": "üî¥",
    "orange-circle": "üü†",         
    "yellow-circle": "üü°",
    "green-circle": "üü¢",
    "blue-circle": "üîµ",
    "purple-circle": "üü£",
    "black-circle": "‚ö´Ô∏è",
    "white-circle": "‚ö™Ô∏è",
    "brown-circle": "üü§",
    "red-square": "üü•",
    "orange-square": "üüß",         
    "yellow-square": "üü®",
    "green-square": "üü©",
    "blue-square": "üü¶",
    "purple-square": "üü™",
    "black-square": "‚¨õÔ∏è",
    "white-square": "‚¨úÔ∏è",
    "brown-square": "üü´",
    "flower": "üèµ",
    "hamburger": "üçî",
    "red": "#ff0000",
    "orange": "#ff8800",         
    "yellow": "#ffff00",
    "green": "#00ff00",
    "blue": "#0000ff",
    "purple": "#ff00ff",
    "black": "#000000",
    "white": "#ffffff",
    "brown": "#5f3e3e",
    "donut": 'üç©',
    "roundColors": [
        "üî¥","üü†","üü°","üü¢","üîµ","üü£","‚ö´Ô∏è","‚ö™Ô∏è","üü§"
    ],
    "squareColors": [
        "üü•","üüß","üü®","üü©","üü¶","üü™","‚¨õÔ∏è","‚¨úÔ∏è","üü´"
    ],
    "roundSelection": [
        'üåû','üåù','üåë','üåí','üåì','üåî','üåï','üåñ','üåó','üåò', 'üìÄ','üå∞','üçé','üçè','üèÄ','‚öΩ','‚öæ','üéæ','üé±','üç™','üç•','üçò','üçÖ','üåº','üåê','üåû','üåç','üåé','üåè','üíø'
    ],
    "animals": [
        "üê∂", "üê±", "üê≠", "üêπ", "üê∞", "ü¶ä", "üêª", "üêº", "üêª‚Äç‚ùÑÔ∏è", "üê®", "üêØ", "ü¶Å", "üêÆ", "üê∑", "üêµ", "üêî", "üêß", "üê¶", "üê§", "ü¶Ñ", "üê£", "üê•", "ü¶Ü", "ü¶Ö", "ü¶â", "ü¶á", "üê∫", "üêó", "üê¥",  "üêù", "ü™±", "üêõ", "ü¶ã", "üêå", "üêû", "üêú", "ü™∞", "ü™≤", "ü™≥", "ü¶ü", "ü¶ó", "üï∑", "üï∏", "ü¶Ç", "üê¢", "üêç", "ü¶é", "ü¶ñ", "ü¶ï", "üêô", "ü¶ë", "ü¶ê", "ü¶û", "ü¶Ä", "üê°", "üê†", "üêü", "üê¨", "üê≥", "üêã", "ü¶à", "üêä", "üêÖ", "üêÜ", "ü¶ì", "ü¶ç", "ü¶ß", "ü¶£", "üêò", "ü¶õ", "ü¶è", "üê™", "üê´", "ü¶í", "ü¶ò", "ü¶¨", "üêÉ", "üêÇ", "üêÑ", "üêé", "üêñ", "üêè", "üêë", "ü¶ô", "üêê", "ü¶å", "üêï", "üê©", "ü¶Æ", "üêï‚Äçü¶∫", "üêà", "üêà‚Äç‚¨õ", "ü™∂", "üêì", "ü¶É", "ü¶§", "ü¶ö", "ü¶ú", "ü¶¢", "ü¶©", "üïä", "üêá", "ü¶ù", "ü¶®", "ü¶°", "ü¶´", "ü¶¶", "ü¶•", "üêÅ", "üêÄ", "üêø", "ü¶î"
    ],
    "devices": [
        'üíø','üìÄ','üíΩ','üíæ','üíª','üì±','üìû','üìü','üì†','üì°',
        'üì∫','üìª','üîä','üîâ','üîà','üîá'
    ],
    "buildings": [
        "üè¢", "ü™®", "üèöÔ∏è", "ü™µ", "üèõÔ∏è", "üè°", "üè¨"
    ],
    "emojis": [ 	'üòÑ','üòÉ','üòÄ','üòä','üòâ','üòç','üòò','üòö','üòó','üòô','üòú','üòù','üòõ','üò≥','üòÅ','üòî','üòå','üòí','üòû',
        'üò£','üò¢','üòÇ','üò≠','üò™','üò•','üò∞','üòÖ','üòì','üò©','üò´','üò®','üò±','üò†','üò°','üò§','üòñ','üòÜ','üòã','üò∑','üòé','üò¥',
        'üòµ','üò≤','üòü','üò¶','üòß','üòà','üëø','üòÆ','üò¨','üòê','üòï','üòØ','üò∂','üòá','üòè','üòë','üë≤','üë≥','üëÆ','üë∑','üíÇ','üë∂',
        'üë¶','üëß','üë®','üë©','üë¥','üëµ','üë±','üëº','üë∏','üò∫','üò∏','üòª','üòΩ','üòº','üôÄ','üòø','üòπ','üòæ','üëπ','üë∫','üôà','üôâ',
        'üôä','üíÄ','üëΩ','üí©','üî•','‚ú®','üåü','üí´','üí•','üí¢','üí¶','üíß','üí§','üí®','üëÇ','üëÄ','üëÉ','üëÖ','üëÑ','üëç','üëé','üëå',
        'üëä','‚úä','‚úå','üëã','‚úã','üëê','üëÜ','üëá','üëâ','üëà','üôå','üôè','‚òù','üëè','üí™','üö∂','üèÉ','üíÉ','üë´','üë™','üë¨','üë≠',
        'üíè','üíë','üëØ','üôÜ','üôÖ','üíÅ','üôã','üíÜ','üíá','üíÖ','üë∞','üôé','üôç','üôá','üé©','üëë','üëí','üëü','üëû','üë°','üë†','üë¢',
        'üëï','üëî','üëö','üëó','üéΩ','üëñ','üëò','üëô','üíº','üëú','üëù','üëõ','üëì','üéÄ','üåÇ','üíÑ','üíõ','üíô','üíú','üíö','üíî',
        'üíó','üíì','üíï','üíñ','üíû','üíò','üíå','üíã','üíç','üíé','üë§','üë•','üí¨','üë£','üí≠','üê∂','üê∫','üê±','üê≠','üêπ','üê∞','üê∏',
        'üêØ','üê®','üêª','üê∑','üêΩ','üêÆ','üêó','üêµ','üêí','üê¥','üêë','üêò','üêº','üêß','üê¶','üê§','üê•','üê£','üêî','üêç','üê¢','üêõ',
        'üêù','üêú','üêû','üêå','üêô','üêö','üê†','üêü','üê¨','üê≥','üêã','üêÑ','üêè','üêÄ','üêÉ','üêÖ','üêá','üêâ','üêé','üêê','üêì','üêï','üêñ',
        'üêÅ','üêÇ','üê≤','üê°','üêä','üê´','üê™','üêÜ','üêà','üê©','üêæ','üíê','üå∏','üå∑','üçÄ','üåπ','üåª','üå∫','üçÅ','üçÉ','üçÇ','üåø','üåæ',
        'üçÑ','üåµ','üå¥','üå≤','üå≥','üå∞','üå±','üåº','üåê','üåû','üåù','üåë','üåí','üåì','üåî','üåï','üåñ','üåó','üåò','üåú','üåõ','üåô','üåç',
        'üåé','üåè','üåã','‚≠ê','‚òÄ','‚õÖ','‚òÅ','‚ö°','‚òî','‚õÑ','üåÄ','üåà','üåä','üéç','üíù','üéé','üéí','üéì','üéè','üéê','üéÉ','üëª',
        'üéÖ','üéÑ','üéÅ','üéã','üéâ','üéä','üéà','üéå','üîÆ','üé•','üì∑','üìπ','üìº','üíø','üìÄ','üíΩ','üíæ','üíª','üì±','üìû','üìü','üì†','üì°',
        'üì∫','üìª','üîä','üîâ','üîà','üîá','üîî','üîï','üì¢','üì£','‚è≥','‚åõ','‚è∞','‚åö','üîì','üîí','üîè','üîê','üîë','üîé','üí°','üî¶','üîÜ','üîÖ',
        'üîå','üîã','üîç','üõÅ','üõÄ','üöø','üöΩ','üîß','üî©','üî®','üö™','üö¨','üí£','üî´','üî™','üíä','üíâ','üí∞','üí¥','üíµ','üí∑','üí∂','üí≥','üí∏',
        'üì≤','üìß','üì•','üì§','‚úâ','üì©','üì®','üìØ','üì´','üì™','üì¨','üì≠','üìÆ','üì¶','üìù','üìÑ','üìÉ','üìë','üìä','üìà','üìâ','üìú','üìã','üìá',
        'üìÅ','üìÇ','üìå','üìé','üìè','üìê','üìï','üìó','üìò','üìô','üìì','üìî','üìí','üìö','üìñ','üîñ','üìõ','üî¨','üî≠','üì∞','üé®','üé¨','üé§',
        'üéß','üéº','üéµ','üé∂','üéπ','üéª','üé∫','üé∑','üé∏','üëæ','üéÆ','üÉè','üé¥','üÄÑ','üé≤','üéØ','üèà','üèÄ','‚öΩ','‚öæ','üéæ','üé±',
        'üèâ','üé≥','‚õ≥','üöµ','üö¥','üèÅ','üèá','üèÜ','üéø','üèÇ','üèä','üèÑ','üé£','‚òï','üçµ','üç∂','üçº','üç∫','üçª','üç∏','üçπ','üç∑','üç¥',
        'üçï','üçî','üçü','üçó','üçñ','üçù','üçõ','üç§','üç±','üç£','üç•','üçô','üçò','üçö','üçú','üç≤','üç¢','üç°','üç≥','üçû','üç©','üçÆ','üç¶',
        'üç®','üçß','üéÇ','üç∞','üç™','üç´','üç¨','üç≠','üçØ','üçé','üçè','üçä','üçã','üçí','üçá','üçâ','üçì','üçë','üçà','üçå','üçê','üçç','üç†',
        'üçÜ','üçÖ','üåΩ','üè†','üè°','üè´','üè¢','üè£','üè•','üè¶','üè™','üè©','üè®','üíí','‚õ™','üè¨','üè§','üèØ','üè∞','‚õ∫','üè≠','üóº','üóª',
        'üóΩ','üé†','üé°','‚õ≤','üé¢','üö¢','‚õµ','üö§','üö£','‚öì','üöÄ','‚úà','üí∫','üöÅ','üöÇ','üöä','üöâ','üöû','üöÜ','üöÑ','üöÖ','üöà','üöá','üöù','üöã','üöÉ','üöé','üöå','üöç','üöô','üöò','üöó','üöï','üöñ','üöõ','üöö','üö®','üöì','üöî','üöí','üöë','üöê','üö≤','üö°','üöü','üö†','üöú','üíà','üöè','üé´','üö¶','üö•','üöß','üî∞','‚õΩ','üèÆ','üé∞','‚ô®','üóø','üé™','üé≠','üìç','üö©','üöª','üöπ','üö∫','üöº','üöæ','üö∞','üöÆ','‚ôø','üö≠','üõÑ','üõÖ','üõÉ','üâë','üÜë','üÜò','üÜî','üö´','üîû','üìµ','üöØ','üö±','üö≥','üö∑','üö∏','‚õî','‚ùé','‚úÖ','‚ú¥','üíü','üÜö','üì≥','üì¥','üÜé','üí†','‚ûø','üèß','üíπ','‚≠ï','‚ùó','‚ùì','‚ùï','‚ùî','üîÉ','üïõ','üïß','üïê','üïú','üïë','üïù','üïí','üïû','üïì','üïü','üïî','üï†','üïï','üïñ','üïó','üïò','üïô','üïö','üï°','üï¢','üï£','üï§','üï•','üï¶','üíÆ','üîò','üîó','‚û∞','üî±','üî≤','üî≥','‚óæ','‚óΩ','üî∫','‚¨ú','‚¨õ','‚ö´','‚ö™','üî¥','üîµ','üîª','üî∂','üî∑','üî∏','üîπ'
],

    getRandomEmoji: function() {
        return this.emojis[Math.floor(Math.random() * this.emojis.length)];
    },
    getRandomRoundEmoji: function() {
        return this.roundSelection[Math.floor(Math.random() * this.roundSelection.length)];
    },
    getRandomRoundColor: function() {
        return this.roundColors[Math.floor(Math.random() * this.roundColors.length)];
    },
    getRandomSquareColor: function() {
        return this.squareColors[Math.floor(Math.random() * this.squareColors.length)];
    },
    getRandomAnimalEmoji: function() {
        return this.animals[Math.floor(Math.random() * this.roundSelection.length)];
    }
}

/* Cut and paste:
üî¥,üü†,üü°,üü¢,üîµ,üü£,‚ö´Ô∏è,‚ö™Ô∏è,üü§,
üü•,üüß,üü®,üü©,üü¶,üü™,‚¨õÔ∏è,‚¨úÔ∏è,üü´,
üåû,üåù,üåë,üåí,üåì,üåî,üåï,üåñ,üåó,üåò,
üìÄ,üå∞,üçé,üçè,üèÄ,‚öΩ,‚öæ,üéæ,üé±,
üç™,üç•,üçò,üçÖ,üåº,üåê,üåû,üåç,üåé,üåè,üíø,
üê∂,üê±,üê≠,üêπ,üê∞,ü¶ä,üêª,üêº,üêª‚Äç‚ùÑÔ∏è,üê®,üêØ,ü¶Å,
üêÆ,üê∑,üêµ,üêî,üêß,üê¶,üê§,ü¶Ñ,üê£,üê•
,ü¶Ü,ü¶Ö,ü¶â,ü¶á,üê∫,üêó,üê¥,üêù,ü™±,üêõ,ü¶ã,üêå
,üêû,üêú,ü™∞,ü™≤,ü™≥,ü¶ü,ü¶ó,üï∑,üï∏,ü¶Ç,
üê¢,üêç,ü¶é,ü¶ñ,ü¶ï,üêô,ü¶ë,ü¶ê,ü¶û,ü¶Ä,
üê°,üê†,üêü,üê¨,üê≥,üêã,ü¶à,üêä,üêÖ,üêÜ,ü¶ì,
ü¶ç,ü¶ß,ü¶£,üêò,ü¶õ,ü¶è,üê™,üê´,ü¶í,ü¶ò,ü¶¨,
üêÉ,üêÇ,üêÑ,üêé,üêñ,üêè,üêë,ü¶ô,üêê,ü¶å,üêï,üê©,
ü¶Æ,üêï‚Äçü¶∫,üêà,üêà‚Äç‚¨õ,üêì,ü¶É,ü¶§,ü¶ö,ü¶ú,ü¶¢,ü¶©,üïä,
üêá,ü¶ù,ü¶®,ü¶°,ü¶´,ü¶¶,ü¶•,üêÅ,üêÄ,üêø,ü¶î    

*/

/***/ },

/***/ "../../core/modules/RavelMessages.js"
/*!*******************************************!*\
  !*** ../../core/modules/RavelMessages.js ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelMessages: () => (/* binding */ RavelMessages)
/* harmony export */ });
const RavelMessages = {
	
    signalList : {},
	subscriptions : {},
    
	sendMessage:  function(msg, cmd, content) {
        let evt = new CustomEvent(msg, { detail: { cmd: cmd, content: content }});
        if (Object.keys(this.subscriptions).includes(msg)) {
            for (let target of this.subscriptions[msg]) {
                target.dispatchEvent(evt);
            }
        }
    },
    
	subscribe: function(msg, target) {
        if (Object.keys(this.subscriptions).includes(msg)) {
            this.subscriptions[msg].push(target);
        } else {
            this.subscriptions[msg] = [];
            this.subscriptions[msg].push(target);
        }
	},
	
	unsubscribe: function(msg, target) {
		if (Object.keys(this.subscriptions).includes(msg)) {
            // console.log('removing ' + msg + ' ' + this.subscriptions);
            if (this.subscriptions[msg].includes(target)) {
                this.subscriptions[msg].splice(this.subscriptions[msg].indexOf[target], 1);
            }
           // console.log('after ' + this.subscriptions);
        }
	}
} 

/***/ },

/***/ "../../core/modules/RavelUtilities.js"
/*!********************************************!*\
  !*** ../../core/modules/RavelUtilities.js ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelUtilities: () => (/* binding */ RavelUtilities)
/* harmony export */ });


const RavelUtilities = {

    convertHexToRgbaColor: function(hex, alpha) {
        // Remove the leading # if present
        hex = hex.replace(/^#/, '');

        // Parse 3-digit hex (e.g., #fff) into 6-digit form
        if (hex.length === 3) {
            hex = hex.split('').map(c => c + c).join('');
        }

        // Extract r, g, b
        const r = parseInt(hex.substring(0, 2), 16);
        const g = parseInt(hex.substring(2, 4), 16);
        const b = parseInt(hex.substring(4, 6), 16);

        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

}

/***/ },

/***/ "../../core/web-components/common/RavelComponentPath.js"
/*!**************************************************************!*\
  !*** ../../core/web-components/common/RavelComponentPath.js ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ravelComponentPath: () => (/* binding */ ravelComponentPath)
/* harmony export */ });
// If building with Webpack, honor the __RAVEL_COMPONENT_BASE__ value instead
const ravelComponentPath =
  ( true && "ravel-dist/")
  || 0;

/***/ },

/***/ "../../core/web-components/common/global-styles.js"
/*!*********************************************************!*\
  !*** ../../core/web-components/common/global-styles.js ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
const globalStyles = `
<style>
@import url('https://fonts.googleapis.com/css2?family=Quantico:wght@400;500;700;900&display=swap');
</style>
`
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (globalStyles);


/***/ },

/***/ "../../core/web-components/common/ravelComponentPath.js"
/*!**************************************************************!*\
  !*** ../../core/web-components/common/ravelComponentPath.js ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ravelComponentPath: () => (/* binding */ ravelComponentPath)
/* harmony export */ });
// If building with Webpack, honor the __RAVEL_COMPONENT_BASE__ value instead
const ravelComponentPath =
  ( true && "ravel-dist/")
  || 0;

/***/ },

/***/ "../../core/web-components/custom-elements/assemblies/index.js"
/*!*********************************************************************!*\
  !*** ../../core/web-components/custom-elements/assemblies/index.js ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _ravel_signal_collector_ravel_signal_collector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ravel-signal-collector/ravel-signal-collector.js */ "../../core/web-components/custom-elements/assemblies/ravel-signal-collector/ravel-signal-collector.js");


/***/ },

/***/ "../../core/web-components/custom-elements/assemblies/ravel-signal-collector/ravel-signal-collector.js"
/*!*************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/assemblies/ravel-signal-collector/ravel-signal-collector.js ***!
  \*************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSignalCollector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSignalCollector.js */ "../../core/web-components/custom-elements/assemblies/ravel-signal-collector/src/RavelSignalCollector.js");
/*
Defines the custom element <ravel-v-stream>
*/



customElements.define('ravel-signal-collector', _src_RavelSignalCollector_js__WEBPACK_IMPORTED_MODULE_0__.RavelSignalCollector);


/***/ },

/***/ "../../core/web-components/custom-elements/assemblies/ravel-signal-collector/src/RavelSignalCollector.js"
/*!***************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/assemblies/ravel-signal-collector/src/RavelSignalCollector.js ***!
  \***************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSignalCollector: () => (/* binding */ RavelSignalCollector)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");




class RavelSignalCollector extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #assembly {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #container {

            display: flex;
            flex-direction: column;
            padding: 20px;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            max-width: 500px;
            background-color: #ffffff;
        }
        #content {
            display: flex;
            flex-wrap: wrap;
            max-width: 400px;
        }
        .content > ravel-signal {
            flex: 1 1 50px;
        }
        #icon {
            font-size: 48px;
        }
        #label {
            font-size: 24px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <ravel-assembly id="assembly" docked dock-target="collectors" icon="üè°" label="signal-collector">
        <div id="container">
        <div id="content">
            <ravel-signal icon="‚ùå"></ravel-signal>
            <ravel-signal icon="‚ö°"></ravel-signal>
            <ravel-signal icon="üî¥"></ravel-signal>
            <ravel-signal icon="üü†"></ravel-signal>
            <ravel-signal icon="üü°"></ravel-signal>
            <ravel-signal icon="üü¢"></ravel-signal>
            <ravel-signal icon="üîµ"></ravel-signal>
            <ravel-signal icon="üü£"></ravel-signal>
            <ravel-signal icon="‚ö™Ô∏è"></ravel-signal>
            <ravel-signal icon="üü§"></ravel-signal>
            <ravel-signal icon="üü•"></ravel-signal>
            <ravel-signal icon="üüß"></ravel-signal>
            <ravel-signal icon="üü®"></ravel-signal>
            <ravel-signal icon="üü©"></ravel-signal>
            <ravel-signal icon="üü¶"></ravel-signal>
            <ravel-signal icon="üü™"></ravel-signal>
            <ravel-signal icon="‚¨úÔ∏è"></ravel-signal>
            <ravel-signal icon="üü´"></ravel-signal>
            <slot></slot>
        </div>
        </div>
        </ravel-assembly>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_2__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
        for (let child of this.shadowRoot.querySelector('slot').assignedElements()) {
            this.shadowRoot.querySelector('#content').appendChild(child);
        }
        this.shadowRoot.querySelector('slot').remove();
        let count = 0;
        for (let child of this.shadowRoot.querySelector('#content').children) {
            let icon = child.getAttribute('icon');
            _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__.RavelMessages.signalList[icon] = count;
            if (child.getAttribute('value')) {
                _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__.RavelMessages.signalList[icon] = child.getAttribute('value');
            }
            count++;   
        }
        this.addEventListener('signal', this.handleEvent);
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__.RavelMessages.signalList = {};
    }
  
    setup = () => {
        this.observedMessages = ['signal'];
        this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }

    handleEvent = (evt) => {
        // console.log(evt.detail.cmd + ' : ' + evt.detail.content);
        _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__.RavelMessages.signalList[evt.detail.cmd] = evt.detail.content;
        console.log(_modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__.RavelMessages.signalList[evt.detail.cmd]);
    }

    getPicklist = () => {
        let htmlString = '';
        for (let key in _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_1__.RavelMessages.signalList) {
            htmlString += `<option value="${key}">${key}</option>`;
        }
        return `<select name="signal-list">${htmlString}</select>`;
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/ballyhoo/index.js"
/*!*******************************************************************!*\
  !*** ../../core/web-components/custom-elements/ballyhoo/index.js ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _ravel_rss_card_ravel_rss_card_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ravel-rss-card/ravel-rss-card.js */ "../../core/web-components/custom-elements/ballyhoo/ravel-rss-card/ravel-rss-card.js");


/***/ },

/***/ "../../core/web-components/custom-elements/ballyhoo/ravel-rss-card/ravel-rss-card.js"
/*!*******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/ballyhoo/ravel-rss-card/ravel-rss-card.js ***!
  \*******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelRSSCard_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelRSSCard.js */ "../../core/web-components/custom-elements/ballyhoo/ravel-rss-card/src/RavelRSSCard.js");

/*
Defines the custom element <rss-card>
*/



customElements.define('ravel-rss-card', _src_RavelRSSCard_js__WEBPACK_IMPORTED_MODULE_0__.RavelRSSCard);


/***/ },

/***/ "../../core/web-components/custom-elements/ballyhoo/ravel-rss-card/src/RavelRSSCard.js"
/*!*********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/ballyhoo/ravel-rss-card/src/RavelRSSCard.js ***!
  \*********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelRSSCard: () => (/* binding */ RavelRSSCard)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");





class RavelRSSCard extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
            #card {
              border: 1px solid #ccc;
              padding: 1em;
              border-radius: 8px;
              cursor: pointer;
              background: #fafafa;
              max-width: 400px;
              transition: box-shadow 0.2s;
            }
            #card:hover {
              box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            }
            #modal {
              position: fixed;
              top: 0; left: 0; right: 0; bottom: 0;
              background: rgba(0,0,0,0.7);
              display: none;
              justify-content: center;
              align-items: center;
              z-index: 9999;
            }
            #modal.active {
              display: flex;
            }
            #modal-content {
              background: #fff;
              padding: 2em;
              border-radius: 8px;
              max-height: 80vh;
              overflow-y: auto;
              max-width: 600px;
              width: 90%;
            }
            #modal-content h2 {
              margin-top: 0;
            }
            #modal-content ul {
              padding-left: 1em;
            }
            #modal-content li {
              margin-bottom: 1em;
            }
            #close {
              font-size: 150px;
              color: #ffffff;
              position: fixed;
              cursor: pointer;
              top: 0px;
              right: 50px;
            }
          </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
          <div id="card">
          <img src="${_common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_3__.ravelComponentPath}/images/loading.svg">
          </div>
          <div id="modal">
          <span id="close">&times;</span>
            <div id="modal-content">
              Foo.
            </div>
          </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'feed'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.card = this.shadowRoot.querySelector("#card");
        this.modal = this.shadowRoot.querySelector("#modal");
        this.close = this.shadowRoot.querySelector("#close");
        this.signals = [];
    }
    
    connectedCallback() {
        this.setup();
        this.feed = this.getAttribute('feed');
        if (this.feed) this.loadFeed(this.feed);
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    setup = () => {
       // this.observedMessages = [`${this.id}`];
       // this.subscribe(this.observedMessages);
        this.subscribe(this.signals); 
        this.card.addEventListener("click", () =>  this.modal.classList.add("active"));
        this.close.addEventListener("click", () =>  this.modal.classList.remove("active"));
        this.modal.addEventListener("click", e => {
            if (e.target === modal) modal.classList.remove("active");
        }); 
    }


    teardown = () => {
        this.unsubscribe(this.signals);
    }
    
    loadFeed = async (url) => {
        try {
            const proxy = "https://api.allorigins.win/raw?url="; 
            const res = await fetch(proxy + encodeURIComponent(url));
            const text = await res.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, "application/xml");
            const channel = xml.querySelector("channel");
            const title = channel.querySelector("title")?.textContent ?? "Feed";
            const items = [...xml.querySelectorAll("item")].map(item => ({
                title: item.querySelector("title")?.textContent,
                link: item.querySelector("link")?.textContent,
                description: item.querySelector("description")?.textContent
            }));
            this.renderCard(title, items);
        } catch (err) {
            console.error("Error loading feed:", err);
            this.shadowRoot.innerHTML = `<p>Failed to load feed.</p>`;
        }
      }

    renderCard(feedTitle, items) {
        if (!items.length) {
            this.container.innerHTML = `<p>No items found.</p>`;
            return;
        }
        const first = items[0];

        this.card.innerHTML = `<h3>${feedTitle}</h3>
            <p><strong>${first.title}</strong></p>
            <p>${first.description?.substring(0,100) ?? ""}...</p>`;

        this.shadowRoot.querySelector("#modal-content").innerHTML = `
        <h2>${feedTitle}</h2>
              <ul>
                ${items.map(item =>
                  `<li>
                    <a href="${item.link}" target="_blank">${item.title}</a><br>
                    <small>${item.description ?? ""}</small>
                  </li>`).join("")}
              </ul>
        `;
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
       
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/base/index.js"
/*!***************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/index.js ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _ravel_assembly_ravel_assembly_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ravel-assembly/ravel-assembly.js */ "../../core/web-components/custom-elements/base/ravel-assembly/ravel-assembly.js");
/* harmony import */ var _ravel_message_bridge_ravel_message_bridge_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ravel-message-bridge/ravel-message-bridge.js */ "../../core/web-components/custom-elements/base/ravel-message-bridge/ravel-message-bridge.js");
/* harmony import */ var _ravel_sample_ravel_sample_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ravel-sample/ravel-sample.js */ "../../core/web-components/custom-elements/base/ravel-sample/ravel-sample.js");
/* harmony import */ var _ravel_sequence_ravel_sequence_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ravel-sequence/ravel-sequence.js */ "../../core/web-components/custom-elements/base/ravel-sequence/ravel-sequence.js");
/* harmony import */ var _ravel_signal_ravel_signal_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ravel-signal/ravel-signal.js */ "../../core/web-components/custom-elements/base/ravel-signal/ravel-signal.js");
/* harmony import */ var _ravel_a_stream_ravel_a_stream_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ravel-a-stream/ravel-a-stream.js */ "../../core/web-components/custom-elements/base/ravel-a-stream/ravel-a-stream.js");
/* harmony import */ var _ravel_m_stream_ravel_m_stream_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ravel-m-stream/ravel-m-stream.js */ "../../core/web-components/custom-elements/base/ravel-m-stream/ravel-m-stream.js");
/* harmony import */ var _ravel_q_stream_ravel_q_stream_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ravel-q-stream/ravel-q-stream.js */ "../../core/web-components/custom-elements/base/ravel-q-stream/ravel-q-stream.js");
/* harmony import */ var _ravel_v_stream_ravel_v_stream_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ravel-v-stream/ravel-v-stream.js */ "../../core/web-components/custom-elements/base/ravel-v-stream/ravel-v-stream.js");










/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-a-stream/ravel-a-stream.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-a-stream/ravel-a-stream.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelAStream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelAStream.js */ "../../core/web-components/custom-elements/base/ravel-a-stream/src/RavelAStream.js");
/*
Defines the custom element <ravel-a-stream>
*/



customElements.define('ravel-a-stream', _src_RavelAStream_js__WEBPACK_IMPORTED_MODULE_0__.RavelAStream);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-a-stream/src/RavelAStream.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-a-stream/src/RavelAStream.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelAStream: () => (/* binding */ RavelAStream)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelAStream extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            padding: 20px;
            margin: 20px;
            border: 4px solid #777777;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;

        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="type">a-stream</div>
        <div id="name">Foo Bar</div>
        <div id="inputs">signal 1, signal 2</div>
        <div id="outputs">signal 3</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'src'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
        console.log('set up a stream!');
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-assembly/ravel-assembly.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-assembly/ravel-assembly.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelAssembly_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelAssembly.js */ "../../core/web-components/custom-elements/base/ravel-assembly/src/RavelAssembly.js");
/*
Defines the custom element <ravel-assembly>
*/



customElements.define('ravel-assembly', _src_RavelAssembly_js__WEBPACK_IMPORTED_MODULE_0__.RavelAssembly);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-assembly/src/RavelAssembly.js"
/*!******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-assembly/src/RavelAssembly.js ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelAssembly: () => (/* binding */ RavelAssembly)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");




class RavelAssembly extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            border: 10px solid #eeeeee;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            justify-content: center;
            align-items: center;
            max-width: 500px;
            background-color: #ffffff;
            z-index: 10;
        }
        #content {
            display: flex;
            justify-content: space-around;
        }
        #icon {
            font-size: 48px;
        }
        #label {
            font-size: 24px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="icon">üêº</div>
        <div id="label">foo</div>
        <div id="content">
        <slot></slot>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'rows', 'cols', 'show-header', 'border-color'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html
            + this.constructor.baseStyles
            + this.constructor.baseHtml;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.rows = 1;
        this.cols = 1;
        this.icon = 'üêº';
        this.label = 'assembly';
        this.showControls = false;   // Assemblies don't generally need signals
        this.showHeader = true;		
        window.addEventListener('load', this.onPageLoaded);
    }
  
    setup = () => {
        this.observedMessages = [`${this.label}`, 'on-page-load'];
        this.subscribe(this.observedMessages);   
        this.shadowRoot.querySelector('#icon').addEventListener('click', this.minimize);
        this.addEventListener(`${this.label}`, this.handleEvents);
        this.shadowRoot.querySelector('#label').innerHTML = `${this.label}`;
        this.shadowRoot.querySelector('#icon').innerHTML = `${this.icon}`;
        if (!this.showHeader) {
            this.shadowRoot.querySelector('#icon').style.display = 'none';
            this.shadowRoot.querySelector('#label').style.display = 'none';
        }
        if (!this.showControls) {
            this.shadowRoot.querySelector('#controls-container').style.display = 'none';
        }
    }
    
    teardown = () => {
       this.unsubscribe(this.observedMessages);
       this.shadowRoot.querySelector('#icon').removeEventListener('click', this.minimize);
    }

    handleEvents = (evt) => {
        if (evt.detail.cmd === 'maximize') {
            this.maximize();
        }
    }

    minimize = () => {
        _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__.RavelMessages.sendMessage(`${this.dockTarget}`, 'minimize', this);
        this.shadowRoot.querySelector('#container').style.display = 'none';
    }

    maximize = () => {
        this.shadowRoot.querySelector('#container').style.display = 'flex';
    }

    onPageLoaded = () => {
        console.log('on-page-load-assembly');
        if (this.dockTarget) {
            _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__.RavelMessages.sendMessage(`${this.dockTarget}`, 'register', this);
        }
        if (this.docked) this.minimize();
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'rows') {
            this.rows = parseInt(newValue, 10);
        }
        if (name === 'cols') {
            this.cols = parseInt(newValue, 10);
        }
        if (name === 'show-header') {
            if (newValue === 'false') this.showHeader = false;
        }
        if (name === 'show-controls') {
            if (newValue === 'false') this.showControls = false;
        }
        if (name === 'icon') {
            this.icon = newValue;
            this.shadowRoot.querySelector('#icon').innerHTML = `${this.icon}`;
        }
        if (name === 'label') {
            this.label = newValue;
            this.shadowRoot.querySelector('#label').innerHTML = `${this.label}`;
        }
        if (name === 'border-color') {
            this.shadowRoot.querySelector('#container').style.border = `10px solid ${newValue}`;
        }
        if (name === 'docked') {
            console.log('dock');
            this.docked = true;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js"
/*!****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js ***!
  \****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelElement: () => (/* binding */ RavelElement)
/* harmony export */ });
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");


class RavelElement extends HTMLElement {
	static get baseStyles() {
        return `
        <style>
		#container {
		    pointer-events: auto;
		}
		#controls-container {
		    margin: 20px 10px;
		    display: flex;
			justify-content: space-between;
			align-items: center;
		    font-size: 14px;
			background-color: #ffffff;
		}
		#signals-in, #signals-out {
		    margin-right: 10px;
		}
		#controls-container {
		    display:none;
		}
        </style>
        `;
    }
  
    static get baseHtml() { 
        return `
    <div id="controls-container">
    <div id="signals-in" class="control">‚≠ï</div>
	<div id="signals-out" class="control">‚≠ï</div>
	<!--<div id="streams" class="control">‚≠ï</div>-->
    </div>
    `;
    }

	constructor() {
		super();
        this.dockTarget = '';
		this.name = '';
		this.icon = '';
		this.signalsIn = [];
		this.signalsOut = [];
		this.streams = [];
		this.docked = false;
		this.showControls = false;
		this.messageOnClick = [];
		window.addEventListener('load', this.onPageLoaded);
	}
	
	static get baseObservedAttributes() { 
        return [ 'icon', 'label', 'type', 'show-close', 'show-controls',
				 'docked', 'dock-target', 'state', 'size', 'theme',
			     'positioned', 'width', 'height', 'x', 'y', 'scale', 
				 'no-click', 'show-feedback', 'virtual-click', 'virtual-drag', 'virtual-release',
				 'message-on-click', 'signals-in', 'signals-out', 'streams'];
    }

	sendMessage(msg, cmd, content) {
        _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__.RavelMessages.sendMessage(msg, cmd, content);
	}

	broadcastMessage(msg, cmd, content) {
        let evt = new CustomEvent(msg, { detail: { cmd: cmd, content: content }});
        window.dispatchEvent(evt);
	}

	subscribe(msgList) {
        for (let msg of msgList) {
            _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__.RavelMessages.subscribe(msg, this);
		}
	}
	
	unsubscribe(msgList) {
		for (let msg of msgList) {
			_modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__.RavelMessages.unsubscribe(msg, this);
		}
	}

	onPageLoaded = () => {
	    this.updateSignals();
	}

	handleMessageOnClick = () => {
		console.log('message-on-click!');
		if (this.messageOnClick.length > 0) {
			this.sendMessage(this.messageOnClick[0], this.messageOnClick[1], this.messageOnClick[2]);
			console.log(`${this.messageOnClick[0]}, ${this.messageOnClick[1]}, ${this.messageOnClick[2]}`);
		}
	}

	updateSignals = () => {
		this.removeDuplicateSignals();
		/*if (this.signalsIn.length > 0) {
			this.shadowRoot.querySelector('#signals-in').innerHTML = '';
		}
		for (let inputIcon of this.signalsIn) {
			this.shadowRoot.querySelector('#signals-in').innerHTML += this.checkSignal(inputIcon);
		}
		if (this.signalsOut.length > 0) {
			this.shadowRoot.querySelector('#signals-out').innerHTML = '';
		}
		for (let outputIcon of this.signalsOut) {
			this.shadowRoot.querySelector('#signals-out').innerHTML += this.checkSignal(outputIcon);
		}
		*/
	}


	checkSignal = (signalIcon) => {	
		if (signalIcon) {
			if (_modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__.RavelMessages.signalList[signalIcon])  {
				return signalIcon;
			} else {
				return '‚ùå';
			}
		}
	}

	removeDuplicateSignals = () => {

	}

	checkStream = (streamIcon) => {
		return streamIcon;
	}

	attributeChangedCallback(name, oldValue, newValue) {
		if (name === 'icon') {
			this.icon = newValue;
		}
		if (name === 'label') {
			this.label = newValue;
		}
		if (name === 'docked') {
			this.docked = true;
		}
		if (name === 'dock-target') {
			this.dockTarget = newValue;
		}
		if (name === 'width') {
            this.width = Number(newValue);
        }
        if (name === 'height') {
            this.height = Number(newValue);
        }
		if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.y = Number(newValue);
        }
		if (name === 'message-on-click') {
			this.messageOnClick = newValue.split(',');
		}
		if (name === 'signals-in') {
			this.signalsIn = newValue.split(',');
		}
		if (name === 'signals-out') {
			this.signalsOut = newValue.split(',');
		}
		if (name === 'streams') {
			this.streams = newValue.split(',');
		}
		if (name === 'show-controls') {
			this.showControls = true;
		}
	}

} 

/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-m-stream/ravel-m-stream.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-m-stream/ravel-m-stream.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelMStream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelMStream.js */ "../../core/web-components/custom-elements/base/ravel-m-stream/src/RavelMStream.js");
/*
Defines the custom element <ravel-m-stream>
*/



customElements.define('ravel-m-stream', _src_RavelMStream_js__WEBPACK_IMPORTED_MODULE_0__.RavelMStream);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-m-stream/src/RavelMStream.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-m-stream/src/RavelMStream.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelMStream: () => (/* binding */ RavelMStream)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelMStream extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            padding: 20px;
            margin: 20px;
            border: 4px solid #777777;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="type">m-stream</div>
        <div id="name">Foo Bar</div>
        <div id="inputs">signal 1, signal 2</div>
        <div id="outputs">signal 3</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'attribute'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-message-bridge/ravel-message-bridge.js"
/*!***************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-message-bridge/ravel-message-bridge.js ***!
  \***************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelMessageBridge_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelMessageBridge.js */ "../../core/web-components/custom-elements/base/ravel-message-bridge/src/RavelMessageBridge.js");
/*
Defines the custom element
*/



customElements.define('ravel-message-bridge', _src_RavelMessageBridge_js__WEBPACK_IMPORTED_MODULE_0__.RavelMessageBridge);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-message-bridge/src/RavelMessageBridge.js"
/*!*****************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-message-bridge/src/RavelMessageBridge.js ***!
  \*****************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelMessageBridge: () => (/* binding */ RavelMessageBridge)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelMessageBridge extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        </style>
        `;
    }
  
    static get html() { 
        return `
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['ravel-message-bridge'];
        this.subscribe(this.observedMessages);
        this.addEventListener('ravel-message-bridge', (evt) => {
            console.log(`Message from elsewhere: ${evt.detail.target} ${evt.detail.cmd} ${evt.detail.content} `);
            this.sendMessage(evt.detail.target, evt.detail.cmd, evt.detail.content);
        });
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-q-stream/ravel-q-stream.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-q-stream/ravel-q-stream.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelQStream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelQStream.js */ "../../core/web-components/custom-elements/base/ravel-q-stream/src/RavelQStream.js");
/*
Defines the custom element <ravel-q-stream>
*/



customElements.define('ravel-q-stream', _src_RavelQStream_js__WEBPACK_IMPORTED_MODULE_0__.RavelQStream);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-q-stream/src/RavelQStream.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-q-stream/src/RavelQStream.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelQStream: () => (/* binding */ RavelQStream)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelQStream extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            padding: 20px;
            margin: 20px;
            border: 4px solid #777777;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;

        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="type">q-stream</div>
        <div id="name">Foo Bar</div>
        <div id="inputs">signal 1, signal 2</div>
        <div id="outputs">signal 3</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'attribute'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-sample/ravel-sample.js"
/*!***********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-sample/ravel-sample.js ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSample_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSample.js */ "../../core/web-components/custom-elements/base/ravel-sample/src/RavelSample.js");
/*
Defines the custom element <ravel-sample>
*/



customElements.define('ravel-sample', _src_RavelSample_js__WEBPACK_IMPORTED_MODULE_0__.RavelSample);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-sample/src/RavelSample.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-sample/src/RavelSample.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSample: () => (/* binding */ RavelSample)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelSample extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        </style>
        `;
    }
  
    static get html() { 
        return `
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'attribute'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-sequence/ravel-sequence.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-sequence/ravel-sequence.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSequence_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSequence.js */ "../../core/web-components/custom-elements/base/ravel-sequence/src/RavelSequence.js");

/*
Defines the custom element <ravel-sequence>
*/



customElements.define('ravel-sequence', _src_RavelSequence_js__WEBPACK_IMPORTED_MODULE_0__.RavelSequence);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-sequence/src/RavelSequence.js"
/*!******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-sequence/src/RavelSequence.js ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSequence: () => (/* binding */ RavelSequence)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");




class RavelSequence extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
        }
        .cell {
            display: inline-block;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container"></div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'cells', 'icon-active', 'icon-inactive', 'size', 'x', 'y', 'orientation', 'sequence-id', 'period'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.iconActive = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji.getRandomEmoji();
        this.iconInactive = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji.getRandomEmoji();
        this.period = 400;
        this.shuttle = 0;
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
        this.cellList = [];
        this.container.innerHTML = '';
        for (let i = 0; i < this.cells; i++) {
            this.cellList.push(this.iconInactive);
            this.container.innerHTML += `<div class="cell" id="cell-${i}">${this.iconInactive}</div>`;
        }
        this.setFontSize();
        this.timer = setInterval(
            () => {
                if (this.shuttle > this.cells) this.shuttle = 0;
                this.shadowRoot.querySelector(`#cell-${this.shuttle}`).innerText = this.iconInactive;
                this.shuttle = (this.shuttle + 1) % this.cells;
                this.shadowRoot.querySelector(`#cell-${this.shuttle}`).innerText = this.iconActive;
            },
            this.period
        );
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }
    
    setFontSize() {
        let size = this.size * 20;
        let newSize = size / this.cells;
        console.log(this.size);
        console.log(this.cells);
        console.log(newSize);
        if (newSize > 100) newSize = 100;
        this.container.style['font-size'] = `${newSize}px`;
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'icon-active') {
            this.iconActive = newValue;
        }
        if (name === 'icon-inactive') {
            this.iconInactive = newValue;
        }
        if (name === 'cells') {
            this.cells = parseInt(newValue, 10);
            this.cellList = [];
            this.container.innerHTML = '';
            for (let i = 0; i < this.cells; i++) {
                this.cellList.push(this.iconInactive);
                this.container.innerHTML += `<div class="cell" id="cell-${i}">${this.iconInactive}</div>`;
            }
            if (this.shuttle > this.cells) this.shuttle = 0;
            if (this.size) this.setFontSize();
        }
        if (name === 'size') {
            this.size = parseInt(newValue, 10);
        }
        if (name === 'x') {
            this.container.style.position = 'fixed';
            this.x = newValue;
            this.container.style.left = newValue;
        }
        if (name === 'y') {
            this.container.style.position = 'fixed';
            this.y = newValue;
            this.container.style.top = newValue;
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'sequence-id') {
            this.sliderId = newValue;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-signal/ravel-signal.js"
/*!***********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-signal/ravel-signal.js ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSignal_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSignal.js */ "../../core/web-components/custom-elements/base/ravel-signal/src/RavelSignal.js");
/*
Defines the custom element <ravel-signal>
*/



customElements.define('ravel-signal', _src_RavelSignal_js__WEBPACK_IMPORTED_MODULE_0__.RavelSignal);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-signal/src/RavelSignal.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-signal/src/RavelSignal.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSignal: () => (/* binding */ RavelSignal)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelSignal extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #icon {
            font-size: 32px;
            margin: 5px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="icon"></div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = [];
        //this.subscribe(this.observedMessages);   
        this.shadowRoot.querySelector('#icon').innerHTML = `${this.icon}`;
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    getIcon = () => {
        return this.icon;
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        // Element doesn't have any for now
        super.attributeChangedCallback(name, oldValue, newValue);
        
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-v-stream/ravel-v-stream.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-v-stream/ravel-v-stream.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelVStream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelVStream.js */ "../../core/web-components/custom-elements/base/ravel-v-stream/src/RavelVStream.js");
/*
Defines the custom element <ravel-v-stream>
*/



customElements.define('ravel-v-stream', _src_RavelVStream_js__WEBPACK_IMPORTED_MODULE_0__.RavelVStream);


/***/ },

/***/ "../../core/web-components/custom-elements/base/ravel-v-stream/src/RavelVStream.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/base/ravel-v-stream/src/RavelVStream.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelVStream: () => (/* binding */ RavelVStream)
/* harmony export */ });
/* harmony import */ var _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelVStream extends _ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            padding: 20px;
            margin: 20px;
            border: 4px solid #777777;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;

        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="type">v-stream</div>
        <div id="name">Foo Bar</div>
        <div id="inputs">signal 1, signal 2</div>
        <div id="outputs">signal 3</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'attribute'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/document/index.js"
/*!*******************************************************************!*\
  !*** ../../core/web-components/custom-elements/document/index.js ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _ravel_scrapbook_ravel_scrapbook_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ravel-scrapbook/ravel-scrapbook.js */ "../../core/web-components/custom-elements/document/ravel-scrapbook/ravel-scrapbook.js");


/***/ },

/***/ "../../core/web-components/custom-elements/document/ravel-scrapbook/ravel-scrapbook.js"
/*!*********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/document/ravel-scrapbook/ravel-scrapbook.js ***!
  \*********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelScrapbook_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelScrapbook.js */ "../../core/web-components/custom-elements/document/ravel-scrapbook/src/RavelScrapbook.js");

/*
Defines the custom element <ravel-scrapbook>
*/



customElements.define('ravel-scrapbook', _src_RavelScrapbook_js__WEBPACK_IMPORTED_MODULE_0__.RavelScrapbook);


/***/ },

/***/ "../../core/web-components/custom-elements/document/ravel-scrapbook/src/RavelScrapbook.js"
/*!************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/document/ravel-scrapbook/src/RavelScrapbook.js ***!
  \************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelScrapbook: () => (/* binding */ RavelScrapbook)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/ravelComponentPath.js */ "../../core/web-components/common/ravelComponentPath.js");




class RavelScrapbook extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
            #blocker {
                display: none;
                background-color: rgba(0, 0, 0, 0.5);
                position: fixed;
                top: 0px;
                left: 0px;
                width: 100vw;
                height: 100vh;
            }
            #container {
                user-select: none;
                border: 10px solid rgba(255, 255, 255, 0.80);
                border-radius:20px;
                overflow:hidden;
                touch-action: none;
                cursor: pointer;
                overscroll-behavior: contain; 
            }
            #container img {
                min-width: 200px;
                width: 100%;
                max-width: 200px;
                max-height: 200px;
                aspect-ratio: 1 / 1;
                object-fit: cover; 
                user-select: none;
                display: block;
            }
            #reader {
                display: none;
                visibility: hidden;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                padding: 40px 0px;
                max-width: 1000px;
                height: 100%;
                background-color: rgba(255, 255, 255, 1.0);
                box-shadow : 0px 0px 0px 10px rgba(255, 255, 255, 0.5);
                overflow: hidden;
                transition: visibility 0.3s ease;
            }
            #reader-content {
                font-family: Quantico;
                font-size: 14pt;
                line-height: 18pt;
                height: 100%;
                overflow-y: scroll;
                overscroll-behavior: contain; 
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .featured-image, .double-border {
                max-width: 800px;
                border: 10px solid #ffff00;
                box-shadow: 0px 0px 0px 10px #ff0000;
                border-radius: 24px;
                margin: 10px;
            }
            .featured-image-wrapper {
                margin-top: 20px;
            }
            .date-header {
                display: inline-block;
                font-weight: 900;
                font-size: 24pt;
                line-height: 24pt;
                color: #ffffff;
                background-color: #ff0000;
                padding: 5px 20px;
                position: relative;
                top: -10px;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;        
            }
            h1 {
                font-weight: 900;
                font-size: 28pt;
                line-height: 28pt;
            }
            .image-caption {
                font-size: 8pt;
                display: inline-block;
                writing-mode: vertical-rl;
                text-orientation: sideways;
            }
            p {
                width: 100%;
                max-width: 840px;
                margin: 10px auto 10px auto;
            }
            ul, ol {
                max-width: 840px;
                width: 100%;
            }
            #close img {
                width: 40px;
                position: absolute;
                right: 20px;
                top: 50px;
                z-index: 3;
                padding: 10px;
                background-color: #ffffff;
                border-radius: 50%;

            }
            #loading {
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 150px;
            }
            .medium-img {
                width: 600px;
            }
            .medium-small-img {
                width: 300px;
            }
            .small-img {
                width: 125px;
            }
            .footer {
                width: 100%;
                min-height: 100px;
                background-image: url(images/icon-multicolor.png);
                background-position: center;
                background-size: 50px;
                background-repeat: no-repeat;
            }
            .space-before {
                margin-top: 30px;
            }
            .arrow {
                position:relative;
                top:-15px;
                margin-right:-10px;
                border: solid black;
                border-width: 0 3px 3px 0;
                display: inline-block;
                padding: 3px;
            }
            .right {
                transform: rotate(-45deg);
                -webkit-transform: rotate(-45deg);
            }

            .left {
                transform: rotate(135deg);
                -webkit-transform: rotate(135deg);
            }
            .up {
                transform: rotate(-135deg);
                -webkit-transform: rotate(-135deg);
            }
            .down {
                transform: rotate(45deg);
                -webkit-transform: rotate(45deg);
            }
            .caption-box {
                margin-top:10px;
                padding:20px;
                border:1px dotted #444444;
                background:#ffffef;
            }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="blocker"></div>
        <div id="container">
        <img id="icon" src="${_common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/images/default-backgrounds/0.png"/>
        </div>
        <div id="reader">
        <div id="close"><img src="${_common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/images/close-black.svg"/></div>
        <div id="reader-content">
        <div id="loading" class="pulse">üß∂</div>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'icon', 'src', 'max-width', 'anchor', 'label', 'external-link'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.reader = this.shadowRoot.querySelector('#reader');
        this.blocker = this.shadowRoot.querySelector('#blocker');
        this.close = this.shadowRoot.querySelector('#close');
        this.anchor = null;
        this.label = '';
        this.src = null;
        this.icon = `${_common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/images/default-backgrounds/0.png`;
        this.readerOpen = false;
    }
  
    setup = () => {
        this.observedMessages = ['scrapbook'];
        this.subscribe(this.observedMessages);   
        this.container.addEventListener('click', this.handleClick);
        this.close.addEventListener('click', this.handleClick);
        this.shadowRoot.querySelector('#icon').src = this.icon;
        this.addEventListener('scrapbook', this.handleExternalMessage);
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
        this.container.removeEventListener('click', this.handleClick);
        this.removeEventListener('scrapbook', this.handleExternalMessage);
        this.close.removeEventListener('click', this.handleClick);
    }

    handleClick = (evt) => {
        evt.preventDefault();
        evt.stopPropagation();
        if (this.externalLink) {
            console.log('Send user to ' + this.externalLink);
        }
        if (this.readerOpen) {
            this.closeScrapbook();
        } else {
            this.openScrapbook();
        }
    }

    handleExternalMessage = (evt) => {
        if (!this.anchor || !evt.detail.content) return;
        console.log('checking ' + this.anchor + ' vs. ' + evt.detail.content);
        // responds to an open-scrapbook event targeting this anchor
        if (evt.detail.cmd === 'open') {
            if (evt.detail.content === this.anchor) {
                this.scrollIntoView({
                    behavior: 'smooth', 
                    block: 'start'     
                });
                this.focus();
                this.openScrapbook();
            }
        }
        if (evt.detail.cmd === 'close') {
            if (evt.detail.content === this.anchor) {
                this.closeScrapbook();
            }
        }
    }

    openScrapbook = () => {
        this.readerOpen = true;
        this.reader.style.display = 'block';
        this.reader.style.visibility = 'visible';
        this.blocker.style.display = 'block';
        this.fetchScrapbook();
        this.container.classList.add('selected');
        
    }

    closeScrapbook = () => {
        this.readerOpen = false;
        this.reader.style.display = 'none';
        this.reader.style.visibility = 'hidden';
        this.blocker.style.display = 'none';
        this.shadowRoot.querySelector('#reader-content').innerHTML = `<div id="loading" class="pulse">üß∂</div>`;
        this.container.classList.remove('selected');
    }

    fetchScrapbook = () => {
        // Fetch the scrapbook
        if (this.src) {
            fetch(
                this.src,
                { 
                    method: "GET", 
                    headers: { "Content-Type": "text/plain", "pragma": "no-cache", "cache-control": "no-cache" }
                }
            )
            .then(response => response.text())
            .then(text => {
                this.shadowRoot.querySelector('#reader-content').innerHTML = text;
            })
            .catch(error => {
                console.warn(error);
            });
        }
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'icon') {
            this.icon = newValue;
        }
        if (name === 'src') {
            this.src = newValue;
        }
        if (name === 'max-width') {
            this.maxWidth = parseInt(newValue, 10);
        }
        if (name === 'anchor') {
            this.anchor = newValue;
        }
        if (name === 'label') {
            this.label = newValue;
        }
        if (name === 'external-link') {
            this.externalLink = newValue;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gadgets/index.js"
/*!******************************************************************!*\
  !*** ../../core/web-components/custom-elements/gadgets/index.js ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _ravel_gadget_ravel_gadget_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ravel-gadget/ravel-gadget.js */ "../../core/web-components/custom-elements/gadgets/ravel-gadget/ravel-gadget.js");


/***/ },

/***/ "../../core/web-components/custom-elements/gadgets/ravel-gadget/ravel-gadget.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gadgets/ravel-gadget/ravel-gadget.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelGadget_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelGadget.js */ "../../core/web-components/custom-elements/gadgets/ravel-gadget/src/RavelGadget.js");
/*
Defines the custom element <ravel-gadget>
*/



customElements.define('ravel-gadget', _src_RavelGadget_js__WEBPACK_IMPORTED_MODULE_0__.RavelGadget);


/***/ },

/***/ "../../core/web-components/custom-elements/gadgets/ravel-gadget/src/RavelGadget.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gadgets/ravel-gadget/src/RavelGadget.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelGadget: () => (/* binding */ RavelGadget)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");




class RavelGadget extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            max-width: 500px;
            background-color: #ffffff;
        }
        #content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 460px;
            justify-content: space-around;
        }
        #connect-icon {
            font-size: 48px;
            width: 70px;
            height: 70px;
            text-align: center;
        }
        #uid {
            font-size: 24px;
        }
        #send, #send-button, #receive {
            width: 150px;
        }
        #local-controls-container {
            width: 120%;
            display: flex;
			justify-content: space-between;
			align-items: center;
		    font-size: 14px;
            position: relative;
            bottom: -80px;
            background-color: #ffffff;
            padding: 10px;
            border: 5px solid #eeeeee;
            border-radius: 20px;
        }
        #manual-comms {
            display: none;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <ravel-assembly id="gadget-assembly" show-controls="false">
        <div id="container">
        <div id="connect-icon">üì†</div>
        <div id="content">
        <slot></slot>
        <div id="manual-comms">
        <input type="text" width="20" id="send"/>
        <button id="send-button">Send</button>
        <textarea cols="20" rows="1" id="receive"></textarea>
        </div>
        </div>
        <div id="uid"></div>
        <div id="local-controls-container">
            <div id="signals-in" class="control">‚≠ï</div>
            <div id="signals-out" class="control">‚≠ï</div>
            <!--<div id="streams" class="control">‚≠ï</div>-->
        </div>
        </div>

        </ravel-assembly>
                
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'type', 'uid'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html
            + this.constructor.baseStyles;  
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.advFilterList = [ { namePrefix: 'Ravel' } ];
        this.type = "ble";
        this.usbConnected = false;
        this.dockTarget = '';
        this.docked = true;
        this.icon = 'üìü';
        this.label = 'gadget';
        this.uid = '000000';
    }
  
    setup = () => {
        this.observedMessages = [`${this.label}`];
        this.subscribe(this.observedMessages);   
        if (this.type === 'ble') {
            this.shadowRoot.querySelector('#connect-icon').addEventListener('click', this.connectBle);
        }
        if (this.type === 'serial') {
            this.service = new WebSerialPort();
            if (this.service) {
                console.log('!!!!');
                this.service.on("ravel-gadget-data", this.serialRead);
            }
            this.shadowRoot.querySelector('#connect-icon').addEventListener('click', this.connectSerial);
        }
        this.shadowRoot.querySelector('#send-button').addEventListener('click', this.sendButton);
        this.addEventListener(`${this.label}`, this.handleEvents);
        if (this.label) this.shadowRoot.querySelector('#gadget-assembly').setAttribute('label', this.label);
        if (this.icon) this.shadowRoot.querySelector('#gadget-assembly').setAttribute('icon', this.icon);
        if (this.uid) this.shadowRoot.querySelector('#uid').innerHTML = this.uid;
        if (this.docked) this.shadowRoot.querySelector('#gadget-assembly').setAttribute('docked', true);
        console.log('gadet is docked ' + this.docked);
        if (this.dockTarget) this.shadowRoot.querySelector('#gadget-assembly').setAttribute('dock-target', this.dockTarget);
    }
    
    teardown = () => {
       this.unsubscribe(this.observedMessages);
       this.shadowRoot.querySelector('#connect-icon').removeEventListener('click', this.connect);
    }

    handleEvents = (evt) => {
        console.log(evt);
        if (evt.detail.cmd === 'maximize') this.shadowRoot.querySelector('#gadget-assembly').maximize();
    }

    connectBle = () => {
        console.log('connect-ble!');
		navigator.bluetooth.requestDevice({ 
			filters: this.advFilterList,
            optionalServices: [ 0xff00 ]   // All Ravel BLE Gadgets will have this service
			//acceptAllDevices: true       // To show all Bluetooth devices (comment out filters)
        })
        .then(device => {
             this.device = device;
             this.device.addEventListener('gattserverdisconnected', this.onDisconnected);
             return this.device.gatt.connect();
        })
        .then(server => server.getPrimaryService(0xff00))
        .then(service => service.getCharacteristics())
        .then(characteristics => this.subscribeToCharacteristics(characteristics))
        .then(() => {
            this.setConnectedStatus(true);
        })
        .catch(error => console.log('Connection failed!', error));
    }

    connectSerial = async () => {
        console.log('connect!');

        if (!this.usbConnected) {
            if (!this.service.port) {
                this.usbConnected = true;
                await this.service.openPort();
                if (this.service.port) this.setConnectedStatus(true);
            } 
        } else {
            this.usbConnected = false;
            if (this.service.port) {
                await this.service.closePort();
            } 
            this.setConnectedStatus(false);
        }
    }

    setConnectedStatus = (connected) => {
        if (connected) {
            this.shadowRoot.querySelector('#gadget-assembly').setAttribute('border-color', '#00ff00');
        } else {
            this.shadowRoot.querySelector('#gadget-assembly').setAttribute('border-color', '#eeeeee');
        }
    }

    subscribeToCharacteristics = (characteristics) => {
        for (let char of characteristics) {
            console.log(char.uuid);
            if (char.uuid.includes('fff1')) {
                this.writeCharacteristic = char;
            }
            if (char.uuid.includes('fff2')) {
                this.readCharacteristic = char;
                this.readCharacteristic.addEventListener('characteristicvaluechanged', this.readData);
                this.readCharacteristic.startNotifications();
            }
        }       
    }

    onDisconnected = (evt) => {
		this.writeCharacteristic = null;
		this.readCharacteristic = null;
        this.setConnectedStatus(false);
	     if (this.device) {
             this.device.removeEventListener('gattserverdisconnected', this.onDisconnected);
             if (this.device.gatt.connected) {
		        this.device.gatt.disconnect();
                this.device = null;
    		} 
        }
	}

    readData = (event, error) => {
        // FIXME: Also report the Uid and port from which the data came
        if (error) {
            console.log('error: ', error);
            return;
        }
        let valueToRead = event.target.value.getUint8(0);
        this.shadowRoot.querySelector('#receive').innerHTML = 'value: ' + valueToRead;
    }

    writeData = (data) => {
        // FIXME: Also send the Uid and the port that the signal triggered
        if (this.device && this.device.gatt.connected) {
            let valueToSend = Uint8Array.of(data);
            if (this.writeCharacteristic) {
                console.log('sending ' + valueToSend);
                this.writeCharacteristic.writeValue(valueToSend);
            }
        }
    }

    sendButton = () => {
        this.writeData(this.shadowRoot.querySelector('#send').value);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'type') {
            this.type = newValue;
            console.log(this.type);
        }
        if (name === 'docked') {
            this.docked = true;
            console.log('docked' + this.docked);
        }
        if (name === 'dock-target') {
            this.dockTarget = newValue;
            console.log('target' + this.dockTarget);
        }
        if (name === 'uid') {
            this.uid = newValue;
        }
    }
}

class WebSerialPort {
    incomingSerialMessage = [];

    constructor() {
        // if webserial doesn't exist, return false:
        if (!navigator.serial) {
            alert("WebSerial is not enabled in this browser");
            return false;
        }
        this.autoOpen = true;
        //this.serialConnectCallback = this.serialConnect.bind(this);
        //this.serialDisconnectCallback = this.serialDisconnect.bind(this);
        this.port;
        this.reader;
        this.serialReadPromise;
        this.incoming = {
            data: null
        }
        // incoming serial data event:
        this.dataEvent = new CustomEvent('ravel-gadget-data', {
            detail: this.incoming,
            bubbles: true
        });

        // Note: Not currently implemented
        //navigator.serial.addEventListener("connect", this.serialConnectCallback);
        //navigator.serial.addEventListener("disconnect", this.serialDisconnectCallback);

        // Add the handler from the calling script as an event listener
        this.on = (message, handler) => {
            parent.addEventListener(message, handler);
        };
    }

    async openPort(thisPort) {
        try {
            if (thisPort == null) {
                // pop up window to select port:
                this.port = await navigator.serial.requestPort(
                    { filters: [ 
                    { // nrf52 default
                        usbVendorId: 0x2886,
                        usbProductId: 0x8045
                    },
                    { // esp32 default
                        usbVendorId: 0x303A,
                        usbProductId: 0x1001
                    }
                ] } 
                );
            } else {
                // open the port that was passed:
                this.port = thisPort;
            }
            // set port settings and open it:
            await this.port.open({ baudRate: 115200 });
            this.serialReadPromise = this.listenForSerial();

        } catch (err) {
            console.error("There was an error opening the serial port:", err);
        }
    }

    async closePort() {
        if (this.port) {
            // stop the reader, so you can close the port:
            this.reader.cancel();
            // wait for the listenForSerial function to stop:
            await this.serialReadPromise;
            // close the serial port itself:
            await this.port.close();
            // clear the port variable:
            this.port = null;
        }
    }

    async sendBytes(data) {
        // Data is a string here, for example "0801"
        // if there's no port open, skip this function:
        if (!this.port) return;
        // if the port's writable: 
        if (this.port.writable) {
            // initialize the writer:
            const writer = this.port.writable.getWriter();
            // convert the data to be sent to an array:
            let output = new TextEncoder().encode(data);  // This sends as ascii
            //let output = new Uint8Array(data.match(/../g).map(byte => parseInt(byte, 16)));
            // send it, then release the writer:
            writer.write(output).then(writer.releaseLock());
        }
    }

    async listenForSerial() {
        // if there's no serial port, return:
        if (!this.port) return;
        // while the port is open:
        while (this.port.readable) {
            // initialize the reader:
            this.reader = this.port.readable.getReader();
            try {
                // read incoming serial buffer:
                const { value, done } = await this.reader.read();
                if (done) {
                    break;
                }
                if (value) {
                    for (const byte of value) {
                        if (byte === 10) {   // 10 === newline
                            // Process complete message
                            //console.log("Full message:", this.incomingSerialMessage);
                            this.incoming.data = new Uint8Array(this.incomingSerialMessage);
                            // fire the event:
                            parent.dispatchEvent(this.dataEvent);
                            this.incomingSerialMessage = []; // Reset for next message
                        } else {
                            this.incomingSerialMessage.push(byte);
                        }
                    }
                }
            } catch (error) {
                // if there's an error reading the port:
                console.log(error);
            } finally {
                this.reader.releaseLock();
            }
        }
    }

    // this event occurs every time a new serial device
    // connects via USB:
    /*serialConnect(event) {
        console.log('serialConnect callback triggered');
        console.log(event.target);
        if (self.autoOpen) {
            self.openPort(event.target);
        }
    }

    // this event occurs every time a new serial device
    // disconnects via USB:
    serialDisconnect(event) {
        console.log('serialDisconnect callback triggered');
        console.log(event.target);
    }
        */
}

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/index.js"
/*!******************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/index.js ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _ravel_blockly_ravel_blockly_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ravel-blockly/ravel-blockly.js */ "../../core/web-components/custom-elements/gidgets/ravel-blockly/ravel-blockly.js");
/* harmony import */ var _ravel_button_ravel_button_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ravel-button/ravel-button.js */ "../../core/web-components/custom-elements/gidgets/ravel-button/ravel-button.js");
/* harmony import */ var _ravel_circular_sequence_ravel_circular_sequence_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ravel-circular-sequence/ravel-circular-sequence.js */ "../../core/web-components/custom-elements/gidgets/ravel-circular-sequence/ravel-circular-sequence.js");
/* harmony import */ var _ravel_crossfade_background_ravel_crossfade_background_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ravel-crossfade-background/ravel-crossfade-background.js */ "../../core/web-components/custom-elements/gidgets/ravel-crossfade-background/ravel-crossfade-background.js");
/* harmony import */ var _ravel_cgol_grid_ravel_cgol_grid_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ravel-cgol-grid/ravel-cgol-grid.js */ "../../core/web-components/custom-elements/gidgets/ravel-cgol-grid/ravel-cgol-grid.js");
/* harmony import */ var _ravel_carousel_ravel_carousel_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ravel-carousel/ravel-carousel.js */ "../../core/web-components/custom-elements/gidgets/ravel-carousel/ravel-carousel.js");
/* harmony import */ var _ravel_crank_ravel_crank_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ravel-crank/ravel-crank.js */ "../../core/web-components/custom-elements/gidgets/ravel-crank/ravel-crank.js");
/* harmony import */ var _ravel_dock_ravel_dock_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ravel-dock/ravel-dock.js */ "../../core/web-components/custom-elements/gidgets/ravel-dock/ravel-dock.js");
/* harmony import */ var _ravel_emoji_grid_ravel_emoji_grid_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ravel-emoji-grid/ravel-emoji-grid.js */ "../../core/web-components/custom-elements/gidgets/ravel-emoji-grid/ravel-emoji-grid.js");
/* harmony import */ var _ravel_field_recorder_ravel_field_recorder_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ravel-field-recorder/ravel-field-recorder.js */ "../../core/web-components/custom-elements/gidgets/ravel-field-recorder/ravel-field-recorder.js");
/* harmony import */ var _ravel_fluxum_ravel_fluxum_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./ravel-fluxum/ravel-fluxum.js */ "../../core/web-components/custom-elements/gidgets/ravel-fluxum/ravel-fluxum.js");
/* harmony import */ var _ravel_fluxly_sound_engine_ravel_fluxly_sound_engine_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ravel-fluxly-sound-engine/ravel-fluxly-sound-engine.js */ "../../core/web-components/custom-elements/gidgets/ravel-fluxly-sound-engine/ravel-fluxly-sound-engine.js");
/* harmony import */ var _ravel_lcd_ravel_lcd_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./ravel-lcd/ravel-lcd.js */ "../../core/web-components/custom-elements/gidgets/ravel-lcd/ravel-lcd.js");
/* harmony import */ var _ravel_led_ravel_led_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ravel-led/ravel-led.js */ "../../core/web-components/custom-elements/gidgets/ravel-led/ravel-led.js");
/* harmony import */ var _ravel_led_array_ravel_led_array_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ravel-led-array/ravel-led-array.js */ "../../core/web-components/custom-elements/gidgets/ravel-led-array/ravel-led-array.js");
/* harmony import */ var _ravel_menu_ravel_menu_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ravel-menu/ravel-menu.js */ "../../core/web-components/custom-elements/gidgets/ravel-menu/ravel-menu.js");
/* harmony import */ var _ravel_pot_ravel_pot_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./ravel-pot/ravel-pot.js */ "../../core/web-components/custom-elements/gidgets/ravel-pot/ravel-pot.js");
/* harmony import */ var _ravel_p5_canvas_ravel_p5_canvas_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ravel-p5-canvas/ravel-p5-canvas.js */ "../../core/web-components/custom-elements/gidgets/ravel-p5-canvas/ravel-p5-canvas.js");
/* harmony import */ var _ravel_physics_world_ravel_physics_world_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./ravel-physics-world/ravel-physics-world.js */ "../../core/web-components/custom-elements/gidgets/ravel-physics-world/ravel-physics-world.js");
/* harmony import */ var _ravel_progressive_composition_ravel_progressive_composition_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./ravel-progressive-composition/ravel-progressive-composition.js */ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition/ravel-progressive-composition.js");
/* harmony import */ var _ravel_progressive_composition_2_ravel_progressive_composition_2_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ravel-progressive-composition-2/ravel-progressive-composition-2.js */ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition-2/ravel-progressive-composition-2.js");
/* harmony import */ var _ravel_recorder_ravel_recorder_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ravel-recorder/ravel-recorder.js */ "../../core/web-components/custom-elements/gidgets/ravel-recorder/ravel-recorder.js");
/* harmony import */ var _ravel_sequencer_ravel_sequencer_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./ravel-sequencer/ravel-sequencer.js */ "../../core/web-components/custom-elements/gidgets/ravel-sequencer/ravel-sequencer.js");
/* harmony import */ var _ravel_slider_ravel_slider_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ravel-slider/ravel-slider.js */ "../../core/web-components/custom-elements/gidgets/ravel-slider/ravel-slider.js");
/* harmony import */ var _ravel_slider_2_ravel_slider_2_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./ravel-slider-2/ravel-slider-2.js */ "../../core/web-components/custom-elements/gidgets/ravel-slider-2/ravel-slider-2.js");
/* harmony import */ var _ravel_switch_ravel_switch_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./ravel-switch/ravel-switch.js */ "../../core/web-components/custom-elements/gidgets/ravel-switch/ravel-switch.js");
/* harmony import */ var _ravel_tally_grid_ravel_tally_grid_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./ravel-tally-grid/ravel-tally-grid.js */ "../../core/web-components/custom-elements/gidgets/ravel-tally-grid/ravel-tally-grid.js");
/* harmony import */ var _ravel_touch_pad_ravel_touch_pad_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ravel-touch-pad/ravel-touch-pad.js */ "../../core/web-components/custom-elements/gidgets/ravel-touch-pad/ravel-touch-pad.js");
/* harmony import */ var _ravel_visualizer_1_ravel_visualizer_1_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./ravel-visualizer-1/ravel-visualizer-1.js */ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-1/ravel-visualizer-1.js");
/* harmony import */ var _ravel_visualizer_2_ravel_visualizer_2_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ravel-visualizer-2/ravel-visualizer-2.js */ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-2/ravel-visualizer-2.js");































/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-blockly/ravel-blockly.js"
/*!****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-blockly/ravel-blockly.js ***!
  \****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelBlockly_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelBlockly.js */ "../../core/web-components/custom-elements/gidgets/ravel-blockly/src/RavelBlockly.js");

/*
Defines the custom element <ravel-blockly>
*/



customElements.define('ravel-blockly', _src_RavelBlockly_js__WEBPACK_IMPORTED_MODULE_0__.RavelBlockly);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-blockly/src/RavelBlockly.js"
/*!*******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-blockly/src/RavelBlockly.js ***!
  \*******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelBlockly: () => (/* binding */ RavelBlockly)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");




class RavelBlockly extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {

    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'signals', 'signal-out'];
    }

    constructor() {
        super();
        this.initialize();
    }

    initialize() {
        this._workspace = null;
        this._container = null;
        this._resizeObserver = null;
        this.signals = [];
    }

    connectedCallback() {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.subscribe(this.signals);  

        // Avoid re-init if reconnected
        if (this._workspace) return;

        // Make sure the host can size itself
        if (!this.style.display) {
            this.style.display = 'block';
            this.style.width = '100%';
            this.style.height = '100%';
        }
        if (!this.style.position) {
            this.style.position = 'relative';
        }

        // Create the div that Blockly will own
        const container = document.createElement('div');
        container.className = 'ravel-blockly-container';
        Object.assign(container.style, {
            position: 'absolute',
            inset: '0',        // top:0; right:0; bottom:0; left:0

        });

        this.appendChild(container);
        this._container = container;

        // Build a simple no-category, horizontal, bottom toolbox
        const toolbox = this._buildToolbox();

        this._workspace = Blockly.inject(container, {
            toolbox,
            theme: Blockly.Themes.Zelos,
            renderer: 'zelos',
            horizontalLayout: true,
            toolboxPosition: 'end',
            scrollbars: false,
            trashcan: false
        });

        // Keep Blockly SVG in sync with element size
        this._resizeObserver = new ResizeObserver(() => {
        if (this._workspace) {
            Blockly.svgResize(this._workspace);
        }
        });
        this._resizeObserver.observe(this);
    }

    disconnectedCallback() {
        if (this._resizeObserver) {
        this._resizeObserver.disconnect();
        this._resizeObserver = null;
        }
        if (this._workspace) {
        this._workspace.dispose();
        this._workspace = null;
        }
        this._container = null;
        // Optionally clear children:
        // this.innerHTML = '';
    }

    _buildToolbox() {
        // Flat ‚Äúcontinuous‚Äù toolbox, horizontal at bottom
        return {
            kind: 'flyoutToolbox',
            contents: [
                { kind: 'block', type: 'controls_if' },
                { kind: 'block', type: 'logic_compare' },
                { kind: 'block', type: 'math_number' },
                { kind: 'block', type: 'text' },
                { kind: 'block', type: 'text_print' },
                // Add your music / custom blocks here
            ],
        };
    }

  // --- Public API helpers ---

  /** Get underlying Blockly workspace */
  get workspace() {
    return this._workspace;
  }

  /** Example: generate JS code (requires javascript generator scripts) */
  getCode() {
    if (!this._workspace || !Blockly.JavaScript) return '';
    return Blockly.JavaScript.workspaceToCode(this._workspace);
  }

  /** Clear workspace programmatically */
  clear() {
    if (this._workspace) {
      this._workspace.clear();
    }
  }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-button/ravel-button.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-button/ravel-button.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelButton_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelButton.js */ "../../core/web-components/custom-elements/gidgets/ravel-button/src/RavelButton.js");

/*
Defines the custom element <ravel-button>
*/



customElements.define('ravel-button', _src_RavelButton_js__WEBPACK_IMPORTED_MODULE_0__.RavelButton);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-button/src/RavelButton.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-button/src/RavelButton.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelButton: () => (/* binding */ RavelButton)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");




class RavelButton extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #button-background {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #sensor {
            position: absolute;
            border-radius: 24px;
        }
        .pixelArt {
            position: absolute;
        }
        .transparent {
            background-color: rgba(255, 255, 255, 0);
        }
        .light-pixel {
            background-color: #aaaaaa;
        }
        .dark-pixel {
            background-color: #000000;
        }
        .color-pixel {
            background-color: #FFFF00;
        }
        #shadow {
            opacity: 0.5;
            background-color: #000000;
        }
        #button-image img {
            margin-left: 20%;
            margin-top: 15%;
            width: 60%;
            height: 60%;
        }
        #handle-container {
            position: absolute;
        }
            @-webkit-keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        @keyframes pulse {
          to {
            -webkit-transform: scale(.8);
            transform: scale(.8);
          }
        }
        .pulse {
          display: inline-block;
          vertical-align: middle;
          -webkit-transform: perspective(1px) translateZ(0);
          transform: perspective(1px) translateZ(0);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0);
         -webkit-animation-name: pulse;
          animation-name: pulse;
          -webkit-animation-duration: 0.1s;
          animation-duration: 0.1s;
          -webkit-animation-timing-function: linear;
          animation-timing-function: linear;
          -webkit-animation-iteration-count: infinite;
          animation-iteration-count: infinite;
          -webkit-animation-direction: alternate;
          animation-direction: alternate;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="sensor"></div>
        <div id="button-background">
            <div id="top-side" class="dark-pixel pixelArt"></div>
            <div id="left-side" class="dark-pixel pixelArt"></div>
            <div id="right-side" class="dark-pixel pixelArt"></div>
            <div id="bottom-side" class="dark-pixel pixelArt"></div>            
            <div id="center" class="light-pixel pixelArt">
                    <div id="button-image"></div>
            </div>
            <div id="shadow" class="pixelArt"></div>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'size', 'w', 'h', 'image',
            'color', 'pixel-size', 'margin',
            'value', 'signals', 'signal-out'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.buttonBackground = this.shadowRoot.querySelector('#button-background');
        this.sensor = this.shadowRoot.querySelector('#sensor');
        this.signals = [];
        this.value = 0;
        this.noClick = false;
        this.showFeedback = false;
        this.x = 0;
        this.y = 0;
        this.width = 50;
        this.height = 50;
        this.pixelSize = 20;
        this.image = null;
        this.offsetX = 0;
        this.offsetY = 0;
        this.margin = 0;
        this.color = '#ff0000';
    }
  
    setup = () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.subscribe(this.signals);  
        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style.width = `${this.width}px`;
        this.container.style.height = `${this.height}px`;
        this.buildButton();

        this.sensor.style.width = `${this.width + this.pixelSize * 2}px`;
        this.sensor.style.height = `${this.height + this.pixelSize * 2}px`;

        if (this.image) {
            this.shadowRoot.querySelector('#button-image').innerHTML = `<img src="${_common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/${this.image}"/>`;
            console.log(`<img src="${_common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/${this.image}/>`);
        }

        this.shadowRoot.querySelector('#center').style.backgroundColor = this.color;
        //const rect = this.container.getBoundingClientRect();
        //this.centerX = rect.left + rect.width / 2;
        //this.centerY = rect.top + rect.height / 2;
        if (!this.noClick) {
            this.addEventListener('pointerdown', this.handleClick);
        }
        this.addEventListener(`${this.id}`, this.handleEvent);
        //this.broadcastMessage('register-sensor', this.id, { x: rect.x, y: rect.y, w: this.w, h: this.height });
        this.broadcastMessage('register-sensor', this.id, this.container);
        
    }

    handleClick = (e) => {
        e.preventDefault();
        // Update center values dynamically in case layout shifted
        this.calculateValue(e.clientX);
        this.container.classList.add('pulse');
        setTimeout(() => {
            this.container.classList.remove('pulse');
        }, 200);
        document.addEventListener('pointermove', this.dragElement);
        document.addEventListener('pointerup', this.endDragElement);
        document.addEventListener('pointerleave', this.endDragElement);
    }

    dragElement = (e) => {
        e.preventDefault();
        this.calculateValue(e.clientX + this.offsetX);
    }

    endDragElement = () => {
        document.removeEventListener('pointermove', this.dragElement);
        document.removeEventListener('pointerup', this.endDragElement);
        document.removeEventListener('pointerleave', this.endDragElement);
    }

    handleEvent = (e) => {
        e.preventDefault();
        const type = e.detail.cmd;
        console.log(type);
        if (type === 'select') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 0, 0.5)';
        }
        if (type === 'unselect') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 255, 0)';
        }
        if (type === 'virtual-click') {
            this.offsetX = Number(e.detail.content.offsetX);
            this.offsetX = Number(e.detail.content.offsetY);
            const rect = this.container.getBoundingClientRect();
            this.calculateValue(e.clientX - rect.x);
            this.container.classList.add('pulse');
            setTimeout(() => {
                this.container.classList.remove('pulse');
            }, 200);
            document.addEventListener('pointermove', this.dragElement);
            document.addEventListener('pointerup', this.endDragElement);
            document.addEventListener('pointerleave', this.endDragElement);
        }
        if (type === 'virtual-drag') {
            this.calculateValue(e.clientX, e.clientY);
        }
        if (type === 'virtual-release') {
            this.offsetX = 0;
            this.offsetY = 0;
            document.removeEventListener('pointermove', this.dragElement);
            document.removeEventListener('pointerup', this.endDragElement);
            document.removeEventListener('pointerleave', this.endDragElement);
        }
    }

    
    teardown = () => {
        this.unsubscribe(this.signals);
        this.broadcastMessage('register-sensor', this.id);
        if (!this.noClick) {
            this.removeEventListener('pointerdown', this.handleClick);
        }
        this.removeEventListener(`${this.id}`, this.handleEvent);
    }
    
    calculateValue = (x, y) => {
    }

    buildButton = () => {
        let innerW = this.width - this.pixelSize * 2;
        let innerH = this.height - this.pixelSize * 2;
        let centerW = innerW - this.margin * 2;
        this.innerMax = centerW - this.margin;

        console.log(`${innerW} ${innerH}`);
        this.setPixelDimensions('top-side', innerW, this.pixelSize);
        this.setPixelDimensions('left-side', this.pixelSize, innerH);
        this.setPixelDimensions('bottom-side', innerW, this.pixelSize);
        this.setPixelDimensions('right-side', this.pixelSize, innerH );
        this.setPixelDimensions('center', centerW, innerH);
        this.setPixelDimensions('shadow', innerW, this.pixelSize);

        this.setPixelPosition('top-side', this.pixelSize, 0);
        this.setPixelPosition('left-side', 0, this.pixelSize);
        this.setPixelPosition('bottom-side', this.pixelSize, innerH + this.pixelSize);
        this.setPixelPosition('right-side', innerW + this.pixelSize, this.pixelSize);
        this.setPixelPosition('center', this.margin + this.pixelSize, this.pixelSize);
        this.setPixelPosition('shadow', this.pixelSize, innerH);
    }

    setPixelDimensions = (id, w, h) => {
        this.shadowRoot.querySelector(`#${id}`).style.width = `${w}px`;
        this.shadowRoot.querySelector(`#${id}`).style.height = `${h}px`;
    }

    setPixelPosition = (id, x, y) => {
        this.shadowRoot.querySelector(`#${id}`).style.top = `${y}px`;
        this.shadowRoot.querySelector(`#${id}`).style.left = `${x}px`;
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.y = Number(newValue);
        }
        if (name === 'src') {
            this.src = newValue;
        }
        if (name === 'image') {
            this.image = newValue;
        }
        if (name === 'w') {
            this.width = Number(newValue);
            console.log(this.width);
        }
        if (name === 'h') {
            this.height = Number(newValue);
            console.log(this.height);
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'value') {
            this.value = Number(newValue);
        }
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'show-feedback') {
            this.showFeedback = true;
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'pixel-size') {
            this.pixelSize = Number(newValue);
        }
        if (name === 'margin') {
            this.margin = Number(newValue);
        }
    }

    map = (val, in_min, in_max, out_min, out_max) => {
        return (val - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-carousel/ravel-carousel.js"
/*!******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-carousel/ravel-carousel.js ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelCarousel_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelCarousel.js */ "../../core/web-components/custom-elements/gidgets/ravel-carousel/src/RavelCarousel.js");
/*
Defines the custom element <ravel-carousel>
*/



customElements.define('ravel-carousel', _src_RavelCarousel_js__WEBPACK_IMPORTED_MODULE_0__.RavelCarousel);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-carousel/src/RavelCarousel.js"
/*!*********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-carousel/src/RavelCarousel.js ***!
  \*********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelCarousel: () => (/* binding */ RavelCarousel)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");




// RavelCarousel.js
// Assumes you already have: RavelElement, globalStyles in scope/imported.

class RavelCarousel extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
  static get localStyles() {
    return `
      <style>
        :host {
          display: block;
          --gap: 12px;
          --pad: 12px;
          --btn-size: 60px;
          --btn-bg: rgba(0,0,0,0.55);
          --btn-fg: white;
          --btn-radius: 999px;
          --fade-width: 28px;
          --snap: 1; /* set to 0 to disable scroll-snap */
          position: relative;
          box-sizing: border-box;
        }

        .wrap {
          position: relative;
          box-sizing: border-box;
          padding: var(--pad);
        }

        .viewport {
          position: relative;
          overflow-x: auto;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
          scrollbar-gutter: stable both-edges;
          scroll-snap-type: x mandatory;
          /* allow horizontal wheel / trackpad */
          overscroll-behavior-x: contain;
          padding-bottom: 4px; /* room for scrollbar */
        }

        /* Turn off snap if --snap is 0 */
        .viewport[data-snap="0"] { scroll-snap-type: none; }

        /* The slotted items layout: flex row */
        ::slotted(*) {
          flex: 0 0 auto;
          scroll-snap-align: start;
        }

        .track {
          display: flex;
          gap: var(--gap);
          align-items: stretch;
          width: max-content;
          min-width: 100%;
          box-sizing: border-box;
        }

        /* Basic arrows */
        button.nav {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          width: var(--btn-size);
          height: var(--btn-size);
          border:none;
          font-size: 24px;
          /*
          border: 5px solid #ffff00;
          box-shadow: 0px 0px 0px 10px #ff0000;
          */
          border-radius: var(--btn-radius);
          background: var(--btn-bg);
          color: var(--btn-fg);
          cursor: pointer;
          display: grid;
          place-items: center;
          z-index: 2;
          padding: 0;
          user-select: none;
          -webkit-tap-highlight-color: transparent;
        }

        button.nav[disabled] {
          opacity: 0.35;
          cursor: default;
        }

        button.prev { left: calc(var(--pad) * 0.5); }
        button.next { right: calc(var(--pad) * 0.5); }

        /* Subtle edge fades */
        .fade {
          position: absolute;
          top: 0;
          bottom: 0;
          width: var(--fade-width);
          pointer-events: none;
          z-index: 1;
        }
        .fade.left {
          left: var(--pad);
          background: linear-gradient(to right, rgba(0,0,0,0.25), rgba(0,0,0,0));
        }
        .fade.right {
          right: var(--pad);
          background: linear-gradient(to left, rgba(0,0,0,0.25), rgba(0,0,0,0));
        }

        /* Respect reduced motion */
        @media (prefers-reduced-motion: reduce) {
          .viewport { scroll-behavior: auto; }
        }
      </style>
    `;
  }

  static get html() {
    return `
      <div class="wrap">
        <button class="nav prev" part="prev" aria-label="Scroll left" type="button">
          <span aria-hidden="true">‚Äπ</span>
        </button>

        <div class="fade left" part="fade-left"></div>
        <div class="fade right" part="fade-right"></div>

        <div class="viewport" part="viewport">
          <div class="track" part="track">
            <slot></slot>
          </div>
        </div>

        <button class="nav next" part="next" aria-label="Scroll right" type="button">
          <span aria-hidden="true">‚Ä∫</span>
        </button>
      </div>
    `;
  }

  static get observedAttributes() {
    return [
      ...super.baseObservedAttributes,
      // optional carousel controls:
      "page-size",  // "viewport" | number(px)
      "snap",       // "1" | "0"
      "arrows"      // "1" | "0"
    ];
  }

  constructor() {
    super();
    const template = document.createElement("template");
    template.innerHTML =
      _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"] + this.constructor.localStyles + this.constructor.html;

    this.attachShadow({ mode: "open" });
    this.shadowRoot.appendChild(template.content.cloneNode(true));

    this.initialize();
  }

  connectedCallback() {
    this.setup();
  }

  disconnectedCallback() {
    this.teardown();
  }

  initialize() {
    this.rows = 1;
    this.cols = 1;

    this._onPrev = () => this.scrollByPage(-1);
    this._onNext = () => this.scrollByPage(1);
    this._onScroll = () => this.updateNavState();
    this._onSlotChange = () => this.updateNavState();
    this._ro = null;
  }

  setup = () => {
    this.$viewport = this.shadowRoot.querySelector(".viewport");
    this.$prev = this.shadowRoot.querySelector(".prev");
    this.$next = this.shadowRoot.querySelector(".next");
    this.$slot = this.shadowRoot.querySelector("slot");

    this.$prev.addEventListener("click", this._onPrev);
    this.$next.addEventListener("click", this._onNext);
    this.$viewport.addEventListener("scroll", this._onScroll, { passive: true });
    this.$slot.addEventListener("slotchange", this._onSlotChange);

    // Resize observer to keep disabled/enabled state accurate on layout changes
    if ("ResizeObserver" in window) {
      this._ro = new ResizeObserver(() => this.updateNavState());
      this._ro.observe(this.$viewport);
    } else {
      window.addEventListener("resize", this.updateNavState);
    }

    this.applyAttributesToUI();
    this.updateNavState();
  };

  teardown = () => {
    if (this.$prev) this.$prev.removeEventListener("click", this._onPrev);
    if (this.$next) this.$next.removeEventListener("click", this._onNext);
    if (this.$viewport) this.$viewport.removeEventListener("scroll", this._onScroll);
    if (this.$slot) this.$slot.removeEventListener("slotchange", this._onSlotChange);

    if (this._ro) {
      this._ro.disconnect();
      this._ro = null;
    } else {
      window.removeEventListener("resize", this.updateNavState);
    }
  };

  attributeChangedCallback(name, oldValue, newValue) {
    super.attributeChangedCallback(name, oldValue, newValue);
    if (oldValue === newValue) return;

    if (name === "page-size" || name === "snap" || name === "arrows") {
      this.applyAttributesToUI();
      this.updateNavState();
    }
  }

  // ---------- Public-ish helpers ----------
  scrollByPage(direction = 1) {
    if (!this.$viewport) return;

    const pageSize = this.getPageSize();
    const left = this.$viewport.scrollLeft + direction * pageSize;
    this.$viewport.scrollTo({ left });
  }

  scrollToIndex(index = 0) {
    const items = this.getSlottedItems();
    const el = items[index];
    if (el) el.scrollIntoView({ inline: "start", block: "nearest" });
  }

  // ---------- Internals ----------
  getSlottedItems() {
    const assigned = this.$slot?.assignedElements?.({ flatten: true }) ?? [];
    return assigned.filter((n) => n && n.nodeType === 1);
  }

  getPageSize() {
    const attr = (this.getAttribute("page-size") || "viewport").trim();
    if (attr === "viewport") return this.$viewport.clientWidth;

    const n = Number(attr);
    if (Number.isFinite(n) && n > 0) return n;

    return this.$viewport.clientWidth;
  }

  applyAttributesToUI() {
    if (!this.$viewport) return;

    // snap
    const snap = this.getAttribute("snap");
    const snapOn = snap == null ? true : snap !== "0";
    this.$viewport.dataset.snap = snapOn ? "1" : "0";

    // arrows show/hide
    const arrows = this.getAttribute("arrows");
    const arrowsOn = arrows == null ? true : arrows !== "0";
    this.$prev.style.display = arrowsOn ? "" : "none";
    this.$next.style.display = arrowsOn ? "" : "none";
  }

  updateNavState = () => {
    if (!this.$viewport || !this.$prev || !this.$next) return;

    // If content doesn't overflow, disable both
    const maxScrollLeft = this.$viewport.scrollWidth - this.$viewport.clientWidth;

    // Tolerances help with subpixel rounding
    const tol = 1;

    const atStart = this.$viewport.scrollLeft <= tol;
    const atEnd = this.$viewport.scrollLeft >= maxScrollLeft - tol;
    const canScroll = maxScrollLeft > tol;

    this.$prev.disabled = !canScroll || atStart;
    this.$next.disabled = !canScroll || atEnd;

    // Optional: hide fades when not needed
    const leftFade = this.shadowRoot.querySelector(".fade.left");
    const rightFade = this.shadowRoot.querySelector(".fade.right");
    if (leftFade) leftFade.style.opacity = canScroll && !atStart ? "1" : "0";
    if (rightFade) rightFade.style.opacity = canScroll && !atEnd ? "1" : "0";
  };
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-cgol-grid/ravel-cgol-grid.js"
/*!********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-cgol-grid/ravel-cgol-grid.js ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelCgolGrid_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelCgolGrid.js */ "../../core/web-components/custom-elements/gidgets/ravel-cgol-grid/src/RavelCgolGrid.js");

/*
Defines the custom element <ravel-cgol-grid>
*/



customElements.define('ravel-cgol-grid', _src_RavelCgolGrid_js__WEBPACK_IMPORTED_MODULE_0__.RavelCgolGrid);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-cgol-grid/src/RavelCgolGrid.js"
/*!**********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-cgol-grid/src/RavelCgolGrid.js ***!
  \**********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelCgolGrid: () => (/* binding */ RavelCgolGrid)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");




class RavelCgolGrid extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
            display: grid;
            justify-content: center;
            align-items: center;
        }
        .cell img {
            width: 16px;
            height: 16px;
        }
        .visible {
            visibility: visible;
        }
        .not-visible {
            visibility: hidden; 
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="sensor">
        <div id="container">
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'images', 'rows', 'cols', 'coverage', 'angle',
            'signals', 'signal-out'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.sensor = this.shadowRoot.querySelector('#sensor');
        this.signals = [];
        this.x = 0;
        this.y = 0;
        this.rows = 4;
        this.cols = 5;
        this.width = 50;
        this.height = 50;
        this.pixelSize = 20;
        this.images = ['/images/blue-flower.png'];
        this.coverage = 30;
        this.angle = 0;
        this.playing = false;
        this.cells = [];  // 2D array for cell states
        this.count = [];  // 2D array for neighbor counts

    }
  
    setup = () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.subscribe(this.signals);  

        this.container.style.display = 'grid';
        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style.transform = `rotate(${this.angle}deg)`;
        this.container.style.gridTemplateRows = `repeat(${this.rows}, 1fr)`;
        this.container.style.gridTemplateColumns = `repeat(${this.cols}, 1fr)`;

        this.setupField();

        this.broadcastMessage('register-sensor', this.id, this.container);
        // this.broadcastMessage('register-sensor', this.id, { x: this.x + this.w/2, y: this.y + this.h/2, w: this.w, h: this.height });

        this.timer = setInterval(this.processFrame, 100);

        this.container.addEventListener('click', this.handleEvent);
    }

    handleClick = (e) => {
        e.preventDefault();
    }

    handleEvent = (e) => {
        if (!this.playing) this.playing = true;
        if ((e.target.id.includes('cell')) && !(e.target.id.includes('img'))) {
            this.shadowRoot.querySelector(`#${e.target.id}`).classList.toggle('visible', true);
            let index = 0;
            try {
                index = parseInt(e.target.id.replace('cell-', ''));
            } catch(e) {}
            console.log(index);
            console.log(this.shadowRoot.querySelector(`#${e.target.id}`));
        }
    }

    setupField = () => {
        for (let i = 0; i < this.rows; i++) {
            this.cells[i] = [];
            this.count[i] = [];

            for (let j = 0; j < this.cols; j++) {
                const index = (this.cols * i) + j;  // still useful for DOM IDs
                const cell = document.createElement('div');
                cell.classList.add('cell');
                const cellImg = document.createElement('img');
                cellImg.src = this.getRandomImage();
                cell.id = `cell-${index}`;
                cellImg.id = `cell-img-${index}`;

                const isAlive = Math.floor(Math.random() * 100) < this.coverage;

                this.cells[i][j] = isAlive;
                this.count[i][j] = 0;

                cellImg.classList.add(isAlive ? 'visible' : 'not-visible');
                cell.appendChild(cellImg);
                this.container.appendChild(cell);
            }
        }
    };
    
    processFrame = () => {
        if (!this.playing) return;

        // Step 1: Count neighbors based on *current* state
        for (let i = 0; i < this.rows; i++) {
            for (let j = 0; j < this.cols; j++) {
            this.count[i][j] = this.getNeighborCount(i, j);
            }
        }

        // Step 2: Prepare next generation
        const nextCells = [];

        for (let i = 0; i < this.rows; i++) {
            nextCells[i] = [];

            for (let j = 0; j < this.cols; j++) {
            const alive = this.cells[i][j];
            const neighbors = this.count[i][j];
            const index = i * this.cols + j;
            const cellElement = this.shadowRoot.querySelector(`#cell-img-${index}`);

            let nextState = alive;

            if (!alive && neighbors === 3) {
                nextState = true;
            } else if (alive && (neighbors < 2 || neighbors > 3)) {
                nextState = false;
            }

            nextCells[i][j] = nextState;

            if (cellElement) {
                cellElement.classList.toggle('visible', nextState);
                cellElement.classList.toggle('not-visible', !nextState);
            }
            }
        }

        // Step 3: Commit next generation
        this.cells = nextCells;
    };

    getRandomImage = () => {
        let index = Math.floor(Math.random() * this.images.length);
        return `${_common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/${this.images[index]}`;
    }

    getNeighborCount = (row, col) => {
        let count = 0;
        const directions = [
            [-1, 0],  // top
            [-1, -1], // top-left
            [-1, 1],  // top-right
            [0, -1],  // left
            [0, 1],   // right
            [1, -1],  // bottom-left
            [1, 1],   // bottom-right
            [1, 0]    // bottom
        ];

        for (let [dr, dc] of directions) {
            const r = row + dr;
            const c = col + dc;
            if (r >= 0 && r < this.rows && c >= 0 && c < this.cols) {
                if (this.cells[r][c]) count++;
            }
        }

        return count;
    }

    teardown = () => {
        this.unsubscribe(this.signals);
        this.broadcastMessage('register-sensor', this.id);
        if (!this.noClick) {
            this.removeEventListener('pointerdown', this.handleClick);
        }
        this.removeEventListener(`${this.id}`, this.handleEvent);
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'x') {
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.y = Number(newValue);
        }
        if (name === 'images') {
            this.images = newValue.split(',');
            console.log(this.images.length);
        }
        if (name === 'width') {
            this.width = Number(newValue);
        }
        if (name === 'height') {
            this.height = Number(newValue);
        }
        if (name === 'angle') {
            this.angle = parseInt(newValue, 10);
        }
        if (name === 'rows') {
            this.rows = parseInt(newValue, 10);
        }
        if (name === 'cols') {
            this.cols = parseInt(newValue, 10);
        }
        if (name === 'coverage') {
            this.coverage = parseInt(newValue, 10);
        }
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
    }

    map = (val, in_min, in_max, out_min, out_max) => {
        return (val - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-circular-sequence/ravel-circular-sequence.js"
/*!************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-circular-sequence/ravel-circular-sequence.js ***!
  \************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelCircularSequence_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelCircularSequence.js */ "../../core/web-components/custom-elements/gidgets/ravel-circular-sequence/src/RavelCircularSequence.js");
/*
Defines the custom element <ravel-circular-sequence>
*/



customElements.define('ravel-circular-sequence', _src_RavelCircularSequence_js__WEBPACK_IMPORTED_MODULE_0__.RavelCircularSequence);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-circular-sequence/src/RavelCircularSequence.js"
/*!**************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-circular-sequence/src/RavelCircularSequence.js ***!
  \**************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelCircularSequence: () => (/* binding */ RavelCircularSequence)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelCircularSequence extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: relative;
            border: 10px solid #aaaaaa;
            border-radius: 50%;
            width: 480px;
            height: 480px;
            font-size: 48px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="cursor">‚ö´Ô∏è</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        <div>üî¥</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'background', 'display-count', 'speed'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.width = 480;
        this.height = 480;
        this.centerX = this.width / 2;
        this.centerY = this.height / 2;
        this.cursorAngle = 0;
        this.cursorRadius = 180;
        this.cursorSpeed = 2000;
        this.displayCount = 16;
        this.elementRadius = 24;
        this.cursor = this.shadowRoot.querySelector('#cursor');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
        this.container.style.width = `${this.width}px`; 
        this.container.style.height = `${this.height}px`;
        for (let element of this.shadowRoot.querySelector('#container').children) {
            console.log(element);
            element.style.position = 'absolute';
            element.style.left = '0px';
            element.style.top = '0px';
            element.style['transform-origin'] = 'center'
            element.style.transform = `translate(-50%, -50%)`
        }
        this.updateDisplay();
        this.moveCursor();
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    updateDisplay = () => {
        console.log('update display');
        let children = this.shadowRoot.querySelector('#container').children;
        let anglePerDivision = 360 / this.displayCount;
        console.log(anglePerDivision);
        // cursor is always first child
        let angle = 0;
        for (let i = 1; i < children.length; i++) {
            if (i <= this.displayCount) {
                children[i].style.display = 'block';
                this.placeAtAngle(children[i], angle);
                angle += anglePerDivision;
            } else {
                children[i].style.display = 'none';
            }

        }
    }

    moveCursor = () => {
            this.cursorAngle += (2 * Math.PI) / this.cursorSpeed; // Update angle per frame (~60fps)
            const x = this.centerX + this.cursorRadius * Math.cos(this.cursorAngle);
            const y = this.centerY + this.cursorRadius * Math.sin(this.cursorAngle);
    
            this.cursor.style.left = `${x}px`;
            this.cursor.style.top = `${y}px`;
    
            requestAnimationFrame(this.moveCursor);
        }
    
    placeAtAngle = (element, angle) => {
        let radians = angle * Math.PI / 180;
        // this.centerX is the same as radius
        const x = this.centerX + (this.centerX +  + this.elementRadius / 4) * Math.cos(radians);
        const y = this.centerY + (this.centerX +  + this.elementRadius / 4) * Math.sin(radians);
        console.log(x + ' ' + y);
        element.style.left = `${x}px`;
        element.style.top = `${y}px`;
    }



    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'background') {
            this.background = newValue;
        }
        if (name === 'display-count') {
            this.displayCount = parseInt(newValue, 10);
            this.updateDisplay();
        }
        if (name === 'speed') {
            this.cursorSpeed = parseInt(newValue, 10);
        }
    }
}

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-crank/ravel-crank.js"
/*!************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-crank/ravel-crank.js ***!
  \************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelCrank_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelCrank.js */ "../../core/web-components/custom-elements/gidgets/ravel-crank/src/RavelCrank.js");

/*
Defines the custom element <ravel-crank>
*/



customElements.define('ravel-crank', _src_RavelCrank_js__WEBPACK_IMPORTED_MODULE_0__.RavelCrank);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-crank/src/RavelCrank.js"
/*!***************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-crank/src/RavelCrank.js ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelCrank: () => (/* binding */ RavelCrank)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");





class RavelCrank extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
        }
        #crank-marker, #crank-knob {
            position: relative;
        }
        #sensor {
            position: absolute;
            left: -10%;
            top: -10%;
            width: 120%;
            height: 120%;
            border-radius: 50%;
            
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="sensor"></div>
        <div id="crank-knob"></div>
        <div id="crank-marker"></div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'size', 'w', 'h', 'use-svg', 'color',
            'marker', 'icon', 'marker', 'angle', 'min', 'max',
            'value', 'signals', 'signal-out'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.potMarker = this.shadowRoot.querySelector('#crank-marker');
        this.potKnob = this.shadowRoot.querySelector('#crank-knob');
        this.sensor = this.shadowRoot.querySelector('#sensor');
        this.marker = '';
        this.icon = 'white-circle';
        this.size = 24;
        this.signals = [];
        this.value = 0;
        this.noClick = false;
        this.showFeedback = false;
        this.x = 0;
        this.y = 0;
        this.width = 50;
        this.height = 50;
        this.min = 0;
        this.max = 1;
        this.offsetX = 0;
        this.offsetY = 0;
        this.useSvg = false;
        this.lastAngle = null;
        this.lastTimestamp = null;
        this.velocitySamples = [];
    }
  
    setup = () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.subscribe(this.signals);  
        //this.potKnob.textContent = RavelEmoji.getRandomRoundEmoji();
        //this.potMarker .textContent = RavelEmoji['white-circle']; // 
        // x, y are the center point

        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style['width'] = `${this.width}px`;
        this.container.style['height'] = `${this.height}px`;
        this.container.style['font-size'] = `${this.width}px`;
        this.container.style['font-size'] = `${this.width}px`;
        this.potKnob.textContent = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji[this.icon];
        this.potMarker.textContent = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji[this.marker]; // 
        this.potMarker.style['font-size'] = `${this.width / 5}px`;
        this.potMarker.style['top'] = `-${this.width - this.width / 16}px`;
        this.potMarker.style['left'] = `${- this.width /  4 }px`;
        this.potKnob.style['line-height'] = `-${this.width + 10}px`;
        this.container.style["transform"] = "rotate(" + this.angle + "deg)";
        
        if (this.useSvg) {
            this.shadowRoot.querySelector('#crank-knob').innerHTML = this.potSvg;
            this.shadowRoot.querySelector('#crank-knob-svg').style.width = `${this.width}px`;
            this.shadowRoot.querySelector('#crank-knob-svg').style.height = `${this.height}px`;
            this.shadowRoot.querySelector('#crank-knob-svg').querySelector('#circle').style.fill = `${this.color}`;
        }
        //this.potKnob.style['top'] = `-${this.size / 8}px`;
        this.potMarker.style['opacity'] = `0.75`;
        const rect = this.container.getBoundingClientRect();
        this.centerX = rect.left + rect.width / 2;
        this.centerY = rect.top + rect.height / 2;
        if (!this.noClick) {
            this.addEventListener('pointerdown', this.handleClick);
        }
        this.addEventListener(`${this.id}`, this.handleEvent);
        this.broadcastMessage('register-sensor', this.id, this.container);
        //this.broadcastMessage('register-sensor', this.id, { x: this.x + this.w/2, y: this.y + this.h/2, w: this.w, h: this.height });
    }

    handleClick = (e) => {
        e.preventDefault();
        // Update center values dynamically in case layout shifted
        const rect = this.container.getBoundingClientRect();
        this.centerX = rect.left + rect.width / 2;
        this.centerY = rect.top + rect.height / 2;
        this.calculateCrankAngle(e.clientX, e.clientY);
        document.addEventListener('pointermove', this.dragElement);
        document.addEventListener('pointerup', this.endDragElement);
        document.addEventListener('pointerleave', this.endDragElement);
    }

    dragElement = (e) => {
        e.preventDefault();
        this.calculateCrankAngle(e.clientX + this.offsetX, e.clientY + this.offsetY);
    }

    endDragElement = () => {
        document.removeEventListener('pointermove', this.dragElement);
        document.removeEventListener('pointerup', this.endDragElement);
        document.removeEventListener('pointerleave', this.endDragElement);
    }

    handleEvent = (e) => {
        e.preventDefault();
        const type = e.detail.cmd;
        console.log(type);
        if (type === 'select') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 0, 0.5)';
        }
        if (type === 'unselect') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 255, 0)';
        }
        if (type === 'virtual-click') {
            let x = e.detail.content.startX;
            let y = e.detail.content.startY;
            this.offsetX = Number(e.detail.content.offsetX);
            this.offsetY = Number(e.detail.content.offsetY);
            const rect = this.container.getBoundingClientRect();
            this.centerX = (rect.left + rect.width / 2);
            this.centerY = (rect.top + rect.height / 2);
            this.calculateCrankAngle(x + this.offsetX, y + this.offsetY);
            document.addEventListener('pointermove', this.dragElement);
            document.addEventListener('pointerup', this.endDragElement);
            document.addEventListener('pointerleave', this.endDragElement);
            console.log(this.offsetX + " " + this.offsetY);
        }
        if (type === 'virtual-drag') {
            this.calculateCrankAngle(e.clientX, e.clientY);
        }
        if (type === 'virtual-release') {
            this.offsetX = 0;
            this.offsetY = 0;
            document.removeEventListener('pointermove', this.dragElement);
            document.removeEventListener('pointerup', this.endDragElement);
            document.removeEventListener('pointerleave', this.endDragElement);
        }
    }

    
    teardown = () => {
        this.unsubscribe(this.signals);
        this.broadcastMessage('register-sensor', this.id);
        if (!this.noClick) {
            this.removeEventListener('pointerdown', this.handleClick);
        }
        this.removeEventListener(`${this.id}`, this.handleEvent);
    }
    
    calculateCrankAngle = (x, y) => {

    	let d1 = y - this.centerY;
    	let d2 = x - this.centerX;

        this.angle = Math.atan2(d1, d2) * (180 / Math.PI) - 180;
        this.container.style["transform"] = "rotate(" + this.angle + "deg)";
       
        const now = performance.now();

        if (this.lastAngle !== null && this.lastTimestamp !== null) {
            // Step 1: Remap angles so 180¬∞ is the logical zero
            const logicalNow = (this.angle + 180) % 360;
            const logicalLast = (this.lastAngle + 180) % 360;

            // Step 2: Normalize difference to range [-180, 180]
            let deltaAngle = ((logicalNow - logicalLast + 540) % 360) - 180;
            // ‚Üë Adding 540 (not 180) prevents negative mod issues

            // Step 3: Calculate angular velocity
            const deltaTime = (now - this.lastTimestamp) / 1000; // seconds
            this.angularVelocity = deltaAngle / deltaTime;

            // Step 4: Smooth it 
            this.velocitySamples.push(this.angularVelocity);
            if (this.velocitySamples.length > 5) this.velocitySamples.shift();
            this.angularVelocity = (this.velocitySamples.reduce((a, b) => a + b, 0) / this.velocitySamples.length) / 1000;
            if (this.angularVelocity > 1) this.angularVelocity = 1;
            if (this.angularVelocity < -1) this.angularVelocity = -1;
            console.log('Angular Velocity:', this.angularVelocity.toFixed(2));
        }

        this.lastAngle = this.angle;
        this.lastTimestamp = now;

        this.sendMessage(this.signalOut, this.id, this.angularVelocity);
     
        /*
        if (this.angle <= 210) {
            this.value = this.map(this.angle, 0, 210, 0.3, 1);
        } else {
            this.value = this.map(this.angle, 305, 360, 0, .3);
        }
        */
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.container.style.position = 'absolute';
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.container.style.position = 'absolute';
            this.y = Number(newValue);
        }
        if (name === 'use-svg') {
            this.useSvg = true;
        }
        if (name === 'w') {
            this.width = Number(newValue);
        }
        if (name === 'h') {
            this.height = Number(newValue);
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'icon') {
            this.icon = newValue;
        }
        if (name === 'marker') {
            this.marker = newValue;
        }
        if (name === 'angle') {
            this.angle = Number(newValue);
        }
        if (name === 'value') {
            this.value = Number(newValue);
        }
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'show-feedback') {
            this.showFeedback = true;
        }
    }

    map = (val, in_min, in_max, out_min, out_max) => {
        return (val - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }

    potSvg = `
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   version="1.1"
   id="crank-knob-svg"
   width="267.03113"
   height="257.45898"
   viewBox="0 0 267.03113 257.45898"
   sodipodi:docname="crank-1.svg"
   inkscape:version="1.3.2 (091e20e, 2023-11-25)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs1" />
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="0.61458334"
     inkscape:cx="21.152542"
     inkscape:cy="136.67796"
     inkscape:window-width="1336"
     inkscape:window-height="841"
     inkscape:window-x="0"
     inkscape:window-y="38"
     inkscape:window-maximized="0"
     inkscape:current-layer="g1"
     showguides="false" />
  <g
     inkscape:groupmode="layer"
     inkscape:label="Image"
     id="g1"
     transform="translate(-1052.7501,459.03516)">
    <path
       id="rect70"
       style="fill:#000000;fill-opacity:0.5;stroke:none;stroke-width:1.64482"
       d="M 1146.9317 -459.03516 L 1146.9317 -417.36914 L 1107.1778 -417.36914 L 1107.1778 -374.47071 L 1107.1778 -373.98438 A 43.728813 43.728813 0 0 0 1105.8341 -374.01758 A 43.728813 43.728813 0 0 0 1062.1056 -330.28907 A 43.728813 43.728813 0 0 0 1105.8341 -286.56055 A 43.728813 43.728813 0 0 0 1107.1778 -286.65625 L 1107.1778 -286.18555 L 1107.1778 -243.24219 L 1146.9317 -243.24219 L 1146.9317 -201.57618 L 1235.17 -201.57618 L 1235.17 -243.24219 L 1274.9239 -243.24219 L 1274.9239 -286.18555 L 1319.7813 -286.18555 L 1319.7813 -374.42383 L 1274.9239 -374.42383 L 1274.9239 -417.36914 L 1235.17 -417.36914 L 1235.17 -459.03516 L 1146.9317 -459.03516 z " />
    <path
       id="circle"
       style="fill:#ff6600;fill-opacity:1;stroke:none;stroke-width:1.33333"
       d="M 1191.0509 -411.66211 A 81.355934 81.355934 0 0 0 1120.3595 -369.99805 A 44.296047 44.296047 0 0 1 1146.5196 -329.59961 A 44.296047 44.296047 0 0 1 1120.9435 -289.47852 A 81.355934 81.355934 0 0 0 1191.0509 -248.94922 A 81.355934 81.355934 0 0 0 1272.4063 -330.30469 A 81.355934 81.355934 0 0 0 1191.0509 -411.66211 z " />
    <circle
       style="fill:#000000;stroke-width:1.03294;stroke-linecap:round;stroke-linejoin:round"
       id="path1"
       cx="1104.3418"
       cy="-329.27618"
       r="30.602644" />
  </g>
</svg>
`;
}



/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-crossfade-background/ravel-crossfade-background.js"
/*!******************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-crossfade-background/ravel-crossfade-background.js ***!
  \******************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelCrossfadeBackground_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelCrossfadeBackground.js */ "../../core/web-components/custom-elements/gidgets/ravel-crossfade-background/src/RavelCrossfadeBackground.js");
/*
Defines the custom element <ravel-crossfade-background>
*/



customElements.define('ravel-crossfade-background', _src_RavelCrossfadeBackground_js__WEBPACK_IMPORTED_MODULE_0__.RavelCrossfadeBackground);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-crossfade-background/src/RavelCrossfadeBackground.js"
/*!********************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-crossfade-background/src/RavelCrossfadeBackground.js ***!
  \********************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelCrossfadeBackground: () => (/* binding */ RavelCrossfadeBackground)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/ravelComponentPath.js */ "../../core/web-components/common/ravelComponentPath.js");




class RavelCrossfadeBackground extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container-1 {
            position: fixed;
            top: 0px;
            left: 0px;
            opacity: 1;
        }
        #container-2 {
            top: 0px;
            left: 0px;
            position: fixed;
            opacity: 0;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container-1">
        </div>
        <div id="container-2">
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'backgrounds', 'n-backgrounds', 'speed'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container1 = this.shadowRoot.querySelector('#container-1');
        this.container2 = this.shadowRoot.querySelector('#container-2');
        this.width = '100vw';
        this.height = '100vh';
        this.speed = 31000;
        this.state = 0;
        this.backgrounds = `${_common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/images/default-backgrounds`;
        this.nBackgrounds = 100;
    }
  
    setup = () => {
        //this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
        this.container1.style.width = `${this.width}`; 
        this.container1.style.height = `${this.height}`;
        this.container2.style.width = `${this.width}`; 
        this.container2.style.height = `${this.height}`;
        this.container1.style.backgroundImage = `url(${this.backgrounds}/${Math.floor(Math.random() * this.nBackgrounds)}.png)`;
        this.timer = setInterval(this.toggleBackgroundState, this.speed);
        this.setTransition();
    }

    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    setTransition = () => {
        let transitionPeriod = this.speed - 1000;
        if (transitionPeriod <= 0) transitionPeriod = 1000;
        // console.log(transitionPeriod);
        this.container1.style.transition = `opacity ${transitionPeriod}ms ease-out`;
        this.container1.style['-webkit-transition'] = `opacity ${transitionPeriod}ms ease-out`;
        this.container1.style['-moz-transition'] = `opacity ${transitionPeriod}ms ease-out`;
        this.container1.style['-webkit-transition'] = `opacity ${transitionPeriod}ms ease-out`;
        this.container2.style.transition = `opacity ${transitionPeriod}ms ease-out`;
        this.container2.style['-webkit-transition'] = `opacity ${transitionPeriod}ms ease-out`;
        this.container2.style['-moz-transition'] = `opacity ${transitionPeriod}ms ease-out`;
        this.container2.style['-webkit-transition'] = `opacity ${transitionPeriod}ms ease-out`;
    }

    toggleBackgroundState = () => {
        // console.log('toggle background');
        if (this.state == 0) {
            // console.log(`url(${this.backgrounds}/${Math.floor(Math.random() * this.nBackgrounds)}.png`);
            this.container2.style.backgroundImage = `url(${this.backgrounds}/${Math.floor(Math.random() * this.nBackgrounds)}.png)`;
            this.container1.style.opacity = 0;
            this.container2.style.opacity = 1;
            this.state = 1;
        } else {
            // console.log(`url(${this.backgrounds}/${Math.floor(Math.random() * this.nBackgrounds)}.png'`);
            this.container1.style.backgroundImage = `url(${this.backgrounds}/${Math.floor(Math.random() * this.nBackgrounds)}.png)`;
            this.container1.style.opacity = 1;
            this.container2.style.opacity = 0;
            this.state = 0;
        }
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'backgrounds') {
            this.backgrounds = newValue;
        }
        if (name === 'n-backgrounds') {
            this.nbackgrounds = newValue;
        }
        if (name === 'speed') {
            this.speed = Number(newValue);
        }

    }
}

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-dock/ravel-dock.js"
/*!**********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-dock/ravel-dock.js ***!
  \**********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelDock_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelDock.js */ "../../core/web-components/custom-elements/gidgets/ravel-dock/src/RavelDock.js");
/*
Defines the custom element <ravel-dock>
*/



customElements.define('ravel-dock', _src_RavelDock_js__WEBPACK_IMPORTED_MODULE_0__.RavelDock);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-dock/src/RavelDock.js"
/*!*************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-dock/src/RavelDock.js ***!
  \*************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelDock: () => (/* binding */ RavelDock)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");




class RavelDock extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            width: 100%;
            height: 100%;
        }
        #content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 100%;
        }
        .content > ravel-signal {
            flex: 1 1 50px;
        }
        #icon {
            font-size: 48px;
        }
        #label {
            font-size: 24px;
        }
        .dock-item {
            font-size: 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .dock-item-icon {
            font-size: 32px;
             pointer-events: auto; 
        }
        .dock-item-label {
            font-size: 14px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="icon">üçî</div>
        <div id="label"></div>
        <div id="content">
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'rows', 'cols'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.rows = 1;
        this.cols = 1;
    }
  
    setup = () => {
        this.observedMessages = [`${this.label}`];
        this.subscribe(this.observedMessages);   
        this.addEventListener(`${this.label}`, this.handleDockEvent);
        this.shadowRoot.querySelector('#label').innerHTML = `${this.label}`;
        this.shadowRoot.querySelector('#icon').innerHTML = `${this.icon}`;
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
        this.removeEventListener(`${this.name}`, this.handleDockEvent);
    }

    handleDockEvent = (evt) => {
        
        if (evt.detail.cmd === 'register') {
            let div = document.createElement('div');
            div.innerHTML = `
            <div id="dock-item-${evt.detail.content.label}" class="dock-item-icon">${evt.detail.content.icon}</div>
            <div class="dock-item-label">${evt.detail.content.label}</div>
            `;
            div.classList.add('dock-item');
            this.shadowRoot.querySelector('#content').appendChild(div);
            div.addEventListener('click', (e) => {
                console.log('click ' + evt.detail.content.label);
                _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__.RavelMessages.sendMessage(`${evt.detail.content.label}`, 'maximize', '');
            });
        }
        if (evt.detail.cmd === 'minimize') {

        }
        if (evt.detail.cmd === 'maximize') {

        }
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'rows') {
            this.rows = parseInt(newValue, 10);
        }
        if (name === 'cols') {
            this.cols = parseInt(newValue, 10);
        }
        if (name === 'w') {
            
        }
        if (name === 'h') {
            
        }
       
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-emoji-grid/ravel-emoji-grid.js"
/*!**********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-emoji-grid/ravel-emoji-grid.js ***!
  \**********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelEmojiGrid_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelEmojiGrid.js */ "../../core/web-components/custom-elements/gidgets/ravel-emoji-grid/src/RavelEmojiGrid.js");

/*
Defines the custom element <ravel-emoji-grid>
*/



customElements.define('ravel-emoji-grid', _src_RavelEmojiGrid_js__WEBPACK_IMPORTED_MODULE_0__.RavelEmojiGrid);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-emoji-grid/src/RavelEmojiGrid.js"
/*!************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-emoji-grid/src/RavelEmojiGrid.js ***!
  \************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelEmojiGrid: () => (/* binding */ RavelEmojiGrid)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelEmojiGrid extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #emoji-grid {
            width: 100%;
            height:100%;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
            <div id="emoji-grid"></div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'width', 'height', 'size', 'emoji'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.grid = this.shadowRoot.querySelector('#emoji-grid');
    }
  
    setup = () => {
        this.observedMessages = [];
        this.grid.style['background-image'] = `url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='${this.height}px' width='${this.width}px'><text x='0' y='${this.y}px'  font-size='${this.size}px'>${this.emoji}</text></svg>")`;
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        // Note that size needs to come after emoji
        if (name === 'size') {
            this.size = Number(newValue);
            this.y = this.size - (this.size / 8);
            this.width = this.size * this.emoji.length / 2;
            this.height = this.size ;
        }        
        if (name === 'emoji') {
            this.emoji = newValue;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-field-recorder/ravel-field-recorder.js"
/*!******************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-field-recorder/ravel-field-recorder.js ***!
  \******************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelFieldRecorder_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelFieldRecorder.js */ "../../core/web-components/custom-elements/gidgets/ravel-field-recorder/src/RavelFieldRecorder.js");

/*
Defines the custom element <ravel-field-recorder>
*/



customElements.define('ravel-field-recorder', _src_RavelFieldRecorder_js__WEBPACK_IMPORTED_MODULE_0__.RavelFieldRecorder);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-field-recorder/src/RavelFieldRecorder.js"
/*!********************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-field-recorder/src/RavelFieldRecorder.js ***!
  \********************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelFieldRecorder: () => (/* binding */ RavelFieldRecorder)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");




class RavelFieldRecorder extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #sample-icon {
            font-size: 120px;
            cursor:pointer;
        }
        #container {
           z-index: 1000;
            font-size: 50px;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #000000DD;
            box-shadow: 0px 0px 10px 10px rgba(255, 255, 255,0.2);
             display:none;
        }
        .selected {
         box-shadow: 0px 0px 20px 20px rgba(255, 255, 0, 0.5);
     }
        #sample-preview {
            margin-top: -45px;
            font-size: 100px;
            text-align:center;
        }
        #play-control {
            transform: rotate(270deg);
        }
        #controls-wrapper {
            
        }
        #close-control {
             cursor:pointer;
        }
        #controls-wrapper {
            margin: 0px 80px 20px 80px;
            font-size: 50px;
            display:flex;
            justify-content: space-around;
        }
        #recordings-area {
            display: grid;
            grid: auto / auto auto auto auto auto;
            grid-gap: 4px;
            font-size: 60px;
            justify-items: center;
        }
        
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="sample-icon" data-src="recording-0">üê∂</div>
        <div id="container">
        <div id="control-area">
        <div id="close-control">üç©</div>
        <div id="sample-preview">üê∂</div>
        <div id="controls-wrapper">
            <div id="play-control">üíö</div>
            <div id="record-control">üî¥</div>
        </div>
        </div>
        <div id="recordings-area">
        </div>
        </div>
        `;
    }
    
 //üü©üü•
    
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'selected'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.recordings = this.shadowRoot.querySelector('#recordings-area');
        this.icon = this.shadowRoot.querySelector('#sample-icon');
        this.close = this.shadowRoot.querySelector('#close-control');
        this.preview = this.shadowRoot.querySelector(`#sample-preview`);
        this.recordings.innerHTML = '';
        this.selected = 'recording-0';
        this.icon.addEventListener('click', (evt) => {
            this.container.style.display = 'flex';
            this.selected = evt.target.getAttribute('data-src');
        });
        this.close.addEventListener('click', (evt) => {
            this.container.style.display = 'none';
        });
        for (let i = 0; i < 20; i++) {
            let emoji = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji.animals[i];
            this.recordings.innerHTML += `<span id="recording-${i}">${emoji}</span>`;
        }
        for (let i = 0; i < 20; i++) {
            this.shadowRoot.querySelector(`#recording-${i}`).addEventListener('click', (evt) => {
                this.icon.innerHTML = this.shadowRoot.querySelector(`#recording-${i}`).innerHTML;
                this.preview.innerHTML = this.shadowRoot.querySelector(`#recording-${i}`).innerHTML;
                this.selected = evt.target.id;
                this.icon.setAttribute('data-src', this.selected);
            });
        }

    }
  
    setup = () => {
        this.observedMessages = ['message'];
        this.icon.innerHTML = this.shadowRoot.querySelector(`${this.selected}`).innerHTML;
        this.preview.innerHTML = this.shadowRoot.querySelector(`${this.selected}`).innerHTML;
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'selected') {
            this.selected = newValue;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-fluxly-sound-engine/ravel-fluxly-sound-engine.js"
/*!****************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-fluxly-sound-engine/ravel-fluxly-sound-engine.js ***!
  \****************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelFluxlySoundEngine_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelFluxlySoundEngine.js */ "../../core/web-components/custom-elements/gidgets/ravel-fluxly-sound-engine/src/RavelFluxlySoundEngine.js");
/*
Defines the custom element 
*/



customElements.define('ravel-fluxly-sound-engine', _src_RavelFluxlySoundEngine_js__WEBPACK_IMPORTED_MODULE_0__.RavelFluxlySoundEngine);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-fluxly-sound-engine/src/RavelFluxlySoundEngine.js"
/*!*****************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-fluxly-sound-engine/src/RavelFluxlySoundEngine.js ***!
  \*****************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelFluxlySoundEngine: () => (/* binding */ RavelFluxlySoundEngine)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelFluxlySoundEngine extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: relative;
            background-color: #000000;
            color: #ffffff;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 1000px;
            height: 800px;
            display: none;
        }
        #start {
            color: #ffffff;
            cursor: pointer;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
            <input type="range" min="-5" max="5" step="0.01" value="1" id="rate">
            <div id="start">Start!</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'message-id', 'show-control', 'filename', 
          'initial-value', 'min', 'max', 'no-loop'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        // Safely disconnect and release everything
        if (this.node) {
          this.node.disconnect();
          this.node = null;
        }
        
        if (this.audioContext) {
            this.audioContext.close(); // Stops processing and frees audio resources
            this.audioContext = null;
        }
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.messageId = 'ravel-fluxly-sound-engine';
        this.filename = 'sample-0.wav';
    }
  
    setup = async () => {
      console.log('setup!');
        this.observedMessages = [`${this.messageId}`, 'close-cryptid', 'playback-rate', 'resume' ];
        this.subscribe(this.observedMessages);   
        this.startAudio();

        this.shadowRoot.querySelector('#rate').addEventListener('input', (evt) => {
            this.sendMessage('ravel-fluxly-sound-engine', 'playback-rate', evt.target.value);
        });

        this.addEventListener(this.messageId, (evt) => {
          //console.log(evt.detail.content);
          if (evt.detail.cmd === 'playback-rate') {
              this.rate = parseFloat(evt.detail.content);
              try {
                this.node.parameters.get('playbackRate').setValueAtTime(this.rate, this.audioContext.currentTime);
              } catch (e) {
                console.log(evt.detail.cmd);
              }
          }
          /* Not used?
          if (evt.detail.cmd === 'start-audio') {
            console.log('start');
            this.startAudio();
          }
          if (evt.detail.cmd === 'stop-audio') {
            console.log('stop');
            this.stopAudio();
          }
          */
          if (evt.detail.cmd === 'resume') {
            console.log('resume playing in a no loop situation');
            this.resumeAudio();
          }
      });

        this.shadowRoot.querySelector('#start').addEventListener('click', (e) => {
            this.startAudio();
        });
    }

    startAudio = async () => {
      console.log('start audio');
        const blob = new Blob([this.workletCode], { type: 'application/javascript' });
        const blobUrl = URL.createObjectURL(blob);
        this.audioContext = new AudioContext();
        await this.audioContext.audioWorklet.addModule(blobUrl);
        this.node = new AudioWorkletNode(this.audioContext, 'sample-player', {
            outputChannelCount: [1],
            numberOfInputs: 0,
            numberOfOutputs: 1,
            parameterData: { 
                playbackRate: 1.0,
                noLoop: this.noLoop
            }
        });
        
        // Load WAV file and send to worklet
        const response = await fetch(this.filename);
        const arrayBuffer = await response.arrayBuffer();
        const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
        
        // Extract Float32Arrays
        const channelData = [];
        for (let i = 0; i < audioBuffer.numberOfChannels; i++) {
            // Copy the data ‚Äî don't just pass the view!
            channelData.push(audioBuffer.getChannelData(i).slice());
        }

        // Send the raw data
        this.node.port.postMessage({
            type: 'sample-data',
            channelData: channelData,
            sampleRate: audioBuffer.sampleRate,
            length: audioBuffer.length,
        });

        this.node.connect(this.audioContext.destination);
        this.audioContext.resume();
    }

    stopAudio = () => {
        console.log('it never really stops...)');
    }

    resumeAudio = (evt) => {
        try {
          this.node.port.postMessage({ playing: true });
        } catch (e) {
          console.log(e);
        }
    }

    teardown = () => {
       this.unsubscribe(this.observedMessages);
    }


    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'show-control') {
            this.container.style.display = 'flex';
        }
        if (name === 'message-id') {
          this.messageId = newValue;
        }
        if (name === 'filename') {
          this.filename = newValue;
        }
        if (name === 'no-loop') {
          this.noLoop = true;
        }
    }

    workletCode = `
class SamplePlayerProcessor extends AudioWorkletProcessor {
  static get parameterDescriptors() {
    return [
      {
        name: 'playbackRate',
        defaultValue: 1.0,
        minValue: -16.0,
        maxValue: 16.0,
        automationRate: 'a-rate'
      },
      {
        name: 'noLoop',
        defaultValue: true 
      }
    ];
  }

  constructor() {
      super();
      this.channelData = [];
      this.sampleRate = 44100;
      this.length = 0;
      this.position = 0;
      this.playing = true;

      this.port.onmessage = (event) => {
        const { type, channelData, sampleRate, length } = event.data;
        if (type === 'sample-data') {
            this.channelData = channelData.map(arr => new Float32Array(arr));
            this.sampleRate = sampleRate;
            this.length = length;
            this.position = 0;
        }
        if (event.data.hasOwnProperty('playing')) {
            this.playing = !!event.data.playing;
        }
      };
  }

  process(inputs, outputs, parameters) {
    if (!this.channelData.length) return true;
    if (!this.playing) return true;

    const output = outputs[0];
    const rateParam = parameters.playbackRate;
    const numChannels = output.length;

    for (let i = 0; i < output[0].length; i++) {
      const rate = rateParam.length > 1 ? rateParam[i] : rateParam[0];

      for (let ch = 0; ch < numChannels; ch++) {
        const data = this.channelData[ch % this.channelData.length];
        const idx = Math.floor(this.position) % this.length;
        const sample = data[(idx + this.length) % this.length];
        output[ch][i] = sample;
      }
    
      this.position += rate;

      // Loop
      if (parameters.noLoop) {
          if (this.position >= this.length) {
              this.position = 0 ;
              this.playing = false;
          }
          if (this.position < 0) {
              this.position = this.length - 1;
              this.playing = false;
          }
      } else {
          if (this.position >= this.length) {
              this.position = 0 ;
              this.playing = true;
          }
          if (this.position < 0) {
              this.position = this.length - 1;
              this.playing = true;
          }
      }     
    }

    return true;
  }
}

registerProcessor('sample-player', SamplePlayerProcessor);
`;
}



/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-fluxum/ravel-fluxum.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-fluxum/ravel-fluxum.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelFluxum_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelFluxum.js */ "../../core/web-components/custom-elements/gidgets/ravel-fluxum/src/RavelFluxum.js");

/*
Defines the custom element <ravel-fluxum>
*/



customElements.define('ravel-fluxum', _src_RavelFluxum_js__WEBPACK_IMPORTED_MODULE_0__.RavelFluxum);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-fluxum/src/RavelFluxum.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-fluxum/src/RavelFluxum.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelFluxum: () => (/* binding */ RavelFluxum)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");
/* harmony import */ var _modules_RavelUtilities_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../modules/RavelUtilities.js */ "../../core/modules/RavelUtilities.js");





class RavelFluxum extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #bubble-container {
            position: absolute;
            opacity: 1.0;
            display: none;
        }
        #container {
            position:absolute;
        }
        #bubble {
            font-family: "Silkscreen";
            font-size: 10;
            color: #333333;
            background-color: #ffffff;
            padding:4px 10px 4px 10px;
            border: 3px solid #ffeebb;
            border-radius: 12px;
        }
        #bubble-stem {
            position: absolute;
            top: 90%;
            left: 10%;
            width: 10px;
            height: 10px;
            background-color: #ffffff;
            border-left: 3px solid #ffeebb;
            border-right: 3px solid #ffeebb;
            border-bottom: 3px solid #ffeebb;
            border-bottom-left-radius: 100%;
            border-bottom-right-radius: 100%;
        }
        #eyes-closed {
            display:none;
        }
        .green-glow {
            background-color: rgba(45,255,196,0.5);
            box-shadow: 0px 0px 20px 20px rgba(45,255,196,0.5);
        }
        .red-glow {
            background-color: rgba(255,0,0,0.5);
            box-shadow: 0px 0px 20px 20px rgba(255,0,0,0.5);
        }
        .yellow-glow {
            background-color: rgba(255,255,0,0.5);
            box-shadow: 0px 0px 20px 20px rgba(255,255,0,0.5);
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container" >
        <div id="icon">üêπ</div>
        </div>
        <div id="bubble-container">
        <div id="bubble">Hello World üò∂üêµüòë</div>
        <div id="bubble-stem"></div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'icon', 'size', 
            'x', 'y', 'angle', 'show-hint',
            'bubble-text-size', 'color', 'use-svg'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.icon = this.shadowRoot.querySelector('#icon');
        this.bubble = this.shadowRoot.querySelector('#bubble-container');
        this.angle = 0;
        this.prevAngle = 0;
        this.useEmbeddedSvg = false;
        this.showHint = false;
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        this.icon.style['font-size'] = `${this.size}px`;
        this.icon.style['line-height'] = `${this.size}px`;
        this.container.style.top = `${this.y - (this.size / 2)}px`;
        this.container.style.left = `${this.x - (this.size / 2)}px`;
        this.container.style['border-radius'] = `${this.size}px`;
        this.container.style.width = `${this.size}px`;
        this.container.style.height = `${this.size}px`;
        this.container.style.transform = `rotate(${this.angle}deg)`;
        this.bubble.style.left = `${this.x}px`;
        this.bubble.style.top = `${this.y - 60}px`;
        if (this.useEmbeddedSvg) {
            this.icon.innerHTML = this.svg;
            console.log(this.shadowRoot.querySelector('#fluxum-svg'));
            this.shadowRoot.querySelector('#fluxum-svg').style.width = `${this.size}px`;
            this.shadowRoot.querySelector('#fluxum-svg').style.height = `${this.size}px`;
            this.shadowRoot.querySelector('#fluxum-svg').querySelector('#fluxum-background-1').style.fill = `${this.color}`;
            this.shadowRoot.querySelector('#fluxum-svg').querySelector('#fluxum-background-2').style.fill = `${this.color}`;
        }
        if (this.color) {
            this.container.style.backgroundColor = _modules_RavelUtilities_js__WEBPACK_IMPORTED_MODULE_3__.RavelUtilities.convertHexToRgbaColor(this.color, 0.5);
            this.container.style.boxShadow = `0px 0px 20px 20px ${_modules_RavelUtilities_js__WEBPACK_IMPORTED_MODULE_3__.RavelUtilities.convertHexToRgbaColor(this.color, 0.5)}`;
        }
        if (this.showHint) {
            console.log('show-hint');
            this.shadowRoot.querySelector('#bubble-container').style.display = 'block';
        }
        this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }
    
    transform(x, y, angle) {
        this.x = x;
        this.y = y;
        if (x >= 0) this.container.style.top = `${this.y}px`;
        if (y >= 0) this.container.style.left = `${this.x}px`;
        this.container.style.transform = `rotate(${angle}rad)`;
        this.bubble.style.left = `${this.x}px`;
        this.bubble.style.top = `${this.y - 60}px`;
        this.prevAngle = angle;
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'x') {
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.y = Number(newValue);
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'angle') {
            this.angle = Number(newValue);
        }
        if (name === 'icon') {
            this.overlay.innerText = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji[newValue];
        } 
        if (name === 'size') {
            this.size = parseInt(newValue, 10);
        }
        if (name === 'bubble-text-size') {
            this.bubble.style['font-size'] = `${newValue}px`;
        }
        if (name === 'use-svg') {
            this.useEmbeddedSvg = true;
        }
        if (name === 'show-hint') {
            this.showHint = true;
        }
    }

    svg = `
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="52.724949mm"
   height="52.725464mm"
   viewBox="0 0 52.724949 52.725464"
   version="1.1"
   id="fluxum-svg"
   xml:space="preserve"
   inkscape:version="1.3.2 (091e20e, 2023-11-25)"
   sodipodi:docname="pixelated-fluxum-red.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="0.2973261"
     inkscape:cx="625.57576"
     inkscape:cy="1014.0381"
     inkscape:window-width="1400"
     inkscape:window-height="836"
     inkscape:window-x="0"
     inkscape:window-y="38"
     inkscape:window-maximized="0"
     inkscape:current-layer="layer1" /><defs
     id="defs1" /><g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-12.903449,-37.37456)"><g
       id="g6"
       transform="translate(-17.797518,-48.498237)"><path
         id="fluxum-background-1"
         style="opacity:0.700741;fill:#f01400;fill-opacity:1;stroke-width:0.347006"
         d="M 46.273661,85.872795 V 101.446 H 30.700968 v 21.57957 h 15.572693 v 15.57269 H 67.853223 V 123.02557 H 83.425916 V 101.446 H 67.853223 V 85.872795 Z" /><path
         id="fluxum-background-2"
         style="opacity:1;fill:#f01500;fill-opacity:1;stroke-width:0.37625"
         d="m -91.100899,41.156661 h -5.228105 v -5.116484 h -31.813046 v 5.116484 h -5.2281 v 31.813045 h 5.2281 v 5.117001 h 31.813046 v -5.117001 h 5.228105 z"
         transform="rotate(-90)" /><g
         id="g20"
         transform="translate(-13.793077,-67.630569)"><path
           id="rect17"
           style="opacity:1;fill:#ffffff;fill-opacity:1;stroke-width:0.352777"
           d="m 76.418075,164.62716 v 1.72393 h -1.946652 v 1.50171 h -2.001945 v 14.68283 h 2.001945 v 1.50172 h 1.946652 v 1.72444 h 8.676473 v -1.72444 h 1.946651 v -1.50172 h 2.001945 V 167.8528 h -2.001945 v -1.50171 h -1.946651 v -1.72393 z" /><path
           id="rect16"
           style="opacity:1;fill:#ffffff;fill-opacity:1;stroke-width:0.352425"
           d="m 54.838513,168.52046 v 2.27997 h -1.723926 v 13.01471 h 1.723926 v 2.27996 h 10.567314 v -2.27996 h 1.723926 v -13.01471 h -1.723926 v -2.27997 z" /><rect
           style="opacity:1;fill:#000000;fill-opacity:1;stroke-width:0.352777"
           id="rect19"
           width="6.0066624"
           height="8.7875252"
           x="56.729588"
           y="173.19209" /><rect
           style="opacity:1;fill:#000000;fill-opacity:1;stroke-width:0.352777"
           id="rect20"
           width="9.0099936"
           height="10.567276"
           x="76.084389"
           y="170.85617" /></g></g></g></svg>

    `;
}



/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-lcd/ravel-lcd.js"
/*!********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-lcd/ravel-lcd.js ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelLCD_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelLCD.js */ "../../core/web-components/custom-elements/gidgets/ravel-lcd/src/RavelLCD.js");

/*
Defines the custom element <ravel-lcd>
*/



customElements.define('ravel-lcd', _src_RavelLCD_js__WEBPACK_IMPORTED_MODULE_0__.RavelLCD);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-lcd/src/RavelLCD.js"
/*!***********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-lcd/src/RavelLCD.js ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelLCD: () => (/* binding */ RavelLCD)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelLCD extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #screen {
            font-size: 72px;
            padding: 20px;
            background-color: #00ff00;
            color: #444444;
            font-family: 'DS-Digital-Italic';
            text-shadow: 0px 0px 20px rgba(45,255,196,0.9);
            box-shadow: inset 0px 0px 20px 20px rgba(45,255,196,0.9);
        }
        slot {
            text-shadow: 2px 2px 4px gba(45,255,196,0.9);
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="lcd-container">
        <div id="screen">
        <slot></slot>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'lcd-id', 'color', 'size', 'x', 'y', 'scale', 'orientation', 'text'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#lcd-container');
    }
  
    setup = () => {
        this.observedMessages = ['lcd-text'];
        this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.container.style.position = 'fixed';
            this.x = newValue;
            this.container.style.left = newValue;
        }
        if (name === 'y') {
            this.container.style.position = 'fixed';
            this.y = newValue;
            this.container.style.top = newValue;
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-led-array/ravel-led-array.js"
/*!********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-led-array/ravel-led-array.js ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelLedArray_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelLedArray.js */ "../../core/web-components/custom-elements/gidgets/ravel-led-array/src/RavelLedArray.js");

/*
Defines the custom element <ravel-led-array>
*/



customElements.define('ravel-led-array', _src_RavelLedArray_js__WEBPACK_IMPORTED_MODULE_0__.RavelLedArray);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-led-array/src/RavelLedArray.js"
/*!**********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-led-array/src/RavelLedArray.js ***!
  \**********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelLedArray: () => (/* binding */ RavelLedArray)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelLedArray extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
            #container {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                pointer-events: none;
            }
            #led-container {
                display: flex;
                flex-wrap: wrap;
                width: 200px; 
                gap: 10px; 
                background-color: #ffffff;
                padding: 10px 0px 10px 10px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                margin-bottom: 10px;
                pointer-events: auto;
            }

            .cell {
                width: 10px; 
                height: 10px; 
                background-color: #e0e0e0;
            }
        </style>
        `;
    }
  /* styles.css */


    static get html() { 
        return `
        <div id="container">
        <div id="led-container">
        </div>
        <div id="address"></div>
        <div id="state-mask"></div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'address', 'rows', 'cols']; 
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#led-container');
        this.address = '000000';
        this.rows = 2;
        this.cols = 2;
        this.stateMask = '';
        this.stateArray = [];
        this.red = [];
        this.green = [];
        this.blue = [];
    }
  
    setup = () => {
        this.observedMessages = [`${this.address}`];
        this.subscribe(this.observedMessages);
        let container = this.shadowRoot.querySelector('#led-container');
        container.addEventListener('click', this.handleClick );
        this.addEventListener('toggle', this.handleMessage);
        let count = 0;
        for (let r = 0; r < this.rows; r++) {
            for (let c = 0; c < this.cols; c++) {
                console.log(c + this.rows * r);
                container.innerHTML += `<div id="led-${count}" class="cell" led-position="${count}" row="${r}" col="${c}"></div>`;
                if ((count % 4) === 0) {
                    this.stateMask += '0';
                }
                count++;
                this.stateArray.push(0);
                this.red.push(255);
                this.green.push(0);
                this.blue.push(0);
            }
        }
        this.ledCount = count;
        container.style.width = `${(20 * this.cols)}px`;
        this.shadowRoot.querySelector('#address').innerHTML = `${this.address}`;
        this.shadowRoot.querySelector('#state-mask').innerHTML = `${this.stateMask}`;
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }
    
    handleClick = (evt) => {
        let index = evt.target.getAttribute('led-position');
        if (index !== null) {
            if (this.stateArray[index] === 0) {
                this.stateArray[index] = 1;
                this.shadowRoot.querySelector(`#led-${index}`).style['background-color'] = 
                    `rgb(${this.red[index]}, ${this.green[index]}, ${this.blue[index]})`;
            } else {
                this.stateArray[index] = 0;
                this.shadowRoot.querySelector(`#led-${index}`).style['background-color'] = 
                    `#e0e0e0`;
            }
            this.stateArrayToMask();
        }
    }

    handleMessage = (msg) => {
        console.log(msg);
    }

    stateArrayToMask = () => {
            // Pad the array length to make it a multiple of 4
            while (this.stateArray.length % 4 !== 0) {
                this.stateArray.unshift(0); // Add leading zeros if necessary
            }
        
            // Group bits into chunks of 4 and convert each to hexadecimal
            const hexString = this.stateArray
                .join('') // Convert array to binary string
                .match(/.{1,4}/g) // Split into groups of 4 bits
                .map(bits => parseInt(bits, 2).toString(16)) // Convert each group to hexadecimal
                .join(''); // Join the hex values together
        
            this.stateMask = hexString.toUpperCase(); 
            this.shadowRoot.querySelector('#state-mask').innerHTML = `${this.stateMask}`;
    }

    maskToStateArray = (hexString) => {
        this.stateMask = hexString;
        thisStateArray = 
            hexString.split('') // Split the hex string into individual characters
            .flatMap(hexChar => {
                const binaryString = parseInt(hexChar, 16).toString(2).padStart(4, '0'); // Convert to binary and pad to 4 bits
                return binaryString.split('').map(bit => parseInt(bit)); // Split binary string into an array of bits
            });
        console.log(this.StateArray);
        this.shadowRoot.querySelector('#state-mask').innerHTML = `${this.stateMask}`;
    }

    updateLeds = () => {
        for (let i = 0; i < this.ledCount; i++) {
            if (this.stateArray[i] === 0) {
                this.shadowRoot.querySelector(`#led-${i}`).style['background-color'] = 
                    `rgb(${this.red[i]}, ${this.green[i]}, ${this.blue[i]})`;
            } else {
                this.shadowRoot.querySelector(`#led-${i}`).style['background-color'] = 
                    `#e0e0e0`;
            }
        }
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'address') {
            this.address = newValue;
        }
        if (name === 'rows') {
            this.rows = parseInt(newValue, 10);
        }
        if (name === 'cols') {
            this.cols = parseInt(newValue, 10);
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-led/ravel-led.js"
/*!********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-led/ravel-led.js ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelLed_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelLed.js */ "../../core/web-components/custom-elements/gidgets/ravel-led/src/RavelLed.js");

/*
Defines the custom element <ravel-led>
*/



customElements.define('ravel-led', _src_RavelLed_js__WEBPACK_IMPORTED_MODULE_0__.RavelLed);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-led/src/RavelLed.js"
/*!***********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-led/src/RavelLed.js ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelLed: () => (/* binding */ RavelLed)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelLed extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
            #container {
                position: absolute;
                border-radius: 50%;
            }
            #led-glow {
                position: absolute;
                border-radius: 50%;
                top: 25%;
                left: 25%;
                width: 50%;
                height: 50%;
            }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="led-img"></div>
        <div id="led-glow"></div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'message-id', 'color', 'glow', 
            'state', 'size', 'x', 'y',  'inline', 'signals' ]; 
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.ledId = 0;
        this.size = 50;
        this.states = 2;
        this.state = 0;
        this.stateDir = 1;
        this.inline = false;
        this.glowColor = '#ffffff';
        this.signals = [];
    }
  
    setup = () => {
        this.observedMessages = [`${this.messageId}`];
        // Send 'toggle', 'on-for-ms', 'blink-on', 'blink-off'
        this.subscribe(this.observedMessages);
        this.glow = this.shadowRoot.querySelector('#led-glow');
        this.container.style.left =  `${this.x}px`;
        this.container.style.top =  `${this.y}px`;
        if (this.inline) {
            this.container.style.display = 'block';
        }
        this.shadowRoot.querySelector('#led-img').innerHTML = this.ledSvg;
        this.shadowRoot.querySelector('#led-background').style.fill = this.color;
        this.shadowRoot.querySelector('#led').style.width = `${this.size}px`;
        this.shadowRoot.querySelector('#led').style.height = `${this.size}px`;
        this.msTimer = null;
        this.blinkTimer = null;
        this.addEventListener(`${this.messageId}`, this.handleMessages);
    }
    
    handleMessages = (evt) => {
        if (evt.detail.cmd === 'on-for-ms') {
            let ms = Number(evt.detail.content);
            this.glow.style.boxShadow = `0px 0px ${this.size / 2}px ${this.size / 2}px ${this.glowColor}`;
            this.msTimer = setTimeout(() => {
                this.glow.style.boxShadow = 'none';
            }, ms);
        }
    }

    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);

        if (name === 'message-id') {
            this.messageId = newValue;
        }
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.x = newValue;
        }
        if (name === 'y') {
            this.y = newValue;
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'led-id') {
            this.ledId = newValue;
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'inline') {
            this.inline = true;
        }
        if (name === 'state') {
            this.state = newValue;
        }
        if (name === 'blink-rate') {
            this.blinkRate = newValue;
        }
        if (name === 'states') {
            this.states = parseInt(newValue, 10);
        }
        if (name === 'glow') {
            this.glowColor = newValue;
        }
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
    }

    ledSvg = `
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   width="19.742495mm"
   height="19.741852mm"
   viewBox="0 0 19.742495 19.741852"
   version="1.1"
   id="led"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm" />
  <defs
     id="defs1" />
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-16.247012,-38.049292)">
    <path
       id="path-1"
       style="opacity:1;fill:#000000;stroke:none;stroke-width:1.64789;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"
       d="m 21.121161,38.049293 v 2.277435 h -2.547148 v 2.596716 h -2.327001 v 9.993552 h 2.327001 v 2.59607 h 2.547148 v 2.278079 h 9.993552 v -2.278079 h 2.547793 v -2.59607 h 2.327001 v -9.993552 h -2.327001 v -2.596716 h -2.547793 v -2.277435 z"
       inkscape:export-filename="led.svg"
       inkscape:export-xdpi="96"
       inkscape:export-ydpi="96" />
    <circle
       style="fill:#00cc00;stroke:none;stroke-width:0.393338;stroke-linecap:round;stroke-linejoin:round"
       id="led-background"
       cx="26.118259"
       cy="47.920219"
       r="6.6145835" />
    <path
       id="rect3"
       style="opacity:0.488889;fill:#000000;stroke:none;stroke-width:1.32292;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none"
       d="m 19.955888,50.278068 a 6.6145835,6.6145835 0 0 0 6.162414,4.256588 6.6145835,6.6145835 0 0 0 6.161898,-4.256588 z"
       inkscape:export-filename="led.svg"
       inkscape:export-xdpi="96"
       inkscape:export-ydpi="96" />
  </g>
</svg>

`;
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-menu/ravel-menu.js"
/*!**********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-menu/ravel-menu.js ***!
  \**********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelMenu_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelMenu.js */ "../../core/web-components/custom-elements/gidgets/ravel-menu/src/RavelMenu.js");

/*
Defines the custom element <ravel-menu>
*/



customElements.define('ravel-menu', _src_RavelMenu_js__WEBPACK_IMPORTED_MODULE_0__.RavelMenu);

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-menu/src/RavelMenu.js"
/*!*************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-menu/src/RavelMenu.js ***!
  \*************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelMenu: () => (/* binding */ RavelMenu)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelMenu extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        </style>
        `;
    }
  
    static get html() { 
        return `
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'attribute'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'attribute') {
            // Do something
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-p5-canvas/ravel-p5-canvas.js"
/*!********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-p5-canvas/ravel-p5-canvas.js ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelP5Canvas_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelP5Canvas.js */ "../../core/web-components/custom-elements/gidgets/ravel-p5-canvas/src/RavelP5Canvas.js");
/*
Defines the custom element <ravel-p5-canvas>
*/



customElements.define('ravel-p5-canvas', _src_RavelP5Canvas_js__WEBPACK_IMPORTED_MODULE_0__.RavelP5Canvas);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-p5-canvas/src/RavelP5Canvas.js"
/*!**********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-p5-canvas/src/RavelP5Canvas.js ***!
  \**********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelP5Canvas: () => (/* binding */ RavelP5Canvas)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");




class RavelP5Canvas extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
  static get localStyles() {
    return `
      <style>
        :host{
          display:block;
          box-sizing:border-box;
        }
        .wrap{
          position:relative;
          width:100%;
          height:100%;
          box-sizing:border-box;
        }
        .mount{
          position:relative;
          width:100%;
          height:100%;
          box-sizing:border-box;
        }
        canvas{
          display:block;
          visibility: visible;
        }
      </style>
    `;
  }

  static get html() {
    return `
      <div class="wrap">
        <div class="mount" part="mount"></div>
      </div>
    `;
  }

  static get observedAttributes() {
    return [
      ...super.baseObservedAttributes,
      "src",
      "autostart",
      "sandbox" // "1" default; "0" allows external script to touch window (not recommended)
    ];
  }

  constructor() {
    super();
    const template = document.createElement("template");
    template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"] + this.constructor.localStyles + this.constructor.html;
    this.attachShadow({ mode: "open" });
    this.shadowRoot.appendChild(template.content.cloneNode(true));
    this.initialize();
  }

  connectedCallback() {
    this.setup();
  }

  disconnectedCallback() {
    this.teardown();
  }

  initialize() {
    this.rows = 1;
    this.cols = 1;

    this._p5 = null;
    this._abort = null;
    this._srcText = null;

    this._runToken = 0; // prevents race conditions when src changes quickly
  }

  setup = () => {
    this.$mount = this.shadowRoot.querySelector(".mount");

    // Auto-run unless autostart="0"
    const autostartAttr = this.getAttribute("autostart");
    const autostart = autostartAttr == null ? true : autostartAttr !== "0";
    if (autostart) this.reload();
  };

  teardown = () => {
    this.destroyInstance();
    this.abortFetch();
  };

  attributeChangedCallback(name, oldValue, newValue) {
    super.attributeChangedCallback(name, oldValue, newValue);
    if (oldValue === newValue) return;

    if (name === "w" || name === "h") {
      // Resize p5 if running
      this.applySizeToRunningSketch();
      return;
    }

    if (name === "src" || name === "sandbox" || name === "autostart") {
      const autostartAttr = this.getAttribute("autostart");
      const autostart = autostartAttr == null ? true : autostartAttr !== "0";
      if (autostart) this.reload();
    }
  }

  // ------- Public API -------
  async reload() {
    const src = (this.getAttribute("src") || "").trim();
    if (!src) return;

    if (!window.p5) {
      console.warn("[Ravelp5Embed] p5 not found on window. Import p5 globally first.");
      return;
    }

    const myToken = ++this._runToken;

    this.abortFetch();
    this.destroyInstance();
    this.clearMount();

    this._abort = new AbortController();

    try {
      const res = await fetch(src, { signal: this._abort.signal, cache: "no-store" });
      if (!res.ok) throw new Error(`Failed to fetch "${src}": ${res.status} ${res.statusText}`);
      const text = await res.text();

      if (myToken !== this._runToken) return; // superseded
      this._srcText = text;

      const sketchFn = this.compileSketch(text, src);
      if (!sketchFn) return;

      // Create p5 instance and mount it
      this._p5 = new window.p5(sketchFn, this.$mount);

      // Ensure initial sizing even if sketch doesn't call createCanvas
      // (Many sketches do createCanvas in setup, but we enforce if missing.)
      //this.ensureCanvasSize();

      this.dispatchEvent(
        new CustomEvent("ravelp5:loaded", {
          bubbles: true,
          composed: true,
          detail: { src }
        })
      );
    } catch (err) {
      if (err?.name === "AbortError") return;
      console.error("[Ravelp5Embed]", err);

      this.dispatchEvent(
        new CustomEvent("ravelp5:error", {
          bubbles: true,
          composed: true,
          detail: { src, error: String(err?.message || err) }
        })
      );
    }
  }

  stop() {
    this.destroyInstance();
    this.abortFetch();
  }

  // ------- Internals -------
  abortFetch() {
    if (this._abort) {
      try { this._abort.abort(); } catch {}
      this._abort = null;
    }
  }

  clearMount() {
    if (!this.$mount) return;
    this.$mount.innerHTML = "";
  }

  destroyInstance() {
    if (this._p5) {
      try {
        // p5 instance mode cleanup
        this._p5.remove();
      } catch (e) {
        console.warn("[Ravelp5Embed] p5 remove() failed:", e);
      }
      this._p5 = null;
    }
  }

  getDesiredSize() {
    // Default: 300x150 if not provided
    const wAttr = this.getAttribute("w");
    const hAttr = this.getAttribute("h");

    const w = Number(wAttr);
    const h = Number(hAttr);

    return {
      w: Number.isFinite(w) && w > 0 ? w : 300,
      h: Number.isFinite(h) && h > 0 ? h : 150
    };
  }

  applySizeToRunningSketch() {
    if (!this._p5) return;
    const { w, h } = this.getDesiredSize();

    // If the sketch created a canvas, resize it.
    // p5.resizeCanvas exists in instance mode after canvas created.
    if (typeof this._p5.resizeCanvas === "function") {
      try { this._p5.resizeCanvas(w, h); } catch {}
    }

    // Also ensure the host element has explicit pixel sizing
    this.style.width = `${w}px`;
    this.style.height = `${h}px`;
  }

  ensureCanvasSize() {
    const { w, h } = this.getDesiredSize();

    // Set host size so layout is predictable
    this.style.width = `${w}px`;
    this.style.height = `${h}px`;

    // If the sketch didn't create a canvas, try to create one.
    // (Some sketches rely on default canvas creation; many don't.)
    try {
      if (this._p5 && !this._p5.canvas && typeof this._p5.createCanvas === "function") {
        this._p5.createCanvas(w, h);
        if (this._p5.canvas && this.$mount) this.$mount.appendChild(this._p5.canvas);
      } else if (this._p5 && this._p5.canvas && typeof this._p5.resizeCanvas === "function") {
        this._p5.resizeCanvas(w, h);
      }
    } catch (e) {
      // If the sketch does something unusual, don't hard-fail
      console.warn("[Ravelp5Embed] ensureCanvasSize warning:", e);
    }
  }

  compileSketch(sourceText, srcLabel = "p5-sketch.js") {
    const sandboxAttr = this.getAttribute("sandbox");
    const sandbox = sandboxAttr == null ? true : sandboxAttr !== "0";

    // We run the fetched script in "instance mode".
    // The fetched script is expected to *attach* setup/draw/etc onto `p`
    // or define functions in a way we can bind onto `p`.
    //
    // Recommended external sketch pattern:
    //   p.setup = () => { p.createCanvas(p.width, p.height); ... }
    //   p.draw  = () => { ... }
    //
    // If the external script uses global mode (setup(), draw() without p.),
    // this wrapper will still try to map them if possible, but instance-mode
    // is the reliable approach.

    const makeSketch = (p) => {
      // Provide desired size to the sketch
      const { w, h } = this.getDesiredSize();
      p.__RAVEL_W__ = w;
      p.__RAVEL_H__ = h;

      // Helpful defaults: expose width/height before createCanvas via getters
      // (p5 sets p.width/p.height after createCanvas; we provide fallbacks.)
      Object.defineProperty(p, "RAVEL_W", { get: () => this.getDesiredSize().w });
      Object.defineProperty(p, "RAVEL_H", { get: () => this.getDesiredSize().h });

      // Execute the external code with `p` in scope.
      // sandbox=true: isolate from window by shadowing common globals.
      try {
        if (sandbox) {
          const fn = new Function(
            "p",
            `"use strict";
             const window = undefined;
             const document = undefined;
             const globalThis = undefined;
             const self = undefined;
             // --- begin external sketch: ${srcLabel} ---
             ${sourceText}
             // --- end external sketch ---
            `
          );
          fn(p);
        } else {
          // Not sandboxed: external code can access window/document as usual
          const fn = new Function(
            "p",
            `"use strict";
             // --- begin external sketch: ${srcLabel} ---
             ${sourceText}
             // --- end external sketch ---
            `
          );
          fn(p);
        }
      } catch (e) {
        console.error("[Ravelp5Embed] Error evaluating sketch:", e);
        throw e;
      }

      // If the external script used global-mode style functions, try to adopt them.
      // (This only works if the external code defined them on `p`, or as locals returned somehow.
      // We can only reliably pick up things assigned onto `p`.)
      if (!p.setup) {
        // If they didn't define setup, create a minimal one
        p.setup = () => {
          p.createCanvas(this.getDesiredSize().w, this.getDesiredSize().h);
        };
      } else {
        // Ensure canvas exists at correct size if they forgot
        const userSetup = p.setup;
        p.setup = () => {
          userSetup?.();

          const { w, h } = this.getDesiredSize();

          // If they never created a canvas, create one once.
          if (!p.canvas) {
            p.createCanvas(w, h);
          } else if (typeof p.resizeCanvas === "function") {
            // Resize only if needed
            if (p.width !== w || p.height !== h) {
              p.resizeCanvas(w, h);
            }
          }

          // üîß Force visibility once
          requestAnimationFrame(() => {
            if (p.canvas) {
              p.canvas.style.visibility = "visible";
              p.canvas.style.display = "block";
              p.canvas.style.opacity = "1";
            }
          });
        };
      }
    };

    return makeSketch;
  }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-physics-world/ravel-physics-world.js"
/*!****************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-physics-world/ravel-physics-world.js ***!
  \****************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelPhysicsWorld_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelPhysicsWorld.js */ "../../core/web-components/custom-elements/gidgets/ravel-physics-world/src/RavelPhysicsWorld.js");
/*
Defines the custom element <ravel-physics-world>
*/



customElements.define('ravel-physics-world', _src_RavelPhysicsWorld_js__WEBPACK_IMPORTED_MODULE_0__.RavelPhysicsWorld);



/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-physics-world/src/RavelPhysicsWorld.js"
/*!******************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-physics-world/src/RavelPhysicsWorld.js ***!
  \******************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelPhysicsWorld: () => (/* binding */ RavelPhysicsWorld)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_ravelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/ravelComponentPath.js */ "../../core/web-components/common/ravelComponentPath.js");




// aliases for box2d stuff. Makes life easier.
var b2Vec2 = Box2D.Common.Math.b2Vec2
, b2AABB = Box2D.Collision.b2AABB
, b2BodyDef = Box2D.Dynamics.b2BodyDef
, b2Body = Box2D.Dynamics.b2Body
, b2FixtureDef = Box2D.Dynamics.b2FixtureDef
, b2Fixture = Box2D.Dynamics.b2Fixture
, b2World = Box2D.Dynamics.b2World
, b2MassData = Box2D.Collision.Shapes.b2MassData
, b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape
, b2CircleShape = Box2D.Collision.Shapes.b2CircleShape
, b2DebugDraw = Box2D.Dynamics.b2DebugDraw
,  b2MouseJointDef =  Box2D.Dynamics.Joints.b2MouseJointDef
;

window.requestAnimFrame = (function(){
          return  window.requestAnimationFrame       || 
                  window.webkitRequestAnimationFrame || 
                  window.mozRequestAnimationFrame    || 
                  window.oRequestAnimationFrame      || 
                  window.msRequestAnimationFrame     || 
                  function(/* function */ callback, /* DOMElement */ element){
                        window.setTimeout(callback, 1000 / 60);
                  };
    })();
    
class RavelPhysicsWorld extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            background-image: #000000;
            background-size: contain;
	        image-rendering: pixelated;
            pointer-events: auto;
            border: 2px dotted #ffff00;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="playfield">
        <slot></slot>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'damping', 'width', 'height'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.playfield = this.shadowRoot.querySelector('#playfield');
        this.slots = this.shadowRoot.querySelectorAll('slot');
    }
  
    setup = () => {
        this.pixelsToWorld = 30.0;
        let rect = this.container.getBoundingClientRect();
        this.x = rect.left;
        this.y = rect.top;
        console.log(`Rect: ${this.x} ${this.y}`);
        if (!this.width) this.width = rect.width;
        if (!this.height) this.height = rect.height;
        console.log(`Dim: ${this.width} ${this.height}`);
        // console.log(rect);
        this.world = null;
        this.grabbedIndex = -1;
        this.dampingRatio = 0.0;
        this.playfieldMembers = [];
        this.values = [];
        this.prevValues = [];
        this.world = new b2World(new b2Vec2(0, 0), true);
        rect = this.container.getBoundingClientRect();
        console.log(`Dim: ${this.width} ${this.height}`);
        this.initWorld();
        
        //this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);  
        
        /*this.shadowRoot.querySelector('#impulse').addEventListener('click', () => {
            for (let j = 0; j < this.playfieldMembers.length; j++) {
                console.log("Apply Impulse");
                console.log(this.playfieldMembers[j]);
                console.log(this.playfieldMembers[j].size);
                console.log(this.playfieldMembers[j].body);
                console.log(Number(this.playfieldMembers[j].body.GetAngle()));
                console.log(Number(this.playfieldMembers[j].body.GetPosition().x));
                console.log(this.playfieldMembers[j].body.GetPosition().y);
                console.log(this.playfieldMembers[j].body.GetAngularVelocity());
                this.playfieldMembers[j].body.ApplyImpulse(new b2Vec2(200, 200), this.playfieldMembers[j].body.GetWorldCenter());
            }
        }) */
    }
    
    initWorld() {
    	let fixDef = new b2FixtureDef;
    	fixDef.density = 1.0;
    	fixDef.restitution = 1.0;
    	fixDef.friction = 1.0;
        this.lookup = {};
        //for (i = 0; i < nFluxum; i++) {
        //	fluxum.push(new Fluxum(world, i, Math.random() * width - FLUXUM_W/2, Math.random() * height - FLUXUM_W/2, FLUXUM_W/2, FLUXUM_W/2, 10, 0));
        //}
        console.log('boundaries');
        console.log(`0, 0, ${this.width}, 10`);
        console.log(`${this.width}, 0, 10, ${this.height}`);
        console.log(`0, ${this.height}, ${this.width}, 10`);
        console.log(`0, 0, 10, ${this.height}`);
        this.boundaries = [];
	    this.boundaries.push(this.newBoundary(0, 0, this.width, 10));  // top
    	this.boundaries.push(this.newBoundary(this.width, 0, 10, this.height));  // right
    	this.boundaries.push(this.newBoundary(0, this.height, this.width, 10));  // bottom
    	this.boundaries.push(this.newBoundary(0, 0, 10, this.height));  // left
        // console.log(this.boundaries);
        
    	this.listener = new Box2D.Dynamics.b2ContactListener;       
        this.listener.BeginContact = (contact) => {
        	//console.log(contact);
        }
        this.world.SetContactListener(this.listener);
        this.mouseDownCallback = this.mouseDown.bind(this);
        this.mouseMovedCallback = this.mouseMoved.bind(this);
        this.mouseReleasedCallback = this.mouseReleased.bind(this);
        this.updateCallback = this.update.bind(this);
        this.addEventListener('pointerdown', this.mouseDownCallback);
        this.addEventListener('pointermove', this.mouseMovedCallback);
        this.addEventListener('pointerleave', this.mouseReleasedCallback);
        this.addEventListener('pointerup', this.mouseReleasedCallback);

        // Add children of playfield to playfieldMembers
        //let fluxum = this.shadowRoot.querySelectorAll("ravel-fluxum");
        // console.log(this.slots[0].assignedNodes());
        for (let member of this.slots[0].assignedNodes()) {
            if (member.tagName === 'RAVEL-FLUXUM') {
                this.lookup[member.id] = this.playfieldMembers.length;
                this.playfieldMembers.push(this.newFluxum(member));
                this.values.push(0);
                this.prevValues.push(0);
            }
            if (member.tagName === 'RAVEL-PHYSICS-SPRITE') {
                this.lookup[member.id] = this.playfieldMembers.length;
                this.playfieldMembers.push(this.newSprite(member));
            }
            if ((member.tagName === 'RAVEL-PHYSICS-POT') ||
                (member.tagName === 'RAVEL-PHYSICS-SLIDER') ||
                (member.tagName === 'RAVEL-PHYSICS-BUTTON')) {
                this.lookup[member.id] = this.playfieldMembers.length;
                this.playfieldMembers.push(this.newControl(member));
            }
        }
        
        window.addEventListener('resize', () => {
            // Reset the top and left. The world is already sized at previous width so leave it at that.
            let rect = this.getBoundingClientRect();
            this.x = rect.x;
            this.y = rect.y;
            // console.log(`New x y ${this.x} ${this.y}`)
        }, true);
        
        requestAnimFrame(this.updateCallback);
        
        /* // DEBUG
        for (let j = 0; j < this.playfieldMembers.length; j++) {
            console.log(this.playfieldMembers[j].element);
            console.log(this.playfieldMembers[j].size);
            console.log(this.playfieldMembers[j].body);
            console.log(this.playfieldMembers[j].body.GetAngle());
            console.log(this.playfieldMembers[j].body.GetPosition().x);
            console.log(this.playfieldMembers[j].body.GetPosition().y);
            console.log(this.playfieldMembers[j].body.GetAngularVelocity());
        }
        */
    }
    
    update() {
        for (let j = 0; j < this.playfieldMembers.length; j++) {
            this.playfieldMembers[j].element.transform(
                this.playfieldMembers[j].body.GetPosition().x * this.pixelsToWorld - (this.playfieldMembers[j].size),
                this.playfieldMembers[j].body.GetPosition().y * this.pixelsToWorld - (this.playfieldMembers[j].size),
                this.playfieldMembers[j].body.GetAngle()
            );
            this.values[j] = this.playfieldMembers[j].body.GetAngularVelocity();
            if (this.values[j] !== this.prevValues[j]) {
                this.sendMessage(`fluxum-${j + 1}`, 'playback-rate', this.values[j]);
            }
            this.prevValues = this.values[j];
		}
        this.world.Step(1/30, 10, 10);
        requestAnimFrame(this.updateCallback);
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    newFluxum(fluxumElement) {
        let x = parseInt(fluxumElement.getAttribute('x'), 10);
        let y = parseInt(fluxumElement.getAttribute('y'), 10);
        let size = parseInt(fluxumElement.getAttribute('size'), 10) * 0.45;
    	let fixDef = new b2FixtureDef;
    	fixDef.density = 1.0;
    	fixDef.restitution = 0.5;
    	fixDef.friction = 1.0;

    	let bodyDef = new b2BodyDef;
    	bodyDef.position.x = x / this.pixelsToWorld;
    	bodyDef.position.y = y / this.pixelsToWorld;
    	bodyDef.type = b2Body.b2_dynamicBody;

    	fixDef.shape = new b2CircleShape;
    	fixDef.shape.SetRadius(size / (this.pixelsToWorld), size / (this.pixelsToWorld));

    	let body = this.world.CreateBody(bodyDef);
    	body.CreateFixture(fixDef);
    	//so that we can access element from box2d
    	body.SetUserData(fluxumElement);
        fluxumElement.body = body;
        
        return ({
            element: fluxumElement,
            size: size,
            body: body
         });
    }
    
    newBoundary(x, y, w, h){
    	let bodyDef = new b2BodyDef;
	    // console.log(x + y + w + h);
    	bodyDef.position.x = x / this.pixelsToWorld;
    	bodyDef.position.y = y / this.pixelsToWorld;
    	bodyDef.type = b2Body.b2_staticBody;
	
    	let body = this.world.CreateBody(bodyDef);
	
    	let fixDef = new b2FixtureDef;
    	fixDef.density = 1.0;
    	fixDef.restitution = 0.5;
    	fixDef.friction = 1.0;
	
    	fixDef.shape = new b2PolygonShape;
    	fixDef.shape.SetAsBox(w / this.pixelsToWorld, h / this.pixelsToWorld);
    	body.CreateFixture(fixDef);
    
        return body;
    }
    
    mouseDown(evt) { 
        for (let j = 0; j < this.playfieldMembers.length; j++) {
            if (this.mouseInBounds(evt.clientX, evt.clientY, 
                              this.playfieldMembers[j].body.GetPosition().x * this.pixelsToWorld,
                              this.playfieldMembers[j].body.GetPosition().y * this.pixelsToWorld,
                              this.playfieldMembers[j].size
                )) {
            	this.mouse_pressed = true;
            	this.grabbedIndex = j;
                //console.log(this.playfieldMembers[this.grabbedIndex].body);
            }
        }
    }
    
    mouseMoved(evt) {
        //console.log('mouse move ' + evt.clientX + " " + evt.clientY);
    	let p = new b2Vec2((evt.clientX - this.x) / this.pixelsToWorld, (evt.clientY - this.y) / this.pixelsToWorld);
	
    	if (this.mouse_pressed && !this.mouse_joint && this.grabbedIndex >= 0)
    	{
    		//if no joint exists then create
    		let def = new b2MouseJointDef();
	        // console.log(this.boundaries[0]);
            // console.log(this.playfieldMembers[this.grabbedIndex].body);
    		def.bodyA = this.boundaries[0];
    		def.bodyB = this.playfieldMembers[this.grabbedIndex].body;
    		def.target = p;

    		def.collideConnected = true;
    		def.maxForce = 1000 * this.playfieldMembers[this.grabbedIndex].body.GetMass();
    		def.dampingRatio = this.dampingRatio;
	
    		this.mouse_joint = this.world.CreateJoint(def);
	
    		this.playfieldMembers[this.grabbedIndex].body.SetAwake(true);
    	}

    	if (this.mouse_joint)
    	{
    		this.mouse_joint.SetTarget(p);
    	}
    }
   
    mouseReleased(evt) {
        //console.log(this.mouse_joint);
        this.grabbedIndex = -1;
    	this.mouse_pressed = false;
    	if (this.mouse_joint)
    	{
    		this.world.DestroyJoint(this.mouse_joint);
    		this.mouse_joint = false;
    	}
    }

    mouseInBounds(mx, my, x1, y1, radius) {
       // rect = element.getBoundingClientRect();
       // console.log(rect.top, rect.right, rect.bottom, rect.left);
        
        //console.log(radius);
	    // console.log ("x: " + (x1 - radius) + " < " + mx + " < " + (x1 + radius));
		// console.log ("y: " + (y1 - radius) + " < " + my + " < " + (y1 + radius));
        // Take into account this.x and y, the offset of the enclosing container
        const rect = this.container.getBoundingClientRect();

        mx = mx - rect.left;
        my = my - rect.top;
        console.log(rect.width);
        //console.log(`${mx}, ${my} : ${x1}, ${y1}`);
		/*if ((mx < (x1 + this.x + radius)) &&
		    (mx > (x1 + this.x - radius)) &&
			(my < (y1 + this.y + radius)) &&
			(my > (y1 + this.y - radius))) {
        */
        if ((mx < (x1 + radius)) &&
		    (mx > (x1 - radius)) &&
			(my < (y1 + radius)) &&
			(my > (y1 - radius))) {
                console.log('mouse in bounds ');
				return true;
		} else {
            console.log('not in bounds');
			return false;
		}
	}
        
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'damping') {
            this.dampingRatio = Number(newValue);
        }
        if (name === 'width') {
            this.width = Number(newValue);
        }
        if (name === 'height') {
            this.height = Number(newValue);
        }
    }
}



/* // Original code:

function Fluxum(id_, x_, y_, w_, h_, mass_){

    this.id = id_;
	this.x = x_;
	this.y = y_;
	this.mass = mass_;
	this.width = w_;    
	this.height = h_;
	this.world_radius = this.width / PIXELS_TO_WORLD;
	this.body = null;
    this.sprite = img[id_ % maxFluxum];

	var fixDef = new b2FixtureDef;
	fixDef.density = 1.0;
	fixDef.restitution = RESTITUTION;
	fixDef.friction = 1.0;

	var bodyDef = new b2BodyDef;
	bodyDef.position.x = this.x/PIXELS_TO_WORLD;
	bodyDef.position.y = this.y/PIXELS_TO_WORLD;
	bodyDef.type = b2Body.b2_dynamicBody;

	fixDef.shape = new b2CircleShape;
	fixDef.shape.SetRadius(this.width/(PIXELS_TO_WORLD), this.height/(PIXELS_TO_WORLD));

	this.body = world.CreateBody(bodyDef);
	this.body.CreateFixture(fixDef);
    
	//so that we can access element from box2d
	this.body.SetUserData(this);
	
	this.mouseInBounds = function() {
		var mx = mouseX / PIXELS_TO_WORLD;
		var my = mouseY / PIXELS_TO_WORLD;
		var x1 = this.body.GetPosition().x;
		var y1 = this.body.GetPosition().y;
		
	    //console.log ("x: " + (x1 - this.world_radius) + " < " + mx + " < " + (x1 + this.world_radius));
		//console.log ("y: " + (y1 - this.world_radius) + " < " + my + " < " + (y1 + this.world_radius));
		if ((mx < (x1 + this.world_radius)) &&
		    (mx > (x1 - this.world_radius)) &&
			(my < (y1 + this.world_radius)) &&
			(my > (y1 - this.world_radius))) {
				return true;
		} else {
			return false;
		}
	}
	
	this.tempo = 0;
	this.prevTempo = 0; 
	this.spinning = false;
    this.prevSpinning = false;
	
	this.updateAudioRate = function() {
        this.tempo = (this.body.GetAngularVelocity())*3;
        if (this.tempo != this.prevTempo) {
			//console.log("Set " + this.tempo);
            // set tempo
			//updateSlider(this.tempo, this.id);
        } 
		this.prevTempo = this.tempo;
        if (abs(this.tempo) > 0.015) {
			this.prevSpinning = this.spinning;
            this.spinning = true;
        } else {
			this.prevSpinning = this.spinning;
            this.spinning = false;
        }
	    if (!this.prevSpinning && this.spinning) {
	        // turn on
			//playSound(this.id);
			this.prevSpinning = true;
	    }
	    if (this.prevSpinning && !this.spinning) {
	        // turn off
			//stopSound(this.id);
			this.prevSpinning = false;
	    }
		//console.log("tempo " + this.tempo + " spinning " + this.spinning );
	}
}
*/

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-pot/ravel-pot.js"
/*!********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-pot/ravel-pot.js ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelPot_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelPot.js */ "../../core/web-components/custom-elements/gidgets/ravel-pot/src/RavelPot.js");

/*
Defines the custom element <ravel-pot>
*/



customElements.define('ravel-pot', _src_RavelPot_js__WEBPACK_IMPORTED_MODULE_0__.RavelPot);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-pot/src/RavelPot.js"
/*!***********************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-pot/src/RavelPot.js ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelPot: () => (/* binding */ RavelPot)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");





class RavelPot extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
        }
        #pot-marker, #pot-knob {
            position: relative;
        }
        #sensor {
            position: absolute;
            left: -10%;
            top: -10%;
            width: 120%;
            height: 120%;
            border-radius: 50%;
            
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="sensor"></div>
        <div id="pot-knob"></div>
        <div id="pot-marker"></div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'size', 'w', 'h', 'use-svg', 'color',
            'marker', 'icon', 'marker', 'angle', 'min', 'max',
            'value', 'signals', 'signal-out'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.potMarker = this.shadowRoot.querySelector('#pot-marker');
        this.potKnob = this.shadowRoot.querySelector('#pot-knob');
        this.sensor = this.shadowRoot.querySelector('#sensor');
        this.marker = '';
        this.icon = 'white-circle';
        this.size = 24;
        this.signals = [];
        this.value = 0;
        this.noClick = false;
        this.showFeedback = false;
        this.x = 0;
        this.y = 0;
        this.width = 50;
        this.height = 50;
        this.min = 0;
        this.max = 1;
        this.offsetX = 0;
        this.offsetY = 0;
        this.angle = 0;
        this.useSvg = false;
    }
  
    setup = () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.subscribe(this.signals);  
        //this.potKnob.textContent = RavelEmoji.getRandomRoundEmoji();
        //this.potMarker .textContent = RavelEmoji['white-circle']; // 
        // x, y are the center point

        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style['width'] = `${this.width}px`;
        this.container.style['height'] = `${this.height}px`;
        this.container.style['font-size'] = `${this.width}px`;
        this.container.style['font-size'] = `${this.width}px`;
        this.potKnob.textContent = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji[this.icon];
        this.potMarker.textContent = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji[this.marker]; // 
        this.potMarker.style['font-size'] = `${this.width / 5}px`;
        this.potMarker.style['top'] = `-${this.width - this.width / 16}px`;
        this.potMarker.style['left'] = `${- this.width /  4 }px`;
        this.potKnob.style['line-height'] = `-${this.width + 10}px`;
        this.setFromValue();
        if (this.useSvg) {
            this.shadowRoot.querySelector('#pot-knob').innerHTML = this.potSvg;
            this.shadowRoot.querySelector('#pot-knob-svg').style.width = `${this.width}px`;
            this.shadowRoot.querySelector('#pot-knob-svg').style.height = `${this.height}px`;
            this.shadowRoot.querySelector('#pot-knob-svg').querySelector('#circle').style.fill = `${this.color}`;
        }
        //this.potKnob.style['top'] = `-${this.size / 8}px`;
        this.potMarker.style['opacity'] = `0.75`;
        const rect = this.container.getBoundingClientRect();
        this.centerX = rect.left + rect.width / 2;
        this.centerY = rect.top + rect.height / 2;
        if (!this.noClick) {
            this.addEventListener('pointerdown', this.handleClick);
        }
        this.addEventListener(`${this.id}`, this.handleEvent);
        this.broadcastMessage('register-sensor', this.id, this.container);
        //this.broadcastMessage('register-sensor', this.id, { x: this.x + this.w/2, y: this.y + this.h/2, w: this.w, h: this.height });
    }

    handleClick = (e) => {
        e.preventDefault();
        // Update center values dynamically in case layout shifted
        const rect = this.container.getBoundingClientRect();
        this.centerX = rect.left + rect.width / 2;
        this.centerY = rect.top + rect.height / 2;
        this.calculatePotAngle(e.clientX, e.clientY);
        document.addEventListener('pointermove', this.dragElement);
        document.addEventListener('pointerup', this.endDragElement);
        document.addEventListener('pointerleave', this.endDragElement);
    }

    dragElement = (e) => {
        e.preventDefault();
        this.calculatePotAngle(e.clientX + this.offsetX, e.clientY + this.offsetY);
    }

    endDragElement = () => {
        document.removeEventListener('pointermove', this.dragElement);
        document.removeEventListener('pointerup', this.endDragElement);
        document.removeEventListener('pointerleave', this.endDragElement);
    }

    handleEvent = (e) => {
        e.preventDefault();
        const type = e.detail.cmd;
        console.log(type);
        if (type === 'select') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 0, 0.5)';
        }
        if (type === 'unselect') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 255, 0)';
        }
        if (type === 'virtual-click') {
            let x = e.detail.content.startX;
            let y = e.detail.content.startY;
            this.offsetX = Number(e.detail.content.offsetX);
            this.offsetY = Number(e.detail.content.offsetY);
            const rect = this.container.getBoundingClientRect();
            this.centerX = (rect.left + rect.width / 2);
            this.centerY = (rect.top + rect.height / 2);
            this.calculatePotAngle(x + this.offsetX, y + this.offsetY);
            document.addEventListener('pointermove', this.dragElement);
            document.addEventListener('pointerup', this.endDragElement);
            document.addEventListener('pointerleave', this.endDragElement);
            console.log(this.offsetX + " " + this.offsetY);
        }
        if (type === 'virtual-drag') {
            this.calculatePotAngle(e.clientX, e.clientY);
        }
        if (type === 'virtual-release') {
            this.offsetX = 0;
            this.offsetY = 0;
            document.removeEventListener('pointermove', this.dragElement);
            document.removeEventListener('pointerup', this.endDragElement);
            document.removeEventListener('pointerleave', this.endDragElement);
        }
    }

    
    teardown = () => {
        this.unsubscribe(this.signals);
        this.broadcastMessage('register-sensor', this.id);
        if (!this.noClick) {
            this.removeEventListener('pointerdown', this.handleClick);
        }
        this.removeEventListener(`${this.id}`, this.handleEvent);
    }
    
    calculatePotAngle = (x, y) => {
    	let d1 = y - this.centerY;
    	let d2 = x - this.centerX;
    	let r = Math.sqrt(Math.pow(d1, 2) + Math.pow(d2, 2));
    	let a = -Math.asin(d1 / r);
        if (x > this.centerX)  {
            a = 3.14 - a;
        }
        if ((x < this.centerX) && (y > this.centerY))  {
            a = 6.28 + a;
        }
    	//console.log("Angle " + (a * 57.296));
    	a = (a * 57.296);
        // TODO: add a check for pinned High or Low
        if (!((a > 210) && (a < 300))) {
            this.angle = a;
            this.container.style["transform"] = "rotate(" + this.angle + "deg)";
        }
       // console.log(this.angle);
        if (this.angle <= 210) {
            this.value = this.map(this.angle, 0, 210, 0.3, 1);
        } else {
            this.value = this.map(this.angle, 305, 360, 0, .3);
        }
        this.sendMessage(this.signalOut, this.id, this.value);
        //console.log(`send: ${this.signalOut} ${(this.value)}`);
    }

    setFromValue = () => {
        console.log(this.value + ' ' + this.angle);
        if (this.value <= 0.3) {
            this.angle = this.map(this.value, 0, 0.3, 305, 360);
        } else {
            this.angle = this.map(this.value, 0.3, 1.0, 0, 210);
        }
        console.log(this.angle);
        this.container.style["transform"] = "rotate(" + this.angle + "deg)";
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.container.style.position = 'absolute';
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.container.style.position = 'absolute';
            this.y = Number(newValue);
        }
        if (name === 'use-svg') {
            this.useSvg = true;
        }
        if (name === 'w') {
            this.width = Number(newValue);
        }
        if (name === 'h') {
            this.height = Number(newValue);
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'icon') {
            this.icon = newValue;
        }
        if (name === 'marker') {
            this.marker = newValue;
        }
        if (name === 'angle') {
            this.angle = Number(newValue);
        }
        if (name === 'value') {
            this.value = Number(newValue);
        }
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'show-feedback') {
            this.showFeedback = true;
        }
    }

    map = (val, in_min, in_max, out_min, out_max) => {
        return (val - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }

    potSvg = `
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   version="1.1"
   id="pot-knob-svg"
   width="267.03113"
   height="257.45898"
   viewBox="0 0 267.03113 257.45898"
   sodipodi:docname="pot-1.svg"
   inkscape:version="1.3.2 (091e20e, 2023-11-25)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs1" />
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="4.9166667"
     inkscape:cx="45.050847"
     inkscape:cy="124.67797"
     inkscape:window-width="1336"
     inkscape:window-height="841"
     inkscape:window-x="0"
     inkscape:window-y="38"
     inkscape:window-maximized="0"
     inkscape:current-layer="g1"
     showguides="false" />
  <g
     inkscape:groupmode="layer"
     inkscape:label="Image"
     id="g1"
     transform="translate(-1052.7501,459.03516)">
    <path
       id="rect70"
       style="fill:#000000;fill-opacity:0.5;stroke:none;stroke-width:1.64482"
       d="M 1146.9317 -459.03516 L 1146.9317 -417.36914 L 1107.1778 -417.36914 L 1107.1778 -374.47071 L 1061.379 -374.47071 L 1061.379 -286.45313 L 1062.3224 -286.45313 L 1062.3224 -286.18555 L 1107.1778 -286.18555 L 1107.1778 -243.24219 L 1146.9317 -243.24219 L 1146.9317 -201.57618 L 1235.17 -201.57618 L 1235.17 -243.24219 L 1274.9239 -243.24219 L 1274.9239 -286.18555 L 1319.7813 -286.18555 L 1319.7813 -374.42383 L 1274.9239 -374.42383 L 1274.9239 -417.36914 L 1235.17 -417.36914 L 1235.17 -459.03516 L 1146.9317 -459.03516 z " />
    <path
       id="circle"
       style="fill:#e3b505;fill-opacity:1;stroke:none;stroke-width:1.33333"
       d="m 1191.0508,-411.66211 a 81.355934,81.355934 0 0 0 -78.5508,60.6875 h 38.9844 v 41.33789 H 1112.5 a 81.355934,81.355934 0 0 0 78.5508,60.6875 81.355934,81.355934 0 0 0 81.3554,-81.35547 81.355934,81.355934 0 0 0 -81.3554,-81.35742 z" />
    <rect
       style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1.58756"
       id="rect72"
       width="90.982903"
       height="41.254181"
       x="1061.0891"
       y="-351.0853" />
  </g>
</svg>
`;
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition-2/ravel-progressive-composition-2.js"
/*!****************************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-progressive-composition-2/ravel-progressive-composition-2.js ***!
  \****************************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelProgressiveComposition2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelProgressiveComposition2.js */ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition-2/src/RavelProgressiveComposition2.js");

/*
Defines the custom element <ravel-progressive-composition-2>
*/



customElements.define('ravel-progressive-composition-2', _src_RavelProgressiveComposition2_js__WEBPACK_IMPORTED_MODULE_0__.RavelProgressiveComposition2);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition-2/src/RavelProgressiveComposition2.js"
/*!*****************************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-progressive-composition-2/src/RavelProgressiveComposition2.js ***!
  \*****************************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelProgressiveComposition2: () => (/* binding */ RavelProgressiveComposition2)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");




class RavelProgressiveComposition2 extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #composition-grid {
            padding: 10px;
            display: grid;
            grid: auto / auto auto auto auto;
        }
        .grid-item {
            display: flex;
            flex-wrap: wrap;
            width: 76px;
            height: 56px;
            font-size: 14px;
            margin: 5px;
            padding-top: 2px;
            padding-left: 2px;
            border: 6px solid rgba(0, 0, 0, 0.9);
        }
        .background-0 {
            background-color: rgba(255, 255, 255, 0.8);
        }
        .background-1 {
            background-color: rgba(255, 255, 255, 0.75);
        }
        .background-2 {
            background-color: rgba(255, 255, 255, 0.70);
        }
        .background-3 {
            background-color: rgba(255, 255, 255, 0.65);
        }
        .background-4 {
            background-color: rgba(255, 255, 255, 0.60);
        }
        .background-5 {
            background-color: rgba(255, 255, 255, 0.55);
        }
        .background-6 {
            background-color: rgba(255, 255, 255, 0.50);
        }
        .background-7 {
            background-color: rgba(255, 255, 255, 0.45);
        }
        .background-8 {
            background-color: rgba(255, 255, 255, 0.40);
        }
        .background-9 {
            background-color: rgba(255, 255, 255, 0.35);
        }
        .background-10 {
            background-color: rgba(255, 255, 255, 0.30);
        }
        .background-11 {
            background-color: rgba(255, 255, 255, 0.25);
        }
        .background-12 {
            background-color: rgba(255, 255, 255, 0.20);
        }
        .performer {
            margin: 0px 2px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
            <div id="composition-grid">
            </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'rows', 'cols', 'source'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.grid = this.shadowRoot.querySelector('#composition-grid');
        this.performers = 12;
        this.performerIcon = [];
        this.performerSection = [];
        this.sections = 12;
        this.autoplay = false;
        this.autoplayTimer = null;
        this.maxSection = 0;
        this.minSection = 0;
    }
  
    setup = () => {
        this.observedMessages = [];
        //this.subscribe(this.observedMessages);  
        for (let i = 0; i < this.sections; i ++) {
            this.grid.innerHTML += `
            <div id="composition-grid-item-${i}" class="grid-item background-${i}"></div>
            `;
        } 

        console.log('1');
        for (let i = 0; i < this.sections; i ++) {
            this.shadowRoot.querySelector(`#composition-grid-item-${i}`).addEventListener('click', (evt) => {
                console.log(`Clicked ${i}`);
                this.moveRandomPerformer(i);
            });
        } 
        console.log('2');
        for (let i = 0; i < this.performers; i ++) {
            //let icon = RavelEmoji.getRandomSquareColor();
            let icon = '‚ö´Ô∏è';
            this.performerIcon.push(icon);
            this.performerSection.push(0);
            this.shadowRoot.querySelector(`#composition-grid-item-0`).innerHTML += `
            <span id="performer-${i}" class="performer">${icon}</span>
            `;
        }
        console.log('3');
        /*
        // FIXME: Add auto play
        this.shadowRoot.querySelector(`#auto-play`).addEventListener('click', (evt) => {
            console.log('auto play');
            this.autoplay = !this.autoplay;
            if (this.autoplay) {
                this.autoPlayTimer = setInterval(() => {
                        this.moveRandomPerformer(this.performerSection[Math.floor(Math.random() * this.performers)]);
                    },
                    200
                );
            } else {
                if (this.autoPlayTimer) clearInterval(this.autoPlayTimer);
            }
        });
        */
    }
    
    moveRandomPerformer(section) {
        let performersInSection = [];
        for (let i = 0; i < this.performerSection.length; i++) {
            if (this.performerSection[i] === section) {
                performersInSection.push(i);
            }
        }
        if (performersInSection.length > 0) {
            let n = performersInSection[Math.floor(Math.random() * performersInSection.length)];
            if (this.performerSection[n] < (this.sections -1)) {
                this.performerSection[n]++;
                let p = this.shadowRoot.querySelector(`#performer-${n}`);
                console.log(p);
                this.shadowRoot.querySelector(`#composition-grid-item-${this.performerSection[n]}`).appendChild(p);
                if (this.performerSection[n] > this.maxSection) this.maxSection = this.performerSection[n];
            } 
        }
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition/ravel-progressive-composition.js"
/*!************************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-progressive-composition/ravel-progressive-composition.js ***!
  \************************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelProgressiveComposition_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelProgressiveComposition.js */ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition/src/RavelProgressiveComposition.js");

/*
Defines the custom element <ravel-progressive-composition>
*/



customElements.define('ravel-progressive-composition', _src_RavelProgressiveComposition_js__WEBPACK_IMPORTED_MODULE_0__.RavelProgressiveComposition);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-progressive-composition/src/RavelProgressiveComposition.js"
/*!**************************************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-progressive-composition/src/RavelProgressiveComposition.js ***!
  \**************************************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelProgressiveComposition: () => (/* binding */ RavelProgressiveComposition)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");




class RavelProgressiveComposition extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #composition-grid {
            display: grid;
            grid: auto / auto auto auto;
        }
        .grid-item {
           width:140px;
           height:100px;
            font-size:24px;
            border: 1px dotted red;
        }
        #auto-play {
            position:absolute;
            right:20px;
            top: 80%;
            font-size: 80px;
        }
        #auto-play-indicator {
            margin-bottom: -32px;
            margin-left:30px;
            font-size:24px;
        }
        #slider-container {
            position: absolute;
            bottom: 50px;
            left: 20px;
            width: 300px;
        }
        @-webkit-keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        @keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        .pulse {
          display: inline-block;
          vertical-align: middle;
          -webkit-transform: perspective(1px) translateZ(0);
          transform: perspective(1px) translateZ(0);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0);
         -webkit-animation-name: pulse;
          animation-name: pulse;
          -webkit-animation-duration: 0.3s;
          animation-duration: 0.3s;
          -webkit-animation-timing-function: linear;
          animation-timing-function: linear;
          -webkit-animation-iteration-count: infinite;
          animation-iteration-count: infinite;
          -webkit-animation-direction: alternate;
          animation-direction: alternate;
        }
        .scale-out-center {
        	-webkit-animation: scale-out-center 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
        	        animation: scale-out-center 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
        }
        @-webkit-keyframes scale-out-center {
          0% {
            -webkit-transform: scale(1);
                    transform: scale(1);
            opacity: 1;
          }
          100% {
            -webkit-transform: scale(0);
                    transform: scale(0);
            opacity: 1;
          }
        }
        @keyframes scale-out-center {
          0% {
            -webkit-transform: scale(1);
                    transform: scale(1);
            opacity: 1;
          }
          100% {
            -webkit-transform: scale(0);
                    transform: scale(0);
            opacity: 1;
          }
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
            <div id="composition-grid">
            </div>
            <div id="slider-container">
            <ravel-slider size="20px"></ravel-slider>
            </div>
            <div id="auto-play">
           <div id="auto-play-indicator">‚ö´Ô∏è</div>
           üêê
           </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'source'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.grid = this.shadowRoot.querySelector('#composition-grid');
        this.performers = 12;
        this.performerIcon = [];
        this.performerSection = [];
        this.sections = 12;
        this.autoplay = false;
        this.autoplayTimer = null;
        this.maxSection = 0;
        this.minSection = 0;
    }
  
    setup = () => {
        this.observedMessages = [];
        //this.subscribe(this.observedMessages);  
        for (let i = 0; i < this.sections; i ++) {
            this.grid.innerHTML += `
            <div id="composition-grid-item-${i}" class="grid-item"></div>
            `;
        } 

        console.log('1');
        for (let i = 0; i < this.sections; i ++) {
            this.shadowRoot.querySelector(`#composition-grid-item-${i}`).addEventListener('click', (evt) => {
                console.log(`Clicked ${i}`);
                this.moveRandomPerformer(i);
            });
        } 
        console.log('2');
        for (let i = 0; i < this.performers; i ++) {
            let icon = _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__.RavelEmoji.getRandomEmoji();
            this.performerIcon.push(icon);
            this.performerSection.push(0);
            this.shadowRoot.querySelector(`#composition-grid-item-0`).innerHTML += `
            <span id="performer-${i}">${icon}</span>
            `;
        }
        console.log('3');
        this.shadowRoot.querySelector(`#auto-play`).addEventListener('click', (evt) => {
            console.log('auto play');
            this.autoplay = !this.autoplay;
            if (this.autoplay) {
                this.autoPlayTimer = setInterval(() => {
                        this.moveRandomPerformer(this.performerSection[Math.floor(Math.random() * this.performers)]);
                    },
                    200
                );
                this.shadowRoot.querySelector(`#auto-play`).classList.add('pulse');
            } else {
                if (this.autoPlayTimer) clearInterval(this.autoPlayTimer);
                this.shadowRoot.querySelector(`#auto-play`).classList.remove('pulse');
            }
        });
        
    }
    
    moveRandomPerformer(section) {
        let performersInSection = [];
        for (let i = 0; i < this.performerSection.length; i++) {
            if (this.performerSection[i] === section) {
                performersInSection.push(i);
            }
        }
        if (performersInSection.length > 0) {
            let n = performersInSection[Math.floor(Math.random() * performersInSection.length)];
            if (this.performerSection[n] < (this.sections -1)) {
                this.performerSection[n]++;
                let p = this.shadowRoot.querySelector(`#performer-${n}`);
                this.shadowRoot.querySelector(`#auto-play-indicator`).innerText = this.performerIcon[n];
                console.log(p);
                this.shadowRoot.querySelector(`#composition-grid-item-${this.performerSection[n]}`).appendChild(p);
                if (this.performerSection[n] > this.maxSection) this.maxSection = this.performerSection[n];
            } 
        }
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-recorder/ravel-recorder.js"
/*!******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-recorder/ravel-recorder.js ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelRecorder_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelRecorder.js */ "../../core/web-components/custom-elements/gidgets/ravel-recorder/src/RavelRecorder.js");
/*
Defines the custom element <ravel-recorder>
*/



customElements.define('ravel-recorder', _src_RavelRecorder_js__WEBPACK_IMPORTED_MODULE_0__.RavelRecorder);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-recorder/src/RavelRecorder.js"
/*!*********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-recorder/src/RavelRecorder.js ***!
  \*********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelRecorder: () => (/* binding */ RavelRecorder)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");





class RavelRecorder extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #image {
            display: none;
            width: 100px;
            margin: 20px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <img id="image" src="${_common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__.ravelComponentPath}/images/recorder.png"/>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'name', 'show-image'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
        this.mediaRecorder = null;					
        this.input = null;
        this.chunks = [];					
        this.audioContext = window.AudioContext || window.webkitAudioContext; 
        this.audioUrl = null;
        this.name = 'foo';
        this.showImage = false;
    }

    setup = () => {
        this.observedMessages = [`${this.name}`];
        this.subscribe(this.observedMessages); 
        if (this.showImage) {
            this.shadowRoot.querySelector('#image').style.display = 'block';
        }  
        this.addEventListener(`${this.name}`, this.handleEvent);
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }

    handleEvent = (evt) => {
        if (evt.detail.cmd === 'start-recording') {
            this.record();
        }
        if (evt.detail.cmd === 'stop-recording') {
            this.stopRecording();
        }
        if (evt.detail.cmd === 'play-recording') {
            this.playRecording();
        }
    }
    
    loadSavedRecording = () => {
        this.readBlobFromDisk();
    }
	
	record = async () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true })
            .then((stream) => {
                this.mediaRecorder = null;
                this.mediaRecorder = new MediaRecorder(stream);
                this.mediaRecorder.start();
                
                let chunks = [];
                this.mediaRecorder.ondataavailable = (e) => {
                    chunks.push(e.data);
                };
                this.mediaRecorder.onstop = async (e) => {
                    let arrayBuffer = await chunks[0].arrayBuffer();
                    let trimmedRecording = await this.trimSilence(arrayBuffer);
                    let normalizedRecording = await this.normalize(trimmedRecording);
                    const blob = new Blob([normalizedRecording], { type: "audio/wav;" });
                    chunks = [];
                    this.audioUrl = URL.createObjectURL(blob);
            		await this.saveBlob(blob);
                };
            })
            .catch((err) => {
              console.warn(`The following getUserMedia error occurred: ${err}`);
            });
        } else {
            console.warn(`Couldn't resolve media devices`);
        }
	}

    trimSilence = async (buffer) => {
        return new Promise((resolve, reject) => { 
            let arrayBuffer = new Uint8Array(buffer);
            // find the first non-zero sample in the recorded samples
            let start = 0;
            for (let i = 0; i < arrayBuffer.length; i++) {
                if (arrayBuffer[i] !== 0) {
                    start = i;
                    break;
                }
            }
            // find the last non-zero sample in the recorded samples
            let end = arrayBuffer.length - 1;
            for (let i = arrayBuffer.length - 1; i >= 0; i--) {
                if (arrayBuffer[i] !== 0) {
                    end = i;
                    break;
                }
            }
            // trim the silence from the beginning and end of the recorded samples
            resolve(arrayBuffer.slice(start, end + 1).buffer);
        });
    }

    normalize = async (arrayBuffer) => {
        return new Promise((resolve, reject) => { 
            resolve(arrayBuffer);
        });
    }

        /* something like this:
        return new Promise((resolve, reject) => { 
            try {
                // Convert ArrayBuffer to Float32Array
                let samples = new Float32Array(arrayBuffer);

                // Find the maximum absolute value in the samples
                let max = 0;
                for (let i = 0; i < samples.length; i++) {
                    max = Math.max(max, Math.abs(samples[i]));
                }
                // If max is 0, avoid divide-by-zero
                if (max === 0) {
                    resolve(samples); // nothing to normalize
                    return;
                }
                // Normalize the recorded samples
                let normalizedSamples = samples.map(sample => sample / max);
                resolve(normalizedSamples.buffer); // return as ArrayBuffer
            } catch (err) {
                reject(err);
            }
        });
        */

	stopRecording =  async (n) => {
        if (this.mediaRecorder) {
		    this.mediaRecorder.stop();
        }
	}

    playRecording = () => {
        console.log('play recording');
    }
	
	saveBlob = async (blob) => {
	   let reader = new window.FileReader();
	   let stringArray = '';
       
       return new Promise((resolve, reject) => { 
		   reader.readAsDataURL(blob);     // Base64 encoded
		   reader.onloadend = () => {
			   stringArray = reader.result;
			   stringArray = stringArray.split(',')[1];
			   // save to local storage
		   } 
       });
	}
	
	bytestringToBlob = (b64Data) => {
		const byteCharacters = atob(b64Data);
		const byteArrays = [];

		for (let offset = 0; offset < byteCharacters.length; offset += 512) {
		const slice = byteCharacters.slice(offset, offset + 512);

		const byteNumbers = new Array(slice.length);
		for (let i = 0; i < slice.length; i++) {
		  byteNumbers[i] = slice.charCodeAt(i);
		}

		const byteArray = new Uint8Array(byteNumbers);
		    byteArrays.push(byteArray);
		}

		const blob = new Blob(byteArrays, { type: 'audio/wav' });
		return blob;
	}
	
	readBlobFromLocalStorage = () => {
		// this.audioSlotUrl = URL.createObjectURL(FluxlyRecordings.bytestringToBlob(blobData));
	}

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'name') {
            this.name = newValue;
        }
        if (name === 'show-image') {
            this.showImage = true;
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-sequencer/ravel-sequencer.js"
/*!********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-sequencer/ravel-sequencer.js ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSequencer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSequencer.js */ "../../core/web-components/custom-elements/gidgets/ravel-sequencer/src/RavelSequencer.js");
/*
Defines the custom element <ravel-sequencer>
*/



customElements.define('ravel-sequencer', _src_RavelSequencer_js__WEBPACK_IMPORTED_MODULE_0__.RavelSequencer);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-sequencer/src/RavelSequencer.js"
/*!***********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-sequencer/src/RavelSequencer.js ***!
  \***********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSequencer: () => (/* binding */ RavelSequencer)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");




class RavelSequencer extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        </style>
        `;
    }
  
    static get html() { 
        return `
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'attribute'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        // e.g. this.icon = this.shadowRoot.querySelector('#icon');
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
    }
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        
        if (name === 'attribute') {
            // Do something
        }
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-slider-2/ravel-slider-2.js"
/*!******************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-slider-2/ravel-slider-2.js ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSlider2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSlider2.js */ "../../core/web-components/custom-elements/gidgets/ravel-slider-2/src/RavelSlider2.js");

/*
Defines the custom element <ravel-slider-2>
*/



customElements.define('ravel-slider-2', _src_RavelSlider2_js__WEBPACK_IMPORTED_MODULE_0__.RavelSlider2);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-slider-2/src/RavelSlider2.js"
/*!********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-slider-2/src/RavelSlider2.js ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSlider2: () => (/* binding */ RavelSlider2)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _common_RavelComponentPath_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../common/RavelComponentPath.js */ "../../core/web-components/common/RavelComponentPath.js");




class RavelSlider2 extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #slider-background {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #slider-handle {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0px;
        }
        #sensor {
            position: absolute;
            border-radius: 24px;
        }
        .pixelArt {
            position: absolute;
        }
        .transparent {
            background-color: rgba(255, 255, 255, 0);
        }
        .light-pixel {
            background-color: #aaaaaa;
        }
        .dark-pixel {
            background-color: #000000;
        }
        .color-pixel {
            background-color: #FFFF00;
        }
        #handle-shadow {
            opacity: 0.5;
            background-color: #000000;
        }
        #handle-container {
            position: absolute;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="sensor"></div>
        <div id="slider-background">
            <div id="top-side" class="dark-pixel pixelArt"></div>
            <div id="left-side" class="dark-pixel pixelArt"></div>
            <div id="left-margin" class="light-pixel pixelArt"></div>
            <div id="right-margin" class="light-pixel pixelArt"></div>
            <div id="right-side" class="dark-pixel pixelArt"></div>
            <div id="bottom-side" class="dark-pixel pixelArt"></div>            
            <div id="center" class="light-pixel pixelArt"></div>
            <div id="center-line" class="dark-pixel pixelArt"></div>
            <div id="handle-container">
                <div id="slider-handle">
                    <div id="handle-top-side" class="dark-pixel pixelArt"></div>
                    <div id="handle-left-side" class="dark-pixel pixelArt"></div>
                    <div id="handle-center" class="color-pixel pixelArt"></div>
                    <div id="handle-center-line" class="dark-pixel pixelArt"></div>
                    <div id="handle-right-side" class="dark-pixel pixelArt"></div>
                    <div id="handle-bottom-side" class="dark-pixel pixelArt"></div>
                    <div id="handle-shadow" class="pixelArt"></div>
                </div>
            </div>
        </div>

        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'size', 'w', 'h',
            'color', 'pixel-size', 'margin',
            'min', 'max', 'step', 'value',
            'value', 'signals', 'signal-out'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.sliderBackground = this.shadowRoot.querySelector('#slider-background');
        this.handleContainer = this.shadowRoot.querySelector('#handle-container');
        this.sliderHandle = this.shadowRoot.querySelector('#slider-handle');
        this.sensor = this.shadowRoot.querySelector('#sensor');
        this.signals = [];
        this.noClick = false;
        this.showFeedback = false;
        this.x = 0;
        this.y = 0;
        this.width = 50;
        this.height = 50;
        this.minX = 0;
        this.minX = 0;
        this.range = 0;
        this.pixelSize = 20;
        this.offsetX = 0;
        this.offsetY = 0;
        this.margin = 50;
        this.min = 0;
        this.max = 1;
        this.step = .1;
        this.value = 0;
        this.handleWidth = 0;
        this.color = '#ff0000';
        //if (this.signalsOut[0]) this.sendMessage('signal', this.signalsOut[0], this.value);
    }
  
    setup = async () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.subscribe(this.signals);  
        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style.width = `${this.width}px`;
        this.container.style.height = `${this.height}px`;
        this.handleWidth = this.pixelSize * 7;

        await this.buildSlider();
       
        const rect = this.container.getBoundingClientRect();
        this.minX = rect.x + this.pixelSize + this.margin;
        this.maxX = rect.x + rect.width - this.pixelSize - this.margin;
        this.range = this.handleContainer.getBoundingClientRect().width;
        this.sensor.style.width = `${this.width + this.pixelSize * 2}px`;
        this.sensor.style.height = `${this.height + this.pixelSize * 2}px`;

        // set slider position from initial value
        this.setFromValue();

        this.shadowRoot.querySelector('#handle-center').style.backgroundColor = this.color;
        //const rect = this.container.getBoundingClientRect();
        //this.centerX = rect.left + rect.width / 2;
        //this.centerY = rect.top + rect.height / 2;
        if (!this.noClick) {
            this.addEventListener('pointerdown', this.handleClick);
            this.addEventListener('pointerdown', this.handleMessageOnClick);
        }
        this.addEventListener(`${this.id}`, this.handleEvent);
        this.broadcastMessage('register-sensor', this.id, this.container);
        //this.broadcastMessage('register-sensor', this.id, { x: this.x + this.w/2, y: this.y + this.h/2, w: this.w, h: this.height });
    }

    handleClick = (e) => {
        e.preventDefault();
        // Update center values dynamically in case layout shifted
        this.calculateValue(e.clientX, e.clientY);
        document.addEventListener('pointermove', this.dragElement);
        document.addEventListener('pointerup', this.endDragElement);
        document.addEventListener('pointerleave', this.endDragElement);
    }

    dragElement = (e) => {
        e.preventDefault();
        this.calculateValue(e.clientX + this.offsetX, e.clientY + this.offsetY);
    }

    endDragElement = () => {
        document.removeEventListener('pointermove', this.dragElement);
        document.removeEventListener('pointerup', this.endDragElement);
        document.removeEventListener('pointerleave', this.endDragElement);
    }

    handleEvent = (e) => {
        e.preventDefault();
        const type = e.detail.cmd;

        if (type === 'select') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 0, 0.5)';
        }
        if (type === 'unselect') {
            this.sensor.style.backgroundColor = 'rgba(255, 255, 255, 0)';
        }
        if (type === 'virtual-click') {
            this.handleMessageOnClick();
            let x = Number(e.detail.content.startX);
            let y = Number(e.detail.content.startY);
            this.offsetX = Number(e.detail.content.offsetX);
            this.offsetY = Number(e.detail.content.offsetY);
            const rect = this.container.getBoundingClientRect();
            this.calculateValue(x + this.offsetX, y + this.offsetY);
            document.addEventListener('pointermove', this.dragElement);
            document.addEventListener('pointerup', this.endDragElement);
            document.addEventListener('pointerleave', this.endDragElement);
        }
        if (type === 'virtual-drag') {
            this.calculateValue(e.clientX + this.offsetX, e.clientY + this.offsetY);
        }
        if (type === 'virtual-release') {
            this.offsetX = 0;
            this.offsetY = 0;
            document.removeEventListener('pointermove', this.dragElement);
            document.removeEventListener('pointerup', this.endDragElement);
            document.removeEventListener('pointerleave', this.endDragElement);
        }
    }

    teardown = () => {
        this.unsubscribe(this.signals);
        this.broadcastMessage('register-sensor', this.id);
        if (!this.noClick) {
            this.removeEventListener('pointerdown', this.handleClick);
        }
        this.removeEventListener(`${this.id}`, this.handleEvent);
    }
    
    calculateValue = (x, y) => {
        const rect = this.handleContainer.getBoundingClientRect();
        let startX = 0;
        let newX = x - rect.x;
        if ((newX >= startX) && (newX <= this.range + startX)) {
            this.sliderHandle.style.left = `${newX - (this.handleWidth /2)}px`;
            this.value = newX / this.range;
            this.value = this.map(this.value);
            this.sendMessage(this.signalOut, this.id, this.value);
        }
    }

    setFromValue = () => {
        const rect = this.handleContainer.getBoundingClientRect();
        let newX = (((this.value - this.min) / (this.max - this.min)) * this.range) - (this.handleWidth /2);
        this.sliderHandle.style.left = `${newX}px`;
        //this.sliderHandle.style.left = `${newX - this.handleWidth / 2}px`;
    }

    buildSlider = () => {
        let innerW = this.width - this.pixelSize * 2;
        let innerH = this.height - this.pixelSize * 2;
        let centerW = innerW - this.margin * 2;
        this.innerMax = centerW - this.margin;

        this.setPixelDimensions('top-side', innerW, this.pixelSize);
        this.setPixelDimensions('left-side', this.pixelSize, innerH);
        this.setPixelDimensions('bottom-side', innerW, this.pixelSize);
        this.setPixelDimensions('right-side', this.pixelSize, innerH );
        this.setPixelDimensions('left-margin', this.margin, innerH);
        this.setPixelDimensions('right-margin', this.margin, innerH);
        this.setPixelDimensions('center', centerW, innerH);
        this.setPixelDimensions('handle-container', centerW, innerH);
        this.setPixelDimensions('center-line', centerW, this.pixelSize);

        this.setPixelPosition('top-side', this.pixelSize, 0);
        this.setPixelPosition('left-side', 0, this.pixelSize);
        this.setPixelPosition('bottom-side', this.pixelSize, innerH + this.pixelSize);
        this.setPixelPosition('right-side', innerW + this.pixelSize, this.pixelSize);
        this.setPixelPosition('left-margin', this.pixelSize, this.pixelSize);
        this.setPixelPosition('right-margin', innerW + this.pixelSize - this.margin, this.pixelSize);
        this.setPixelPosition('center', this.margin + this.pixelSize, this.pixelSize);
        this.setPixelPosition('handle-container', this.margin + this.pixelSize, -(this.pixelSize * 2));
        this.setPixelPosition('center-line', this.margin + this.pixelSize, (this.height / 2) - this.pixelSize / 2);

        innerW = (this.pixelSize * 6) - this.pixelSize * 2;
        innerH = this.height + this.pixelSize * 2;
        
        this.sliderHandle.style.width = `${this.handleWidth}px`;
        this.setPixelDimensions('handle-top-side', innerW, this.pixelSize);
        this.setPixelDimensions('handle-left-side', this.pixelSize, innerH);
        this.setPixelDimensions('handle-bottom-side', innerW, this.pixelSize);
        this.setPixelDimensions('handle-right-side', this.pixelSize, innerH );
        this.setPixelDimensions('handle-center', innerW, innerH);
        this.setPixelDimensions('handle-shadow', innerW, this.pixelSize);
        this.setPixelDimensions('handle-center-line', (this.pixelSize), innerH - this.pixelSize * 2.5);

        this.setPixelPosition('handle-top-side', this.pixelSize, 0);
        this.setPixelPosition('handle-left-side', 0, this.pixelSize);
        this.setPixelPosition('handle-bottom-side', this.pixelSize, innerH + this.pixelSize);
        this.setPixelPosition('handle-right-side', innerW + this.pixelSize, this.pixelSize);
        this.setPixelPosition('handle-center', this.pixelSize, this.pixelSize);
        this.setPixelPosition('handle-shadow', this.pixelSize, innerH);
        this.setPixelPosition('handle-center-line', (innerW / 2) + (this.pixelSize / 2), this.pixelSize * 2);

        return new Promise(resolve => setTimeout(resolve, 500));

    }

    setPixelDimensions = (id, w, h) => {
        this.shadowRoot.querySelector(`#${id}`).style.width = `${w}px`;
        this.shadowRoot.querySelector(`#${id}`).style.height = `${h}px`;
    }

    setPixelPosition = (id, x, y) => {
        this.shadowRoot.querySelector(`#${id}`).style.top = `${y}px`;
        this.shadowRoot.querySelector(`#${id}`).style.left = `${x}px`;
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.x = Number(newValue);
        }
        if (name === 'y') {
            this.y = Number(newValue);
        }
        if (name === 'src') {
            this.src = newValue;
        }
        if (name === 'w') {
            this.width = Number(newValue);
        }
        if (name === 'h') {
            this.height = Number(newValue);
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'value') {
            this.value = Number(newValue);
        }
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'show-feedback') {
            this.showFeedback = true;
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'pixel-size') {
            this.pixelSize = Number(newValue);
        }
        if (name === 'margin') {
            this.margin = Number(newValue);
        }
        if (name === 'min') {
            this.min = Number(newValue);
        }
        if (name === 'max') {
            this.max = Number(newValue);
        }
        if (name === 'step') {
            this.step = Number(newValue);
        }
        if (name === 'value') {
            this.value = Number(newValue);
        }
    }

    map = (value) => {
        const raw = value * (this.max - this.min) + this.min;
        const stepped = Math.round(raw / this.step) * this.step;
        const precision = Math.ceil(-Math.log10(this.step)) || 0;
        return parseFloat(stepped.toFixed(precision));
    }

}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-slider/ravel-slider.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-slider/ravel-slider.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSlider_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSlider.js */ "../../core/web-components/custom-elements/gidgets/ravel-slider/src/RavelSlider.js");
/*
Defines the custom element <ravel-slider>
*/



customElements.define('ravel-slider', _src_RavelSlider_js__WEBPACK_IMPORTED_MODULE_0__.RavelSlider);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-slider/src/RavelSlider.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-slider/src/RavelSlider.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSlider: () => (/* binding */ RavelSlider)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");


class RavelSlider extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
          
          width: 100%; 
          border: 1px dotted red;
        }

        /* The slider itself */
        .slider-1, .slider-2 {
              -webkit-appearance: none;  /* Override default CSS styles */
              appearance: none;
              width: 100%; /* Full-width */
              height: 0px; /* Specified height */
              background: #000000; /* Grey background */
              border-bottom:3px dotted #aaaaaa;
              outline: none; /* Remove outline */
              pointer-events: none;
          }
          .slider-2 {
              display:none;
          }
          .slider-1::-webkit-slider-thumb {
              pointer-events: auto;
            -webkit-appearance: none;
            appearance: none;
            width: 40px;
            height: 40px;
            border: 0;
            background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjQwIgogICBoZWlnaHQ9IjQwIgogICB2aWV3Qm94PSIwIDAgNDAgNDAiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4NDM2IiAvPgogCiAgPHRleHQKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjI0cHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgaWQ9InRleHQ5NjQ2Ij48dHNwYW4KICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICBpZD0idHNwYW45NjQ0IgogICAgICAgeD0iMCIKICAgICAgIHk9IjM2IgogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTozNnB4Ij7wn6ShPC90c3Bhbj48L3RleHQ+Cjwvc3ZnPgo='); 
            cursor: pointer;
          }
          .slider-1::-moz-range-thumb {
              pointer-events: auto;
            width: 40px;
            height: 40px;
            border: 0;
            background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjQwIgogICBoZWlnaHQ9IjQwIgogICB2aWV3Qm94PSIwIDAgNDAgNDAiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4NDM2IiAvPgogCiAgPHRleHQKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjI0cHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgaWQ9InRleHQ5NjQ2Ij48dHNwYW4KICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICBpZD0idHNwYW45NjQ0IgogICAgICAgeD0iMCIKICAgICAgIHk9IjM2IgogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTozNnB4Ij7wn6ShPC90c3Bhbj48L3RleHQ+Cjwvc3ZnPgo='); 
            cursor: pointer;
          }
          .slider-2::-webkit-slider-thumb {
              pointer-events: auto;
            -webkit-appearance: none;
            appearance: none;
            width: 40px;
            height: 40px;
            border: 0;
            background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjQwIgogICBoZWlnaHQ9IjQwIgogICB2aWV3Qm94PSIwIDAgNDAgNDAiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4NDM2IiAvPgogCiAgPHRleHQKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjI0cHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgaWQ9InRleHQ5NjQ2Ij48dHNwYW4KICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICBpZD0idHNwYW45NjQ0IgogICAgICAgeD0iMCIKICAgICAgIHk9IjM2IgogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTozNnB4Ij7wn6SWPC90c3Bhbj48L3RleHQ+Cjwvc3ZnPgo='); 
            cursor: pointer;
          }
          .slider-2::-moz-range-thumb {
              pointer-events: auto;
            width: 40px;
            height: 40px;
            border: 0;
            background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjQwIgogICBoZWlnaHQ9IjQwIgogICB2aWV3Qm94PSIwIDAgNDAgNDAiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4NDM2IiAvPgogCiAgPHRleHQKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjI0cHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgaWQ9InRleHQ5NjQ2Ij48dHNwYW4KICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICBpZD0idHNwYW45NjQ0IgogICAgICAgeD0iMCIKICAgICAgIHk9IjM2IgogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTozNnB4Ij7wn6SWPC90c3Bhbj48L3RleHQ+Cjwvc3ZnPgo='); 
            cursor: pointer;
          }
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
    <div id="container">
        <input type="range" min=0 max=1 step=.01 value="0" class="slider-1" id="slider-1">
        <input type="range" min=0 max=1 step=.01 value="1" class="slider-2" id="slider-2">
    </div>
        `;
    }
 
    static get observedAttributes() { 
       return [...super.baseObservedAttributes,'slider-id', 'sliders', 'min', 'max', 'orientation', 'value', 'value-2', 'icon'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML =  this.constructor.localStyles
            + this.constructor.html
            + this.constructor.baseStyles
            + this.constructor.baseHtml;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.handleSignals = this.handleSignals.bind(this);
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.slider1 = this.shadowRoot.querySelector('#slider-1');
        this.slider2 = this.shadowRoot.querySelector('#slider-2');
        this.slider2.style['border-bottom'] = 'none';
        this.slider2.style['margin-top'] = '-16px';
       
        this.sliderId = 0;
        this.size = 32;
        this.orientation = 'horizontal';
        this.values = [ 0, 1.0 ];
        this.sliders = 1;
        this.min = 0;
        this.max = 1.0;
        this.step = 0.01;
    }
  
    setup = () => {
        this.observedMessages = ['signal'];
        this.subscribe(this.observedMessages);   
        this.addEventListener(`signal`, this.slider1Signals);
        this.container.style['font-size'] = `${this.size}px`;
        if (this.orientation === 'horizontal') {
           this.container.style['height'] = `${this.size}px`;
        } else {
           this.container.style['width'] = `${this.size}px`;
           this.container.style['margin-left'] = `${this.size}px`
        }
        if (this.sliders === 2) {
            this.slider2.style.display = 'block';
        }
        this.slider1.min = this.min;
        this.slider1.max = this.values[1];
        this.slider1.step = this.step;
        this.slider2.min = this.values[0];
        this.slider1.max = this.max;
        this.slider2.step = this.step;
        this.slider1.value = this.values[0];
        this.slider2.value = this.values[1];
        
        this.slider1.addEventListener('input', () => {
            if (this.slider1.value >= this.slider2.value) {
                this.slider2.value =  this.slider1.value;
            }
            this.values[0] = this.slider1.value;
            if (this.signalsOut[0]) this.sendMessage('signal', this.signalsOut[0], this.values[0]);
        });
        
        this.slider2.addEventListener('input', () => {
            if (this.slider2.value <= this.slider1.value) {
                this.slider1.value =  this.slider2.value;
            }
            this.values[1] = this.values[1];
            if (this.signalsOut[1]) this.sendMessage('signal', this.signalsOut[1], this.values[1]);
        });
        
        /* TODO: Get encoding of emoji working 
        this.icon1 = `url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjQwIgogICBoZWlnaHQ9IjQwIgogICB2aWV3Qm94PSIwIDAgNDAgNDAiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4NDM2IiAvPgogCiAgPHRleHQKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjI0cHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgaWQ9InRleHQ5NjQ2Ij48dHNwYW4KICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICBpZD0idHNwYW45NjQ0IgogICAgICAgeD0iMCIKICAgICAgIHk9IjM2IgogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTozNnB4Ij7wn42pPC90c3Bhbj48L3RleHQ+Cjwvc3ZnPgo=')`;
        this.shadowRoot.styleSheets[0].insertRule(`.slider-1::-webkit-slider-thumb { background: ${this.icon1}; }`, 0);
        this.shadowRoot.styleSheets[0].insertRule(`.slider-1::-moz-range-thumb { background: ${this.icon1}; }`, 0);
       
       // this.icon2 = this.getEncodedIcon(RavelEmoji.getRandomEmoji());
        console.log(this.icon1);
        */
    }
    
    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }

    handleSignals = (evt) => {
        if (this.signalsIn.indexOf(evt.detail.cmd) === -1) return;
        
        if (this.signalsIn.indexOf(evt.detail.cmd) === 0) {
            this.values[0] = Number(evt.detail.content);
            this.slider1.value = Number(evt.detail.content);
            console.log(evt.detail.content);
            console.log(this.slider1.value);
        }
        if (this.signalsIn.indexOf(evt.detail.cmd) === 1) {
            this.values[1] = Number(evt.detail.content);
            this.slider2.value = Number(evt.detail.content);
        }
        console.log(`got ${evt.detail.cmd} ${evt.detail.content}`);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'slider-id') {
            this.sliderId = newValue;
        }
        if (name === 'sliders') {
            this.sliders = parseInt(newValue, 10);
        }
        if (name === 'min') {
            this.min = Number(newValue);
        }
        if (name === 'max') {
            this.max = Number(newValue);
        }
        if (name === 'step') {
            this.step = Number(newValue);
        }
        if (name === 'value') {
            this.values[0] = Number(newValue);
        }
        if (name === 'value-2') {
            this.values[1] = Number(newValue);
        }
    }
    
    getEncodedIcon(emoji) {
        let svg = `
         <?xml version="1.0" encoding="UTF-8" standalone="no"?>
         <svg
            width="${this.size + 8}"
            height="${this.size + 8}"
            viewBox="0 0 ${this.size + 8} ${this.size + 8}"
            fill="none"
            version="1.1"
            xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:svg="http://www.w3.org/2000/svg">
           <defs
              id="defs8436" />
 
           <text
              xml:space="preserve"
              style="font-style:normal;font-weight:normal;font-size:24px;line-height:1.25;font-family:sans-serif;fill:#000000;fill-opacity:1;stroke:none"
              x="0"
              y="0"
              id="text9646"><tspan
                sodipodi:role="line"
                id="tspan9644"
                x="0"
                y="${this.size}"
                style="font-size:${this.size}px">${emoji}</tspan></text>
         </svg>
        `;
        return svg;
    }
}


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-switch/ravel-switch.js"
/*!**************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-switch/ravel-switch.js ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelSwitch_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelSwitch.js */ "../../core/web-components/custom-elements/gidgets/ravel-switch/src/RavelSwitch.js");
/*
Defines the custom element <ravel-switch>
*/



customElements.define('ravel-switch', _src_RavelSwitch_js__WEBPACK_IMPORTED_MODULE_0__.RavelSwitch);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-switch/src/RavelSwitch.js"
/*!*****************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-switch/src/RavelSwitch.js ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelSwitch: () => (/* binding */ RavelSwitch)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");
/* harmony import */ var _modules_RavelEmoji_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../modules/RavelEmoji.js */ "../../core/modules/RavelEmoji.js");




class RavelSwitch extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
        }
        #switch-wrapper {
            display: flex;
            flex: space-between;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border: 5px solid #444444;
        }
        .switch {
            position: relative;
            background-color: #999999;
            height: 100%;
            width: 20px;
            margin: 1px;
        }
        .switch .active {
            box-shadow: inset 0px 0px 4px 4px rgba(255, 255, 255, .25);
        }
        .switch-shadow {
            position: absolute;
            bottom: 0px;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            height: 20%;
        }
        .selected {
            -webkit-box-shadow: 0px 0px 0px 10px rgba(255, 255, 0, 0.5); 
            box-shadow: 0px 0px 0px 10px rgba(255, 255, 0, 0.5);
            background-color: rgba(255, 255, 0, 0.5);
            border-radius: 14px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="switch-wrapper">
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'type', 'orientation', 'states', 'state', 'color', 'signals', 'w', 'h'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html
            + this.constructor.baseStyles
            + this.constructor.baseHtml;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.switchId = 0;
        this.type = 'toggle';
        this.size = '50';
        this.orientation = 'horizontal';
        this.states = 2;
        this.state = 1;
        this.stateDir = 1;
        this.signals = [ ];
        this.noClick = false;
        this.showFeedback = false;
        this.x = 0;
        this.y = 0;
        this.width = 100;
        this.height = 100;
        this.switchWidth = 50;
        this.offColor = '#999999';
    }
  
    setup = () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);
        this.container.style.width = `${this.width}px`;
        this.container.style.height = `${this.height}px`;
        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.switchWidth = this.width / this.states;
        console.log(this.width);

        let wrapper = this.shadowRoot.querySelector('#switch-wrapper');
        let widthAttribute = `${this.switchWidth}px`;
        if (this.orientation === 'vertical') {
            wrapper.style.flexDirection = 'column';
            widthAttribute = '100%';
        }

        for (let i = 1; i <= this.states; i++) {
            wrapper.innerHTML = wrapper.innerHTML + `
                <div id="state-${i}" class="switch" style="width:${widthAttribute};"><div class="switch-shadow"></div><div>`;
        }
        this.shadowRoot.querySelector(`#state-${this.state}`).style.backgroundColor = this.color;
        this.addEventListener('click', this.handleToggle);
        this.addEventListener('toggle', this.handleToggle);

        this.addEventListener(`${this.id}`, this.handleEvent);
        this.broadcastMessage('register-sensor', this.id, this.container);
        //this.broadcastMessage('register-sensor', this.id, { x: this.x + this.width/2, y: this.y + this.height/2 + 10, w: this.width, h: this.height });
    }
    
    handleToggle = () => {
        this.shadowRoot.querySelector(`#state-${this.state}`).style.backgroundColor = this.offColor;
        if ((this.state === this.states) || ((this.state === 1) && (this.stateDir === -1))) {
            this.stateDir = this.stateDir * -1;
        }
        this.state =  this.state + this.stateDir;
        console.log(this.state);
        this.shadowRoot.querySelector(`#state-${this.state}`).style.backgroundColor = this.color; 
        this.sendMessage(this.stateSignals[this.state - 1 ], '', '');
        let evt = new CustomEvent(this.stateSignals[this.state], { detail: {}});
        this.dispatchEvent(evt);
    }
    
    handleEvent = (e) => {
        e.preventDefault();
        const type = e.detail.cmd;
        console.log(type);
        if (type === 'select') {
            this.shadowRoot.querySelector('#switch-wrapper').classList.add('selected');
        }
        if (type === 'unselect') {
            this.shadowRoot.querySelector('#switch-wrapper').classList.toggle('selected');
        }
        if (type === 'virtual-click') {
            this.handleToggle();
        }
    }

    teardown = () => {
        this.unsubscribe(this.observedMessages);
        this.broadcastMessage('register-sensor', this.id);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'w') {
            this.width = Number(newValue);
        }
        if (name === 'h') {
            this.height = Number(newValue);
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'type') {
            this.type = newValue;
        }
        if (name === 'states') {
            this.states = parseInt(newValue, 10);
        }
        if (name === 'state') {
            this.state = parseInt(newValue, 10);
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'signals') {
            this.stateSignals = newValue.split(',');
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'show-feedback') {
            this.showFeedback = true;
        }
    }
}



/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-tally-grid/ravel-tally-grid.js"
/*!**********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-tally-grid/ravel-tally-grid.js ***!
  \**********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelTallyGrid_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelTallyGrid.js */ "../../core/web-components/custom-elements/gidgets/ravel-tally-grid/src/RavelTallyGrid.js");
/*
Defines the custom element <ravel-tally-grid>
*/



customElements.define('ravel-tally-grid', _src_RavelTallyGrid_js__WEBPACK_IMPORTED_MODULE_0__.RavelTallyGrid);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-tally-grid/src/RavelTallyGrid.js"
/*!************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-tally-grid/src/RavelTallyGrid.js ***!
  \************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelTallyGrid: () => (/* binding */ RavelTallyGrid)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelTallyGrid extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        :host {
            display: block;
            width: 100%;
            height: 100%;
        }
        #container {
            display: grid;
            width: 100%;
            height: 100%;
        }
        .cell {
            background: #eeeeee;
            border: 1px solid #ffffff;
            aspect-ratio: 1 / 1;
            cursor: pointer;
            transition: background 0.2s;
        }
        .cell.active {
            background: black;
        }
        .cell.extra {
            background: none;
            border: 1px solid none;
            pointer-events: none;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'color', 'cells'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#touch-pad-container');
        this.handle = this.shadowRoot.querySelector('#touch-handle');
        this.cells = 14; 
        this.interactive = false;
        this.filled = false;
    }
  
    setup = () => {
        this.observedMessages = [`${this.id}`];
        this.subscribe(this.observedMessages);   
        this.size = Math.ceil(Math.sqrt(this.cells)); 
        this.container = this.shadowRoot.querySelector('#container');
        this.container.style.gridTemplateColumns = `repeat(${this.size}, 1fr)`;
        this.container.style.gridTemplateRows = `repeat(${this.size}, 1fr)`;
        this.addEventListener(`${this.id}`, this.handleEvent);
        for (let i = 0; i < this.size * this.size; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = `cell-${i}`;
            if (i >= this.cells) {
                cell.classList.add('extra');
            }
            this.container.appendChild(cell);
        }
    }

    returnEmoji = (evt) => {
        
    }
    
    handleEvent = (evt) => {
        if (evt.detail.cmd === 'activate') {
            if (this.shadowRoot.querySelector(`#cell-${evt.detail.content}`)) {
                this.shadowRoot.querySelector(`#cell-${evt.detail.content}`).classList.add('active');
            }
        }
    }

    teardown = () => {
        this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'cells') {
            this.cells = parseInt(newValue, 10);
        }
        if (name === 'color') {
            this.color = newValue;
        }
    }
}

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-touch-pad/ravel-touch-pad.js"
/*!********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-touch-pad/ravel-touch-pad.js ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelTouchPad_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelTouchPad.js */ "../../core/web-components/custom-elements/gidgets/ravel-touch-pad/src/RavelTouchPad.js");
/*
Defines the custom element <ravel-touch-pad>
*/



customElements.define('ravel-touch-pad', _src_RavelTouchPad_js__WEBPACK_IMPORTED_MODULE_0__.RavelTouchPad);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-touch-pad/src/RavelTouchPad.js"
/*!**********************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-touch-pad/src/RavelTouchPad.js ***!
  \**********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelTouchPad: () => (/* binding */ RavelTouchPad)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelTouchPad extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #touch-handle {
            position: absolute;
            font-size:12px;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="touch-pad-container">
        <ravel-emoji-grid emoji="‚¨õÔ∏è" size="80"></ravel-emoji-grid>
        <div id="touch-handle">üü°</div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 'background', 'touch-x-list', 'touch-y-list', "touch-points", 'width', 'height', 'x', 'y'];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#touch-pad-container');
        this.handle = this.shadowRoot.querySelector('#touch-handle');
        this.width = 160;
        this.height = 160;
    }
  
    setup = () => {
        this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);   
        this.container.style.width = `${this.width}`; 
        this.container.style.height = `${this.height}`;
        this.centerX = this.handle.getBoundingClientRect().left;
        this.centerY = this.handle.getBoundingClientRect().top;
        this.containerX = this.container.getBoundingClientRect().left;
        this.containerY = this.container.getBoundingClientRect().top;
        this.updateValue();
        this.addEventListener('mousedown', (e) => { 
            console.log("mousedown");
            e.preventDefault();
            this.startX = e.clientX;
            this.startY = e.clientY;
            this.handle.style.left = e.clientX - this.centerX - 6;
            this.handle.style.top = e.clientY - this.centerY - 6;
            this.mouseMoveCallback = this.dragElement.bind(this); 
            this.mouseUpCallback = this.endDragElement.bind(this);
            document.addEventListener('mousemove', this.mouseMoveCallback);
            document.addEventListener('mouseup', this.mouseUpCallback);
           // document.addEventListener('mouseout', this.mouseUpCallback);
            document.addEventListener('mouseleave', this.mouseUpCallback);
  	  });
    }
    
    dragElement(e) {
        e.preventDefault();
        let x = this.startX - e.clientX;
        let y = this.startY - e.clientY;
        this.startX = e.clientX;
        this.startY = e.clientY;
        let newX = (this.handle.offsetLeft - x);
        let newY = (this.handle.offsetTop - y);
        if (this.inBounds(newX, newY)) {
            this.handle.style.left = newX + 'px';
            this.handle.style.top = newY + 'px';
        }
     }

    endDragElement() {
        //console.log("mouseout");
        document.removeEventListener('mousemove', this.mouseMoveCallback);
        document.removeEventListener('mouseup', this.mouseUpCallback);
     //   document.removeEventListener('mouseout', this.mouseUpCallback);
        document.removeEventListener('mouseleave', this.mouseUpCallback);
    }
     
    updateValue() {
       /* if (this.orientation === 'horizontal') {
            this.value = (this.handleX - (this.containerX + this.padding * 2)) / this.length;
        } else {
            this.value = ((this.containerY + this.padding * 2) - this.handleY) / this.length;
        }
        console.log(this.value);*/
    }
    
	inBounds(x1, y1) {
        return true; // FIXME
        // removed by dead control flow

		// removed by dead control flow

	}
    
    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'size') {
            this.size = Number(newValue);
        }
        if (name === 'x') {
            this.container.style.position = 'fixed';
            this.x = newValue;
            this.container.style.left = newValue;
        }
        if (name === 'y') {
            this.container.style.position = 'fixed';
            this.y = newValue;
            this.container.style.top = newValue;
        }
        if (name === 'orientation') {
            this.orientation = newValue;
        }
        if (name === 'width') {
            this.width = newValue;
        }
        if (name === 'height') {
            this.height = newValue;
        }
    }
}

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-1/ravel-visualizer-1.js"
/*!**************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-visualizer-1/ravel-visualizer-1.js ***!
  \**************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelVisualizer1_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelVisualizer1.js */ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-1/src/RavelVisualizer1.js");
/*
Defines the custom element <ravel-visualizer-1>
*/




customElements.define('ravel-visualizer-1', _src_RavelVisualizer1_js__WEBPACK_IMPORTED_MODULE_0__.RavelVisualizer1);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-1/src/RavelVisualizer1.js"
/*!****************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-visualizer-1/src/RavelVisualizer1.js ***!
  \****************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelVisualizer1: () => (/* binding */ RavelVisualizer1)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelVisualizer1 extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #screen {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #sensor {
            position: absolute;
            background-color: rgba(255, 255, 0, 0.5);
            border-radius: 24px;
        }
        #waveform {
            position: absolute;
        }
        .pixelArt {
            position: absolute;
        }
        .transparent {
            background-color: rgba(255, 255, 255, 0);
        }
        .light-pixel {
            background-color: #aaaaaa;
        }
        .dark-pixel {
            background-color: #000000;
        }
        .color-pixel {
            background-color: #FFFF00;
        }
        .shadow {
            height: 10%;
            opacity: 0.5;
            background-color: #000000;
        }
        @-webkit-keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        @keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        .pulse {
          display: inline-block;
          vertical-align: middle;
          -webkit-transform: perspective(1px) translateZ(0);
          transform: perspective(1px) translateZ(0);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0);
         -webkit-animation-name: pulse;
          animation-name: pulse;
          -webkit-animation-duration: 0.3s;
          animation-duration: 0.3s;
          -webkit-animation-timing-function: linear;
          animation-timing-function: linear;
          -webkit-animation-iteration-count: infinite;
          animation-iteration-count: infinite;
          -webkit-animation-direction: alternate;
          animation-direction: alternate;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="screen">
            <div id="top-side" class="dark-pixel pixelArt"></div>
            <div id="left-side" class="dark-pixel pixelArt"></div>
            <div id="right-side" class="dark-pixel pixelArt"></div>
            <div id="bottom-side" class="dark-pixel pixelArt"></div>
            <div id="p5-container" class="light-pixel pixelArt">       
            </div>
            <div id="container-shadow" class="shadow pixelArt"></div>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'w', 'h', 'color', 'pixel-size', 'signals', 'signal-out' ];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.center = this.shadowRoot.querySelector('#p5-container');
        this.waveform = this.shadowRoot.querySelector('#waveform');
        this.x = 0;
        this.y = 0;
        this.width = 50;
        this.height = 50;
        this.pixelSize = 20;
        this.padding = 10;
        this.color = '#ff0000';
        this.analyser = null; 
        this.dataArray = null;
    }
  
    setup = () => {
        //this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);  
        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style.width = `${this.width}px`;
        this.container.style.height = `${this.height}px`;
        this.buildScreen();
        this.center.style.backgroundColor = `${this.color}`;
        
        this.p5instance = new p5((p) => this.sketch1(p));
        //this.p5instance = new p5(this.sketch1); 
    
    }
    
    buildScreen = () => {
        let innerW = this.width - this.pixelSize * 2;
        let innerH = this.height - this.pixelSize * 2;
        let centerW = innerW;
        this.innerMax = centerW;

        console.log(`${innerW} ${innerH}`);
        this.setPixelDimensions('top-side', innerW, this.pixelSize);
        this.setPixelDimensions('left-side', this.pixelSize, innerH);
        this.setPixelDimensions('bottom-side', innerW, this.pixelSize);
        this.setPixelDimensions('right-side', this.pixelSize, innerH );
        this.setPixelDimensions('p5-container', centerW, innerH);
        this.setPixelDimensions('container-shadow', innerW, this.pixelSize);

        this.setPixelPosition('top-side', this.pixelSize, 0);
        this.setPixelPosition('left-side', 0, this.pixelSize);
        this.setPixelPosition('bottom-side', this.pixelSize, innerH + this.pixelSize);
        this.setPixelPosition('right-side', innerW + this.pixelSize, this.pixelSize);
        this.setPixelPosition('p5-container', this.pixelSize, this.pixelSize);
        this.setPixelPosition('container-shadow', this.pixelSize, innerH);
    }

    setPixelDimensions = (id, w, h) => {
        this.shadowRoot.querySelector(`#${id}`).style.width = `${w}px`;
        this.shadowRoot.querySelector(`#${id}`).style.height = `${h}px`;
    }

    setPixelPosition = (id, x, y) => {
        this.shadowRoot.querySelector(`#${id}`).style.top = `${y}px`;
        this.shadowRoot.querySelector(`#${id}`).style.left = `${x}px`;
    }

    setAnalyser(analyser) {
        this.analyser = analyser;
        this.dataArray = new Uint8Array(analyser.fftSize);
    }

    teardown = () => {
        // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'pixel-size') {
            this.pixelSize = Number(newValue);
        }
    }

    sketch1 = (p) => {
        p.setup = () => {
            const canvas = p.createCanvas(this.width - this.pixelSize * 2, this.height - this.pixelSize * 2);
            canvas.parent(this.shadowRoot.querySelector('#p5-container'));
            canvas.style('visibility', 'visible');
            p.frameRate(15); 
            console.log('setup!');
        };

        p.draw = () => {
            p.background(this.color);
            if (this.analyser && this.dataArray) {
                //let midY = p.height / 2;
                this.analyser.getByteTimeDomainData(this.dataArray);
                //p.noStroke();
                //p.fill(0, 255, 0);
                p.stroke(0, 255, 0);
                p.strokeWeight(2);
                p.noFill();
                p.beginShape();
                for (let i = 0; i < this.dataArray.length; i++) {
                    const x = p.map(i, 0, this.dataArray.length, 0, p.width);
                    const y = p.map(this.dataArray[i], 0, 255, 0, p.height - this.padding);
                    p.vertex(x, y);
                    //p.rect(x, (midY), 1, (y - (midY)) * 1.5, 20);
                }
                p.endShape();
            } else {
                p.fill(25);
                p.textAlign(p.CENTER, p.CENTER);
                p.text("No analyser connected", p.width / 2, p.height / 2);
            }
        }
    }   
}

/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-2/ravel-visualizer-2.js"
/*!**************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-visualizer-2/ravel-visualizer-2.js ***!
  \**************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _src_RavelVisualizer2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/RavelVisualizer2.js */ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-2/src/RavelVisualizer2.js");
/*
Defines the custom element <ravel-visualizer-2>
*/




customElements.define('ravel-visualizer-2', _src_RavelVisualizer2_js__WEBPACK_IMPORTED_MODULE_0__.RavelVisualizer2);


/***/ },

/***/ "../../core/web-components/custom-elements/gidgets/ravel-visualizer-2/src/RavelVisualizer2.js"
/*!****************************************************************************************************!*\
  !*** ../../core/web-components/custom-elements/gidgets/ravel-visualizer-2/src/RavelVisualizer2.js ***!
  \****************************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RavelVisualizer2: () => (/* binding */ RavelVisualizer2)
/* harmony export */ });
/* harmony import */ var _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/ravel-element/src/RavelElement.js */ "../../core/web-components/custom-elements/base/ravel-element/src/RavelElement.js");
/* harmony import */ var _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../common/global-styles.js */ "../../core/web-components/common/global-styles.js");



class RavelVisualizer2 extends _base_ravel_element_src_RavelElement_js__WEBPACK_IMPORTED_MODULE_0__.RavelElement {
    static get localStyles() {
        return `
        <style>
        #container {
            position: absolute;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #screen {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #sensor {
            position: absolute;
            background-color: rgba(255, 255, 0, 0.5);
            border-radius: 24px;
        }
        #waveform {
            position: absolute;
        }
        .pixelArt {
            position: absolute;
        }
        .transparent {
            background-color: rgba(255, 255, 255, 0);
        }
        .light-pixel {
            background-color: #aaaaaa;
        }
        .dark-pixel {
            background-color: #000000;
        }
        .color-pixel {
            background-color: #FFFF00;
        }
        .shadow {
            height: 10%;
            opacity: 0.5;
            background-color: #000000;
        }
        @-webkit-keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        @keyframes pulse {
          to {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
          }
        }
        .pulse {
          display: inline-block;
          vertical-align: middle;
          -webkit-transform: perspective(1px) translateZ(0);
          transform: perspective(1px) translateZ(0);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0);
         -webkit-animation-name: pulse;
          animation-name: pulse;
          -webkit-animation-duration: 0.3s;
          animation-duration: 0.3s;
          -webkit-animation-timing-function: linear;
          animation-timing-function: linear;
          -webkit-animation-iteration-count: infinite;
          animation-iteration-count: infinite;
          -webkit-animation-direction: alternate;
          animation-direction: alternate;
        }
        </style>
        `;
    }
  
    static get html() { 
        return `
        <div id="container">
        <div id="screen">
            <div id="top-side" class="dark-pixel pixelArt"></div>
            <div id="left-side" class="dark-pixel pixelArt"></div>
            <div id="right-side" class="dark-pixel pixelArt"></div>
            <div id="bottom-side" class="dark-pixel pixelArt"></div>
            <div id="p5-container" class="light-pixel pixelArt">       
            </div>
            <div id="container-shadow" class="shadow pixelArt"></div>
        </div>
        </div>
        `;
    }
 
    static get observedAttributes() { 
        return [...super.baseObservedAttributes, 
            'w', 'h', 'color', 'pixel-size', 'signals', 'signal-out' ];
    }

    constructor() {
        super();
        const template = document.createElement('template');
        template.innerHTML = _common_global_styles_js__WEBPACK_IMPORTED_MODULE_1__["default"]
            + this.constructor.localStyles
            + this.constructor.html;
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(template.content.cloneNode(true));
        this.initialize();
    }
  
    connectedCallback() {
        this.setup();
    }
    
    disconnectedCallback() {
        this.teardown();
    }
    
    initialize() {
        this.container = this.shadowRoot.querySelector('#container');
        this.center = this.shadowRoot.querySelector('#p5-container');
        this.waveform = this.shadowRoot.querySelector('#waveform');
        this.x = 0;
        this.y = 0;
        this.width = 50;
        this.height = 50;
        this.pixelSize = 20;
        this.color = '#ff0000';
        this.audioBuffer = null;
        this.audioBuffer = null;
        this.playheadSample = null;
    }
  
    setup = () => {
        //this.observedMessages = ['message'];
        //this.subscribe(this.observedMessages);  
        this.container.style.top = `${this.y}px`;
        this.container.style.left = `${this.x}px`;
        this.container.style.width = `${this.width}px`;
        this.container.style.height = `${this.height}px`;
        this.buildScreen();
        this.center.style.backgroundColor = `${this.color}`;
        
        this.p5instance = new p5((p) => this.sketch1(p));
        //this.p5instance = new p5(this.sketch1); 
    
    }
    
    buildScreen = () => {
        let innerW = this.width - this.pixelSize * 2;
        let innerH = this.height - this.pixelSize * 2;
        let centerW = innerW;
        this.innerMax = centerW;

        console.log(`${innerW} ${innerH}`);
        this.setPixelDimensions('top-side', innerW, this.pixelSize);
        this.setPixelDimensions('left-side', this.pixelSize, innerH);
        this.setPixelDimensions('bottom-side', innerW, this.pixelSize);
        this.setPixelDimensions('right-side', this.pixelSize, innerH );
        this.setPixelDimensions('p5-container', centerW, innerH);
        this.setPixelDimensions('container-shadow', innerW, this.pixelSize);

        this.setPixelPosition('top-side', this.pixelSize, 0);
        this.setPixelPosition('left-side', 0, this.pixelSize);
        this.setPixelPosition('bottom-side', this.pixelSize, innerH + this.pixelSize);
        this.setPixelPosition('right-side', innerW + this.pixelSize, this.pixelSize);
        this.setPixelPosition('p5-container', this.pixelSize, this.pixelSize);
        this.setPixelPosition('container-shadow', this.pixelSize, innerH);
    }

    setPixelDimensions = (id, w, h) => {
        this.shadowRoot.querySelector(`#${id}`).style.width = `${w}px`;
        this.shadowRoot.querySelector(`#${id}`).style.height = `${h}px`;
    }

    setPixelPosition = (id, x, y) => {
        this.shadowRoot.querySelector(`#${id}`).style.top = `${y}px`;
        this.shadowRoot.querySelector(`#${id}`).style.left = `${x}px`;
    }

    setBuffer(buffer) {
        this.audioBuffer = buffer;
        this.p5instance.redraw();
    }

    setPosition(sampleIndex) {
        this.playheadSample = sampleIndex;
        this.p5instance.redraw();
    }

    teardown = () => {
       // this.unsubscribe(this.observedMessages);
    }

    attributeChangedCallback(name, oldValue, newValue) {
        // Call the parent's attributeChangedCallback to preserve its behavior
        super.attributeChangedCallback(name, oldValue, newValue);
        if (name === 'signals') {
            this.signals = newValue.split(',');
        }
        if (name === 'signal-out') {
            this.signalOut = newValue;
        }
        if (name === 'no-click') {
            this.noClick = true;
        }
        if (name === 'color') {
            this.color = newValue;
        }
        if (name === 'pixel-size') {
            this.pixelSize = Number(newValue);
        }
    }

    sketch1 = (p) => {
        p.setup = () => {
            const canvas = p.createCanvas(this.width - this.pixelSize * 2, this.height - this.pixelSize * 2);
            canvas.parent(this.shadowRoot.querySelector('#p5-container'));
            canvas.style('visibility', 'visible');
            p.frameRate(30); // update at 30fps
        };

        p.draw = () => {
            p.background(this.color);

            if (!this.audioBuffer) {
                p.fill(this.color);
                p.textAlign(p.CENTER, p.CENTER);
                p.text("No audio loaded", p.width / 2, p.height / 2);
                return;
            }

            const channelData = this.audioBuffer.getChannelData(0);
            const step = Math.ceil(channelData.length / p.width);
            const midY = p.height / 2;

            p.noStroke();

            // Draw waveform
            for (let x = 0; x < p.width; x++) {
                const sliceStart = x * step;
                let min = 1.0, max = -1.0;
                for (let i = 0; i < step; i++) {
                    const s = channelData[sliceStart + i] || 0;
                    if (s < min) min = s;
                    if (s > max) max = s;
                }
                const y1 = midY + min * midY;
                const y2 = midY + max * midY;
                let squiggleMax = 2;
                let squiggle = (Math.random() * squiggleMax) - (squiggleMax / 2);
                p.noFill();
                p.stroke(25, 25, 25);
                p.rect(x, y1 + squiggle, 1, y2 - y1 + squiggle);
            }

            // Draw playhead (yellow)
            if (this.playheadSample != null) {
                const playheadX = Math.floor(this.playheadSample / step);
                if (playheadX >= 0 && playheadX < p.width) {
                    const sliceStart = playheadX * step;
                    let min = 1.0, max = -1.0;
                    for (let i = 0; i < step; i++) {
                        const s = channelData[sliceStart + i] || 0;
                        if (s < min) min = s;
                        if (s > max) max = s;
                    }
                    const y1 = midY + min * midY;
                    const y2 = midY + max * midY;
                    p.noStroke();
                    p.fill(255, 255, 255, 100); // yellow
                    //p.rect(playheadX, y1-10, 3, y2 - y1 + 10);
                    p.circle(playheadX, midY, y2 - y1);
                    p.circle(playheadX, midY, (y2 - y1) / 2);
                    p.circle(playheadX, midY, 4);
                }
            }
        }
    }   
}

/***/ },

/***/ "../../core/web-components/index.js"
/*!******************************************!*\
  !*** ../../core/web-components/index.js ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _custom_elements_assemblies_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./custom-elements/assemblies/index.js */ "../../core/web-components/custom-elements/assemblies/index.js");
/* harmony import */ var _custom_elements_ballyhoo_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./custom-elements/ballyhoo/index.js */ "../../core/web-components/custom-elements/ballyhoo/index.js");
/* harmony import */ var _custom_elements_base_index_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./custom-elements/base/index.js */ "../../core/web-components/custom-elements/base/index.js");
/* harmony import */ var _custom_elements_document_index_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./custom-elements/document/index.js */ "../../core/web-components/custom-elements/document/index.js");
/* harmony import */ var _custom_elements_gadgets_index_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./custom-elements/gadgets/index.js */ "../../core/web-components/custom-elements/gadgets/index.js");
/* harmony import */ var _custom_elements_gidgets_index_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./custom-elements/gidgets/index.js */ "../../core/web-components/custom-elements/gidgets/index.js");







/***/ }

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Check if module exists (development only)
/******/ 		if (__webpack_modules__[moduleId] === undefined) {
/******/ 			var e = new Error("Cannot find module '" + moduleId + "'");
/******/ 			e.code = 'MODULE_NOT_FOUND';
/******/ 			throw e;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
(() => {
/*!******************!*\
  !*** ./index.js ***!
  \******************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/modules/RavelMessages.js */ "../../core/modules/RavelMessages.js");
/* harmony import */ var _core_web_components_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../core/web-components/index.js */ "../../core/web-components/index.js");



// For handling anchors

document.addEventListener('DOMContentLoaded', () => {
    const anchor = location.hash.slice(1);
    if (anchor) _core_modules_RavelMessages_js__WEBPACK_IMPORTED_MODULE_0__.RavelMessages.sendMessage('scrapbook', 'open', anchor);
});

// For the embedded Thompson Folk Motif tool:
let folkMotifItems = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ];
		
function chooseTenFolkMotifItems() {
  for ( i=0; i < 10; i++) {
    if (folkMotifItems[i] != 0) document.getElementById("a" + folkMotifItems[i]).style['display'] = "none";
    folkMotifItems[i] = Math.floor(Math.random() * 42355) + 1;
    document.getElementById("a" + folkMotifItems[i]).style['display'] = "block";
  }
}

const fluxlyAsciiLogo = `
                                                    
             @@@@@@@@@@@@@@@@@@@@@                  
         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@             
       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      
   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*-::::::+%@@@@     
   @@@@@@@@@@#****#@@@@@@@@@@@@+-:::....:::-#@@@    
  @@@@@@@@*-:::::::-=%@@@@@@@@=::.....-:...::*@@@   
 @@@@@@@%-::..::...::-%@@@@@@#::...=@@@@@-..::#@@@  
 @@@@@@%=:..=@@@@@:.::-@@@@@@=::..=@@@@@@@=..:-@@@@ 
 @@@@@@+::.-@@@@@@%..::@@@@@@-:...@@@@@@@@@:.::%@@@ 
 @@@@@@+:..=@@@@@@@..::@@@@@@=::..@@@@@@@@@..::@@@@@
 @@@@@@+:..-%@@@@@:..:-@@@@@@%::..-@@@@@@%:.::+@@@@@
 @@@@@@#-:...-*+:...::%@@@@@@@=::...:*#=...::-%@@@@@
 @@@@@@@#::........::*@@@@@@@@@*-:::.....:::=%@@@@@@
 @@@@@@@@@+::::::::-%@@@@@@@@@@@@%*=::::::-#@@@@@@@@
 @@@@@@@@@@@%+::-#@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@ 
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    
      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     
        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      
          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         
              @@@@@@@@@@@@@@@@@@@@@@@@@@            
                    @@@@@@@@@@@                     
`;
console.log(fluxlyAsciiLogo);


})();

/******/ })()
;
//# sourceMappingURL=bundle.js.map